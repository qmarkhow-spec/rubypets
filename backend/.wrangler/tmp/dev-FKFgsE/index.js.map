{
  "version": 3,
  "sources": ["../../../src/api/utils.ts", "../../../src/db/d1-client.ts", "../../../src/db/index.ts", "../../../src/services/health.ts", "../../../src/api/routes/system.ts", "../../../src/services/auth.ts", "../../../src/api/routes/auth.ts", "../../../src/services/posts.ts", "../../../../node_modules/jose/dist/webapi/lib/buffer_utils.js", "../../../../node_modules/jose/dist/webapi/lib/base64.js", "../../../../node_modules/jose/dist/webapi/util/base64url.js", "../../../../node_modules/jose/dist/webapi/util/errors.js", "../../../../node_modules/jose/dist/webapi/lib/crypto_key.js", "../../../../node_modules/jose/dist/webapi/lib/invalid_key_input.js", "../../../../node_modules/jose/dist/webapi/lib/is_key_like.js", "../../../../node_modules/jose/dist/webapi/lib/is_disjoint.js", "../../../../node_modules/jose/dist/webapi/lib/is_object.js", "../../../../node_modules/jose/dist/webapi/lib/check_key_length.js", "../../../../node_modules/jose/dist/webapi/lib/asn1.js", "../../../../node_modules/jose/dist/webapi/lib/jwk_to_key.js", "../../../../node_modules/jose/dist/webapi/key/import.js", "../../../../node_modules/jose/dist/webapi/lib/validate_crit.js", "../../../../node_modules/jose/dist/webapi/lib/is_jwk.js", "../../../../node_modules/jose/dist/webapi/lib/normalize_key.js", "../../../../node_modules/jose/dist/webapi/lib/check_key_type.js", "../../../../node_modules/jose/dist/webapi/lib/subtle_dsa.js", "../../../../node_modules/jose/dist/webapi/lib/get_sign_verify_key.js", "../../../../node_modules/jose/dist/webapi/lib/jwt_claims_set.js", "../../../../node_modules/jose/dist/webapi/lib/sign.js", "../../../../node_modules/jose/dist/webapi/jws/flattened/sign.js", "../../../../node_modules/jose/dist/webapi/jws/compact/sign.js", "../../../../node_modules/jose/dist/webapi/jwt/sign.js", "../../../src/lib/fcm.ts", "../../../src/services/notifications.ts", "../../../src/api/routes/shared.ts", "../../../src/api/routes/posts.ts", "../../../src/api/routes/media.ts", "../../../src/api/routes/admin.ts", "../../../src/data/pets-category.json", "../../../src/services/pets.ts", "../../../src/api/routes/pets.ts", "../../../src/api/routes/owners.ts", "../../../src/api/routes/chat.ts", "../../../src/api/routes/notifications.ts", "../../../src/api/router.ts", "../../../src/do/chat-thread-do.ts", "../../../src/index.ts", "../../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-RoT4Ec/middleware-insertion-facade.js", "../../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-RoT4Ec/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\Users\\ben09\\Desktop\\rubypets\\rubypets\\backend\\.wrangler\\tmp\\dev-FKFgsE",
  "sourcesContent": ["import { HandlerContext } from \"../types\";\n\nconst DEFAULT_CORS = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Access-Control-Allow-Headers\": \"content-type, authorization\",\n  \"Access-Control-Allow-Methods\": \"GET, POST, DELETE, OPTIONS\",\n  \"Access-Control-Max-Age\": \"86400\"\n};\n\nexport function withCors(response: Response, extraHeaders: Record<string, string> = {}): Response {\n  if (response.status === 101) {\n    return response;\n  }\n  const headers = new Headers(response.headers);\n  Object.entries({ ...DEFAULT_CORS, ...extraHeaders }).forEach(([key, value]) => headers.set(key, value));\n  return new Response(response.body, { status: response.status, statusText: response.statusText, headers });\n}\n\nexport function json(data: unknown, init: ResponseInit = {}): Response {\n  const headers = new Headers(init.headers);\n  headers.set(\"content-type\", \"application/json; charset=utf-8\");\n  return new Response(JSON.stringify(data), { ...init, headers });\n}\n\nexport function errorJson(message: string, status = 400, code?: string | number, details?: unknown): Response {\n  const error: { message: string; code?: string | number; details?: unknown } = { message };\n  if (code !== undefined) error.code = code;\n  if (details !== undefined) error.details = details;\n  return json({ ok: false, error }, { status });\n}\n\nexport function okJson(data: unknown, status = 200): Response {\n  return json({ ok: true, data }, { status });\n}\n\nexport async function readJson<T>(request: Request): Promise<T> {\n  try {\n    return (await request.json()) as T;\n  } catch {\n    throw new Error(\"Invalid JSON payload\");\n  }\n}\n\nexport function okResponse(): Response {\n  return new Response(null, { status: 204, headers: DEFAULT_CORS });\n}\n\nexport function isOptions(request: Request): boolean {\n  return request.method.toUpperCase() === \"OPTIONS\";\n}\n\nexport function asNumber(value: string | null, fallback: number): number {\n  if (!value) return fallback;\n  const parsed = Number(value);\n  return Number.isFinite(parsed) ? parsed : fallback;\n}\n\nexport type RouteHandler = (ctx: HandlerContext) => Promise<Response>;\n", "import { DBClient, CreatePostInput } from \"./interface\";\r\nimport {\n  Owner,\n  Post,\n  Account,\n  AdminAccount,\n  MediaAsset,\n  Comment,\n  CommentThread,\n  OwnerPublic,\n  FriendshipRequestItem,\n  Pet,\n  ChatThread,\n  ChatThreadParticipant,\n  ChatThreadListItem,\n  ChatMessage,\n  ChatRequestState\n} from \"./models\";\n\r\ntype PostRow = {\r\n  id: string;\r\n  owner_id: string;\r\n  content_text: string | null;\r\n  visibility: string;\r\n  post_type: string;\r\n  media_count: number;\r\n  like_count?: number | null;\r\n  comment_count?: number | null;\r\n  repost_count?: number | null;\r\n  origin_post_id?: string | null;\r\n  media_key?: string | null;\r\n  created_at: string;\r\n  is_deleted?: number | null;\r\n  author_handle?: string | null;\r\n  author_display_name?: string | null;\r\n  is_liked?: number | null;\r\n};\r\n\r\ntype CommentRow = {\r\n  id: string;\r\n  post_id: string;\r\n  owner_id: string;\r\n  parent_comment_id: string | null;\r\n  content_text: string;\r\n  created_at: string;\r\n  like_count?: number | null;\r\n  owner_display_name?: string | null;\r\n  is_liked?: number | null;\r\n};\r\n\r\ntype MediaAssetRow = {\r\n  id: string;\r\n  owner_id: string;\r\n  kind: string;\r\n  usage: string;\r\n  storage_provider: string;\r\n  storage_key: string;\r\n  url: string | null;\r\n  thumbnail_url: string | null;\r\n  mime_type: string | null;\r\n  size_bytes: number | null;\r\n  width: number | null;\r\n  height: number | null;\r\n  duration_sec: number | null;\r\n  status: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n};\r\n\r\ntype OwnerRow = {\r\n  account_id: string;\r\n  uuid: string;\r\n  email: string | null;\r\n  password_hash: string | null;\r\n  display_name: string;\r\n  avatar_url: string | null;\r\n  max_pets: number;\r\n  city: string | null;\r\n  region: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  is_active: number;\r\n  is_verified: number | null;\r\n  id_license_front_url: string | null;\r\n  id_license_back_url: string | null;\r\n  face_with_license_url: string | null;\r\n};\r\n\r\ntype OwnerPublicRow = {\r\n  uuid: string;\r\n  display_name: string;\r\n  avatar_url: string | null;\r\n  city: string | null;\r\n  region: string | null;\r\n};\r\n\r\ntype PetRow = {\r\n  id: string;\r\n  owner_id: string;\r\n  name: string;\r\n  class: string | null;\r\n  species: string | null;\r\n  breed: string | null;\r\n  gender: \"male\" | \"female\" | \"unknown\";\r\n  birthday: string | null;\r\n  avatar_asset_id: string | null;\r\n  avatar_url: string | null;\r\n  bio: string | null;\r\n  followers_count: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n  is_active: number;\r\n};\r\n\r\ntype AccountRow = {\r\n  account_id: string;\r\n  email: string;\r\n  password_hash: string;\r\n  real_name: string | null;\r\n  id_number: string | null;\r\n  phone_number: string | null;\r\n  is_verified: number;\r\n  id_license_front_url: string | null;\r\n  id_license_back_url: string | null;\r\n  face_with_license_url: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n};\r\n\r\ntype VerificationRow = {\r\n  account_id: string;\r\n  real_name: string | null;\r\n  id_number: string | null;\r\n  phone_number: string | null;\r\n  created_at: string;\r\n  is_verified: number;\r\n};\r\n\r\ntype AdminAccountRow = {\r\n  id: number;\r\n  admin_id: string;\r\n  password: string;\r\n  permission: string;\r\n  ip_allowlist: string;\r\n  created_at: string;\r\n  last_at: string | null;\r\n  updated_at: string;\r\n};\r\n\r\ntype FriendshipRow = {\n  status: string;\n  requested_by: string;\n};\n\ntype ChatThreadRow = {\n  id: string;\n  owner_a_id: string;\n  owner_b_id: string;\n  pair_key: string;\n  request_state: string;\n  request_sender_id: string | null;\n  request_message_id: string | null;\n  last_message_id: string | null;\n  last_activity_at: string | null;\n  created_at?: string | null;\n  updated_at?: string | null;\n};\n\ntype ChatThreadParticipantRow = {\n  thread_id: string;\n  owner_id: string;\n  last_read_message_id: string | null;\n  archived_at: string | null;\n  deleted_at: string | null;\n};\n\ntype ChatMessageRow = {\n  id: string;\n  thread_id: string;\n  sender_id: string;\n  body_text: string;\n  created_at: string;\n};\n\ntype ChatThreadListRow = {\n  thread_id: string;\n  request_state: string;\n  request_sender_id: string | null;\n  request_message_id: string | null;\n  last_message_id: string | null;\n  last_activity_at: string | null;\n  sort_activity: string | null;\n  last_read_message_id: string | null;\n  unread_count: number | null;\n  archived_at: string | null;\n  deleted_at: string | null;\n  other_uuid: string;\n  other_display_name: string;\n  other_avatar_url: string | null;\n  last_message_preview: string | null;\n};\n\r\nexport class D1Client implements DBClient {\r\n  private readonly db: D1Database;\r\n\r\n  constructor(db: D1Database) {\r\n    this.db = db;\r\n  }\r\n\r\n  async ping(): Promise<boolean> {\r\n    const row = await this.db.prepare(\"select 1 as ok\").first<{ ok: number }>();\r\n    return row?.ok === 1;\r\n  }\r\n\r\n  async createPost(input: CreatePostInput): Promise<Post> {\r\n    const id = crypto.randomUUID();\r\n    const createdAt = new Date().toISOString();\r\n    const visibility = input.visibility ?? \"public\";\r\n    const postType = input.postType ?? \"text\";\r\n    const mediaCount = input.mediaCount ?? 0;\r\n    const originPostId = input.originPostId ?? null;\r\n\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          insert into posts (\r\n            id, owner_id, content_text, visibility, post_type, media_count, origin_post_id, created_at, updated_at\r\n          )\r\n          values (?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n        `\r\n      )\r\n      .bind(id, input.authorId, input.body ?? null, visibility, postType, mediaCount, originPostId, createdAt, createdAt)\r\n      .run();\r\n\r\n    return {\r\n      id,\r\n      authorId: input.authorId,\r\n      body: input.body ?? null,\r\n      mediaKey: null,\r\n      createdAt,\r\n      visibility,\r\n      postType,\r\n      mediaCount,\r\n      originPostId,\r\n      repostCount: 0\r\n    };\r\n  }\r\n\r\n  async getPostsByOwner(ownerUuid: string, limit = 20, currentOwnerUuid?: string): Promise<Post[]> {\r\n    const joinLiked = !!currentOwnerUuid;\r\n    const sql = `\r\n      select\r\n        p.id,\r\n        p.owner_id,\r\n        p.content_text,\r\n        p.visibility,\r\n        p.post_type,\r\n        p.media_count,\r\n        p.like_count,\r\n        p.comment_count,\r\n        p.repost_count,\r\n        p.origin_post_id,\r\n        p.is_deleted,\r\n        p.created_at,\r\n        o.display_name as author_display_name\r\n        ${joinLiked ? \", case when pl.owner_id is not null then 1 else 0 end as is_liked\" : \"\"}\r\n      from posts p\r\n      left join owners o on o.uuid = p.owner_id\r\n      ${joinLiked ? \"left join post_likes pl on pl.post_id = p.id and pl.owner_id = ?\" : \"\"}\r\n      where p.owner_id = ? and p.is_deleted = 0\r\n      order by p.created_at desc\r\n      limit ?\r\n    `;\r\n    const params = joinLiked ? [currentOwnerUuid, ownerUuid, limit] : [ownerUuid, limit];\r\n    const { results } = await this.db.prepare(sql).bind(...params).all<PostRow>();\r\n\r\n    const posts = (results ?? []).map(mapPostRow);\r\n    await this.populateMedia(posts);\r\n    await this.populateOriginPosts(posts);\r\n    return posts;\r\n  }\r\n\r\n  async listRecentPosts(limit = 20, currentOwnerUuid?: string): Promise<Post[]> {\r\n    const joinLiked = !!currentOwnerUuid;\r\n    const sql = `\r\n      select\r\n        p.id,\r\n        p.owner_id,\r\n        p.content_text,\r\n        p.visibility,\r\n        p.post_type,\r\n        p.media_count,\r\n        p.like_count,\r\n        p.comment_count,\r\n        p.repost_count,\r\n        p.origin_post_id,\r\n        p.is_deleted,\r\n        p.created_at,\r\n        o.display_name as author_display_name\r\n        ${joinLiked ? \", case when pl.owner_id is not null then 1 else 0 end as is_liked\" : \"\"}\r\n      from posts p\r\n      left join owners o on o.uuid = p.owner_id\r\n      ${joinLiked ? \"left join post_likes pl on pl.post_id = p.id and pl.owner_id = ?\" : \"\"}\r\n      where p.is_deleted = 0\r\n      order by p.created_at desc\r\n      limit ?\r\n    `;\r\n    const params = joinLiked ? [currentOwnerUuid, limit] : [limit];\r\n    const { results } = await this.db.prepare(sql).bind(...params).all<PostRow>();\r\n\r\n    const posts = (results ?? []).map(mapPostRow);\r\n    await this.populateMedia(posts);\r\n    await this.populateOriginPosts(posts);\r\n    return posts;\r\n  }\r\n\r\n  async getPostById(id: string): Promise<Post | null> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            p.id,\r\n            p.owner_id,\r\n            p.content_text,\r\n            p.visibility,\r\n            p.post_type,\r\n            p.media_count,\r\n            p.like_count,\r\n            p.comment_count,\r\n            p.repost_count,\r\n            p.origin_post_id,\r\n            p.is_deleted,\r\n            p.created_at,\r\n            o.display_name as author_display_name\r\n          from posts p\r\n          left join owners o on o.uuid = p.owner_id\r\n          where p.id = ?\r\n        `\r\n      )\r\n      .bind(id)\r\n      .first<PostRow>();\r\n    if (!row) return null;\r\n    const post = mapPostRow(row);\r\n    await this.populateMedia([post]);\r\n    return post;\r\n  }\r\n\r\n  async createMediaAsset(input: {\r\n    ownerId: string;\r\n    kind: \"image\" | \"video\";\r\n    usage: \"avatar\" | \"pet_avatar\" | \"post\" | \"kyc\" | \"other\";\r\n    storageProvider: \"r2\" | \"cf_media\";\r\n    storageKey: string;\r\n    url?: string | null;\r\n    thumbnailUrl?: string | null;\r\n    mimeType?: string | null;\r\n    sizeBytes?: number | null;\r\n    width?: number | null;\r\n    height?: number | null;\r\n    durationSec?: number | null;\r\n    status?: \"uploaded\" | \"processing\" | \"ready\" | \"failed\";\r\n  }): Promise<MediaAsset> {\r\n    const id = crypto.randomUUID();\r\n    const now = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          insert into media_assets (\r\n            id, owner_id, kind, usage, storage_provider, storage_key, url, thumbnail_url, mime_type, size_bytes,\r\n            width, height, duration_sec, status, created_at, updated_at\r\n          )\r\n          values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n        `\r\n      )\r\n      .bind(\r\n        id,\r\n        input.ownerId,\r\n        input.kind,\r\n        input.usage,\r\n        input.storageProvider,\r\n        input.storageKey,\r\n        input.url ?? null,\r\n        input.thumbnailUrl ?? null,\r\n        input.mimeType ?? null,\r\n        input.sizeBytes ?? null,\r\n        input.width ?? null,\r\n        input.height ?? null,\r\n        input.durationSec ?? null,\r\n        input.status ?? \"uploaded\",\r\n        now,\r\n        now\r\n      )\r\n      .run();\r\n\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select id, owner_id, kind, usage, storage_provider, storage_key, url, thumbnail_url, mime_type, size_bytes,\r\n                 width, height, duration_sec, status, created_at, updated_at\r\n          from media_assets\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(id)\r\n      .first<MediaAssetRow>();\r\n\r\n    if (!row) throw new Error(\"Failed to create media asset\");\r\n    return mapMediaAssetRow(row);\r\n  }\r\n\r\n  async getMediaAssetsByIds(ids: string[]): Promise<MediaAsset[]> {\r\n    if (ids.length === 0) return [];\r\n    const placeholders = ids.map(() => \"?\").join(\",\");\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select id, owner_id, kind, usage, storage_provider, storage_key, url, thumbnail_url, mime_type, size_bytes,\r\n                 width, height, duration_sec, status, created_at, updated_at\r\n          from media_assets\r\n          where id in (${placeholders})\r\n        `\r\n      )\r\n      .bind(...ids)\r\n      .all<MediaAssetRow>();\r\n    return (results ?? []).map(mapMediaAssetRow);\r\n  }\r\n\r\n  async attachMediaToPost(postId: string, postType: \"image_set\" | \"video\", assetIds: string[]): Promise<void> {\r\n    const now = new Date().toISOString();\r\n    const inserts = assetIds.map((assetId, idx) =>\r\n      this.db\r\n        .prepare(\r\n          `\r\n            insert into post_media (id, post_id, asset_id, order_index, created_at)\r\n            values (?, ?, ?, ?, ?)\r\n          `\r\n        )\r\n        .bind(crypto.randomUUID(), postId, assetId, idx, now)\r\n        .run()\r\n    );\r\n    for (const p of inserts) {\r\n      await p;\r\n    }\r\n\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          update posts\r\n          set post_type = ?, media_count = ?, updated_at = ?\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(postType, assetIds.length, now, postId)\r\n      .run();\r\n  }\r\n\r\n  async listAdminPosts(limit = 20, offset = 0): Promise<Post[]> {\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            p.id,\r\n            p.owner_id,\r\n            p.content_text,\r\n            p.visibility,\r\n            p.post_type,\r\n            p.media_count,\r\n            p.is_deleted,\r\n            p.created_at,\r\n            o.display_name as author_display_name\r\n          from posts p\r\n          left join owners o on o.uuid = p.owner_id\r\n          order by p.created_at desc\r\n          limit ? offset ?\r\n        `\r\n      )\r\n      .bind(limit, offset)\r\n      .all<PostRow>();\r\n    const posts = (results ?? []).map(mapPostRow);\r\n    await this.populateMedia(posts);\r\n    return posts;\r\n  }\r\n\r\n  async markPostDeleted(postId: string): Promise<void> {\r\n    const row = await this.db\r\n      .prepare(`select origin_post_id from posts where id = ?`)\r\n      .bind(postId)\r\n      .first<{ origin_post_id: string | null }>();\r\n    const ts = new Date().toISOString();\r\n    await this.db.prepare(`update posts set is_deleted = 1, updated_at = ? where id = ?`).bind(ts, postId).run();\r\n    if (row?.origin_post_id) {\r\n      await this.updateRepostCount(row.origin_post_id);\r\n    }\r\n  }\r\n\r\n  async getPostAssets(postId: string): Promise<{ assetId: string; kind: string; storageKey: string }[]> {\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select ma.id as asset_id, ma.kind, ma.storage_key\r\n          from post_media pm\r\n          join media_assets ma on ma.id = pm.asset_id\r\n          where pm.post_id = ?\r\n          order by pm.order_index\r\n        `\r\n      )\r\n      .bind(postId)\r\n      .all<{ asset_id: string; kind: string; storage_key: string }>();\r\n    return (results ?? []).map((r) => ({ assetId: r.asset_id, kind: r.kind, storageKey: r.storage_key }));\r\n  }\r\n\r\n  async deletePostMediaAndAssets(postId: string, assetIds: string[]): Promise<void> {\r\n    if (assetIds.length === 0) return;\r\n    const placeholders = assetIds.map(() => \"?\").join(\",\");\r\n    await this.db\r\n      .prepare(`delete from post_media_pet_tags where media_id in (select id from post_media where post_id = ?)`)\r\n      .bind(postId)\r\n      .run();\r\n    await this.db.prepare(`delete from post_media where post_id = ?`).bind(postId).run();\r\n    await this.db.prepare(`delete from media_assets where id in (${placeholders})`).bind(...assetIds).run();\r\n  }\r\n\r\n  async deletePostCascade(postId: string, assetIds: string[]): Promise<void> {\r\n    const row = await this.db\r\n      .prepare(`select origin_post_id from posts where id = ?`)\r\n      .bind(postId)\r\n      .first<{ origin_post_id: string | null }>();\r\n    await this.deletePostMediaAndAssets(postId, assetIds);\r\n    await this.db.prepare(`delete from post_likes where post_id = ?`).bind(postId).run();\r\n    await this.db.prepare(`delete from post_comments where post_id = ?`).bind(postId).run();\r\n    await this.db.prepare(`delete from post_shares where post_id = ?`).bind(postId).run();\r\n    await this.db.prepare(`delete from posts where id = ?`).bind(postId).run();\r\n    if (row?.origin_post_id) {\r\n      await this.updateRepostCount(row.origin_post_id);\r\n    }\r\n  }\r\n\r\n  async hasLiked(postId: string, ownerId: string): Promise<boolean> {\r\n    const row = await this.db\r\n      .prepare(`select 1 from post_likes where post_id = ? and owner_id = ? limit 1`)\r\n      .bind(postId, ownerId)\r\n      .first();\r\n    return !!row;\r\n  }\r\n\r\n  async likePost(postId: string, ownerId: string): Promise<void> {\r\n    const now = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          insert into post_likes (post_id, owner_id, created_at)\r\n          values (?, ?, ?)\r\n        `\r\n      )\r\n      .bind(postId, ownerId, now)\r\n      .run();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          update posts\r\n          set like_count = (select count(*) from post_likes where post_id = ?)\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(postId, postId)\r\n      .run();\r\n  }\r\n\r\n  async unlikePost(postId: string, ownerId: string): Promise<void> {\r\n    await this.db.prepare(`delete from post_likes where post_id = ? and owner_id = ?`).bind(postId, ownerId).run();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          update posts\r\n          set like_count = (select count(*) from post_likes where post_id = ?)\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(postId, postId)\r\n      .run();\r\n  }\r\n\r\n  async toggleLike(postId: string, ownerId: string): Promise<{ isLiked: boolean; likeCount: number }> {\r\n    const now = new Date().toISOString();\r\n    const insertResult = await this.db\r\n      .prepare(\r\n        `insert into post_likes (post_id, owner_id, created_at)\r\n         values (?, ?, ?)\r\n         on conflict(post_id, owner_id) do nothing`\r\n      )\r\n      .bind(postId, ownerId, now)\r\n      .run();\r\n\r\n    const inserted = (insertResult as any)?.meta?.changes ?? 0;\r\n\r\n    if (inserted === 0) {\r\n      // Already liked, toggle off\r\n      await this.db.prepare(`delete from post_likes where post_id = ? and owner_id = ?`).bind(postId, ownerId).run();\r\n    }\r\n\r\n    const countRow = await this.db\r\n      .prepare(`select count(*) as c from post_likes where post_id = ?`)\r\n      .bind(postId)\r\n      .first<{ c: number }>();\r\n    const likeCount = countRow?.c ?? 0;\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          update posts\r\n          set like_count = ?\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(likeCount, postId)\r\n      .run();\r\n\r\n    return { isLiked: inserted > 0, likeCount };\r\n  }\r\n\r\n  async createComment(input: {\r\n    postId: string;\r\n    ownerId: string;\r\n    content: string;\r\n    parentCommentId?: string | null;\r\n  }): Promise<Comment> {\r\n    const id = crypto.randomUUID();\r\n    const now = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          insert into post_comments (\r\n            id, post_id, owner_id, parent_comment_id, content_text, created_at, updated_at, is_deleted, like_count\r\n          )\r\n          values (?, ?, ?, ?, ?, ?, ?, 0, 0)\r\n        `\r\n      )\r\n      .bind(id, input.postId, input.ownerId, input.parentCommentId ?? null, input.content, now, now)\r\n      .run();\r\n\r\n    await this.db.prepare(`update posts set comment_count = comment_count + 1 where id = ?`).bind(input.postId).run();\r\n\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            c.id,\r\n            c.post_id,\r\n            c.owner_id,\r\n            c.parent_comment_id,\r\n            c.content_text,\r\n            c.created_at,\r\n            c.like_count,\r\n            o.display_name as owner_display_name\r\n          from post_comments c\r\n          left join owners o on o.uuid = c.owner_id\r\n          where c.id = ?\r\n        `\r\n      )\r\n      .bind(id)\r\n      .first<CommentRow>();\r\n\r\n    if (!row) throw new Error(\"Failed to create comment\");\r\n    return mapCommentRow(row);\r\n  }\r\n\r\n  async getLatestComment(postId: string, currentOwnerUuid?: string): Promise<Comment | null> {\r\n    const joinLiked = !!currentOwnerUuid;\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            c.id,\r\n            c.post_id,\r\n            c.owner_id,\r\n            c.parent_comment_id,\r\n            c.content_text,\r\n            c.created_at,\r\n            c.like_count,\r\n            o.display_name as owner_display_name\r\n            ${joinLiked ? \", case when cl.owner_id is not null then 1 else 0 end as is_liked\" : \"\"}\r\n          from post_comments c\r\n          left join owners o on o.uuid = c.owner_id\r\n          ${joinLiked ? \"left join comment_likes cl on cl.comment_id = c.id and cl.owner_id = ?\" : \"\"}\r\n          where c.post_id = ? and c.is_deleted = 0\r\n          order by c.created_at desc, c.id desc\r\n          limit 1\r\n        `\r\n      )\r\n      .bind(...(joinLiked ? [currentOwnerUuid, postId] : [postId]))\r\n      .first<CommentRow>();\r\n    if (!row) return null;\r\n    return mapCommentRow(row);\r\n  }\r\n\r\n  async getCommentById(commentId: string, currentOwnerUuid?: string): Promise<Comment | null> {\r\n    const joinLiked = !!currentOwnerUuid;\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            c.id,\r\n            c.post_id,\r\n            c.owner_id,\r\n            c.parent_comment_id,\r\n            c.content_text,\r\n            c.created_at,\r\n            c.like_count,\r\n            o.display_name as owner_display_name\r\n            ${joinLiked ? \", case when cl.owner_id is not null then 1 else 0 end as is_liked\" : \"\"}\r\n          from post_comments c\r\n          left join owners o on o.uuid = c.owner_id\r\n          ${joinLiked ? \"left join comment_likes cl on cl.comment_id = c.id and cl.owner_id = ?\" : \"\"}\r\n          where c.id = ? and c.is_deleted = 0\r\n        `\r\n      )\r\n      .bind(...(joinLiked ? [currentOwnerUuid, commentId] : [commentId]))\r\n      .first<CommentRow>();\r\n    if (!row) return null;\r\n    return mapCommentRow(row);\r\n  }\r\n\r\n  async listPostCommentsThread(\r\n    postId: string,\r\n    limit: number,\r\n    cursor?: string | null,\r\n    currentOwnerUuid?: string\r\n  ): Promise<{ items: CommentThread[]; nextCursor: string | null; hasMore: boolean }> {\r\n    const safeLimit = Math.min(Math.max(limit, 1), 50);\r\n    const parsed = parseCommentCursor(cursor);\r\n    const joinLiked = !!currentOwnerUuid;\r\n    const clauses: string[] = [\"c.post_id = ?\", \"c.parent_comment_id is null\", \"c.is_deleted = 0\"];\r\n    const params: Array<string | number> = [];\r\n    if (joinLiked && currentOwnerUuid) params.push(currentOwnerUuid);\r\n    params.push(postId);\r\n\r\n    if (parsed) {\r\n      clauses.push(\"(c.created_at < ? or (c.created_at = ? and c.id < ?))\");\r\n      params.push(parsed.createdAt, parsed.createdAt, parsed.id);\r\n    }\r\n\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            c.id,\r\n            c.post_id,\r\n            c.owner_id,\r\n            c.parent_comment_id,\r\n            c.content_text,\r\n            c.created_at,\r\n            c.like_count,\r\n            o.display_name as owner_display_name\r\n            ${joinLiked ? \", case when cl.owner_id is not null then 1 else 0 end as is_liked\" : \"\"}\r\n          from post_comments c\r\n          left join owners o on o.uuid = c.owner_id\r\n          ${joinLiked ? \"left join comment_likes cl on cl.comment_id = c.id and cl.owner_id = ?\" : \"\"}\r\n          where ${clauses.join(\" and \")}\r\n          order by c.created_at desc, c.id desc\r\n          limit ?\r\n        `\r\n      )\r\n      .bind(...params, safeLimit + 1)\r\n      .all<CommentRow>();\r\n\r\n    const rows = results ?? [];\r\n    const hasMore = rows.length > safeLimit;\r\n    const pageRows = hasMore ? rows.slice(0, safeLimit) : rows;\r\n    const nextCursor = hasMore && pageRows.length > 0 ? toCommentCursor(pageRows[pageRows.length - 1]) : null;\r\n\r\n    if (pageRows.length === 0) {\r\n      return { items: [], nextCursor, hasMore };\r\n    }\r\n\r\n    const parentIds = pageRows.map((row) => row.id);\r\n    const placeholders = parentIds.map(() => \"?\").join(\",\");\r\n    const { results: replyRows } = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            c.id,\r\n            c.post_id,\r\n            c.owner_id,\r\n            c.parent_comment_id,\r\n            c.content_text,\r\n            c.created_at,\r\n            c.like_count,\r\n            o.display_name as owner_display_name\r\n            ${joinLiked ? \", case when cl.owner_id is not null then 1 else 0 end as is_liked\" : \"\"}\r\n          from post_comments c\r\n          left join owners o on o.uuid = c.owner_id\r\n          ${joinLiked ? \"left join comment_likes cl on cl.comment_id = c.id and cl.owner_id = ?\" : \"\"}\r\n          where c.post_id = ? and c.parent_comment_id in (${placeholders}) and c.is_deleted = 0\r\n          order by c.created_at asc, c.id asc\r\n        `\r\n      )\r\n      .bind(...(joinLiked && currentOwnerUuid ? [currentOwnerUuid, postId] : [postId]), ...parentIds)\r\n      .all<CommentRow>();\r\n\r\n    const repliesByParent = new Map<string, Comment[]>();\r\n    for (const row of replyRows ?? []) {\r\n      const mapped = mapCommentRow(row);\r\n      const parentId = mapped.parentCommentId;\r\n      if (!parentId) continue;\r\n      const list = repliesByParent.get(parentId) ?? [];\r\n      list.push(mapped);\r\n      repliesByParent.set(parentId, list);\r\n    }\r\n\r\n    const items = pageRows.map((row) => {\r\n      const mapped = mapCommentRow(row);\r\n      return { ...mapped, replies: repliesByParent.get(mapped.id) ?? [] };\r\n    });\r\n\r\n    return { items, nextCursor, hasMore };\r\n  }\r\n\r\n  async toggleCommentLike(commentId: string, ownerId: string): Promise<{ isLiked: boolean; likeCount: number }> {\r\n    const now = new Date().toISOString();\r\n    const insertResult = await this.db\r\n      .prepare(\r\n        `insert into comment_likes (comment_id, owner_id, created_at)\r\n         values (?, ?, ?)\r\n         on conflict(comment_id, owner_id) do nothing`\r\n      )\r\n      .bind(commentId, ownerId, now)\r\n      .run();\r\n\r\n    const inserted = (insertResult as any)?.meta?.changes ?? 0;\r\n    if (inserted === 0) {\r\n      await this.db.prepare(`delete from comment_likes where comment_id = ? and owner_id = ?`).bind(commentId, ownerId).run();\r\n    }\r\n\r\n    const countRow = await this.db\r\n      .prepare(`select count(*) as c from comment_likes where comment_id = ?`)\r\n      .bind(commentId)\r\n      .first<{ c: number }>();\r\n    const likeCount = countRow?.c ?? 0;\r\n    await this.db.prepare(`update post_comments set like_count = ? where id = ?`).bind(likeCount, commentId).run();\r\n\r\n    return { isLiked: inserted > 0, likeCount };\r\n  }\r\n\r\n  async updateRepostCount(postId: string): Promise<number> {\r\n    const countRow = await this.db\r\n      .prepare(`select count(*) as c from posts where origin_post_id = ? and is_deleted = 0`)\r\n      .bind(postId)\r\n      .first<{ c: number }>();\r\n    const repostCount = countRow?.c ?? 0;\r\n    const now = new Date().toISOString();\r\n    await this.db.prepare(`update posts set repost_count = ?, updated_at = ? where id = ?`).bind(repostCount, now, postId).run();\r\n    return repostCount;\r\n  }\r\n\r\n  async isFriends(ownerId: string, friendId: string): Promise<boolean> {\n    const row = await this.db\n      .prepare(\n        `\n          select 1\n          from owner_friendships\n          where status = 'accepted'\r\n            and ((owner_id = ? and friend_id = ?) or (owner_id = ? and friend_id = ?))\r\n          limit 1\r\n        `\r\n      )\n      .bind(ownerId, friendId, friendId, ownerId)\n      .first();\n    return !!row;\n  }\n\n  async getChatThreadById(threadId: string): Promise<ChatThread | null> {\n    const row = await this.db\n      .prepare(\n        `\n          select\n            id,\n            owner_a_id,\n            owner_b_id,\n            pair_key,\n            request_state,\n            request_sender_id,\n            request_message_id,\n            last_message_id,\n            last_activity_at,\n            created_at,\n            updated_at\n          from chat_threads\n          where id = ?\n        `\n      )\n      .bind(threadId)\n      .first<ChatThreadRow>();\n    return row ? mapChatThreadRow(row) : null;\n  }\n\n  async getChatThreadByPairKey(pairKey: string): Promise<ChatThread | null> {\n    const row = await this.db\n      .prepare(\n        `\n          select\n            id,\n            owner_a_id,\n            owner_b_id,\n            pair_key,\n            request_state,\n            request_sender_id,\n            request_message_id,\n            last_message_id,\n            last_activity_at,\n            created_at,\n            updated_at\n          from chat_threads\n          where pair_key = ?\n          limit 1\n        `\n      )\n      .bind(pairKey)\n      .first<ChatThreadRow>();\n    return row ? mapChatThreadRow(row) : null;\n  }\n\n  async createChatThread(input: {\n    threadId: string;\n    ownerAId: string;\n    ownerBId: string;\n    pairKey: string;\n    requestState: ChatRequestState;\n    requestSenderId?: string | null;\n    requestMessageId?: string | null;\n    lastMessageId?: string | null;\n    lastActivityAt?: string | null;\n  }): Promise<ChatThread> {\n    await this.db\n      .prepare(\n        `\n          insert into chat_threads (\n            id,\n            owner_a_id,\n            owner_b_id,\n            pair_key,\n            request_state,\n            request_sender_id,\n            request_message_id,\n            last_message_id,\n            last_activity_at,\n            created_at,\n            updated_at\n          )\n          values (?, ?, ?, ?, ?, ?, ?, ?, coalesce(?, datetime('now')), datetime('now'), datetime('now'))\n        `\n      )\n      .bind(\n        input.threadId,\n        input.ownerAId,\n        input.ownerBId,\n        input.pairKey,\n        input.requestState,\n        input.requestSenderId ?? null,\n        input.requestMessageId ?? null,\n        input.lastMessageId ?? null,\n        input.lastActivityAt ?? null\n      )\n      .run();\n\n    const thread = await this.getChatThreadById(input.threadId);\n    if (!thread) {\n      throw new Error(\"chat thread insert failed\");\n    }\n    return thread;\n  }\n\n  async upsertChatParticipants(threadId: string, ownerAId: string, ownerBId: string): Promise<void> {\n    await this.db\n      .prepare(\n        `\n          insert or ignore into chat_thread_participants (thread_id, owner_id)\n          values (?, ?), (?, ?)\n        `\n      )\n      .bind(threadId, ownerAId, threadId, ownerBId)\n      .run();\n  }\n\n  async getChatParticipant(threadId: string, ownerId: string): Promise<ChatThreadParticipant | null> {\n    const row = await this.db\n      .prepare(\n        `\n          select\n            thread_id,\n            owner_id,\n            last_read_message_id,\n            archived_at,\n            deleted_at\n          from chat_thread_participants\n          where thread_id = ? and owner_id = ?\n          limit 1\n        `\n      )\n      .bind(threadId, ownerId)\n      .first<ChatThreadParticipantRow>();\n    return row ? mapChatThreadParticipantRow(row) : null;\n  }\n\n  async setParticipantArchived(threadId: string, ownerId: string, archivedAt: string | null): Promise<void> {\n    if (archivedAt === null) {\n      await this.db\n        .prepare(`update chat_thread_participants set archived_at = null where thread_id = ? and owner_id = ?`)\n        .bind(threadId, ownerId)\n        .run();\n      return;\n    }\n    await this.db\n      .prepare(`update chat_thread_participants set archived_at = ? where thread_id = ? and owner_id = ?`)\n      .bind(archivedAt, threadId, ownerId)\n      .run();\n  }\n\n  async setParticipantDeleted(threadId: string, ownerId: string, deletedAt: string | null): Promise<void> {\n    if (deletedAt === null) {\n      await this.db\n        .prepare(`update chat_thread_participants set deleted_at = null where thread_id = ? and owner_id = ?`)\n        .bind(threadId, ownerId)\n        .run();\n      return;\n    }\n    await this.db\n      .prepare(`update chat_thread_participants set deleted_at = ? where thread_id = ? and owner_id = ?`)\n      .bind(deletedAt, threadId, ownerId)\n      .run();\n  }\n\n  async setParticipantLastRead(threadId: string, ownerId: string, messageId: string | null): Promise<void> {\n    await this.db\n      .prepare(`update chat_thread_participants set last_read_message_id = ? where thread_id = ? and owner_id = ?`)\n      .bind(messageId, threadId, ownerId)\n      .run();\n  }\n\n  async clearParticipantsArchiveDeleted(threadId: string): Promise<void> {\n    await this.db\n      .prepare(`update chat_thread_participants set archived_at = null, deleted_at = null where thread_id = ?`)\n      .bind(threadId)\n      .run();\n  }\n\n  async insertChatMessage(threadId: string, senderId: string, bodyText: string): Promise<ChatMessage> {\n    const id = crypto.randomUUID();\n    await this.db\n      .prepare(`insert into chat_messages (id, thread_id, sender_id, body_text) values (?, ?, ?, ?)`)\n      .bind(id, threadId, senderId, bodyText)\n      .run();\n    const row = await this.db\n      .prepare(\n        `\n          select\n            id,\n            thread_id,\n            sender_id,\n            body_text,\n            created_at\n          from chat_messages\n          where id = ?\n        `\n      )\n      .bind(id)\n      .first<ChatMessageRow>();\n    if (row) return mapChatMessageRow(row);\n    return { id, threadId, senderId, bodyText, createdAt: new Date().toISOString() };\n  }\n\n  async getChatMessageById(messageId: string): Promise<ChatMessage | null> {\n    const row = await this.db\n      .prepare(\n        `\n          select\n            id,\n            thread_id,\n            sender_id,\n            body_text,\n            created_at\n          from chat_messages\n          where id = ?\n          limit 1\n        `\n      )\n      .bind(messageId)\n      .first<ChatMessageRow>();\n    return row ? mapChatMessageRow(row) : null;\n  }\n\n  async listChatThreadsForOwner(\n    ownerId: string,\n    limit: number,\n    cursor?: string | null,\n    includeArchived?: boolean\n  ): Promise<{ items: ChatThreadListItem[]; nextCursor: string | null }> {\n    const safeLimit = Math.min(Math.max(limit, 1), 50);\n    let parsed = parseChatThreadCursor(cursor);\n    if (!parsed && cursor) {\n      const anchor = await this.getChatThreadById(cursor);\n      const activityAt = anchor?.lastActivityAt ?? anchor?.updatedAt ?? anchor?.createdAt;\n      if (activityAt) {\n        parsed = { activityAt, id: anchor.id };\n      }\n    }\n    const clauses: string[] = [\"p.owner_id = ?\"];\n    const params: Array<string> = [ownerId, ownerId];\n    if (!includeArchived) {\n      clauses.push(\"p.archived_at is null\");\n    }\n    clauses.push(\"p.deleted_at is null\");\n\n    const sortExpr = \"coalesce(t.last_activity_at, t.updated_at, t.created_at)\";\n\n    if (parsed) {\n      if (parsed.id) {\n        clauses.push(`(${sortExpr} < ? or (${sortExpr} = ? and t.id < ?))`);\n        params.push(parsed.activityAt, parsed.activityAt, parsed.id);\n      } else {\n        clauses.push(`${sortExpr} < ?`);\n        params.push(parsed.activityAt);\n      }\n    }\n\n    const { results } = await this.db\n      .prepare(\n        `\n          select\n            t.id as thread_id,\n            t.request_state,\n            t.request_sender_id,\n            t.request_message_id,\n            t.last_message_id,\n            t.last_activity_at,\n            ${sortExpr} as sort_activity,\n            p.last_read_message_id,\n            (\n              select count(*)\n              from chat_messages cm\n              where cm.thread_id = t.id\n                and cm.sender_id <> p.owner_id\n                and (\n                  lr.created_at is null\n                  or cm.created_at > lr.created_at\n                  or (cm.created_at = lr.created_at and cm.id > lr.id)\n                )\n            ) as unread_count,\n            p.archived_at,\n            p.deleted_at,\n            o.uuid as other_uuid,\n            o.display_name as other_display_name,\n            o.avatar_url as other_avatar_url,\n            m.body_text as last_message_preview\n          from chat_thread_participants p\n          join chat_threads t on t.id = p.thread_id\n          join owners o on o.uuid = case when t.owner_a_id = ? then t.owner_b_id else t.owner_a_id end\n          left join chat_messages m on m.id = t.last_message_id\n          left join chat_messages lr on lr.id = p.last_read_message_id\n          where ${clauses.join(\" and \")}\n          order by sort_activity desc, t.id desc\n          limit ?\n        `\n      )\n      .bind(...params, safeLimit + 1)\n      .all<ChatThreadListRow>();\n\n    const rows = results ?? [];\n    const hasMore = rows.length > safeLimit;\n    const pageRows = hasMore ? rows.slice(0, safeLimit) : rows;\n    const nextCursor = hasMore && pageRows.length > 0 ? toChatThreadCursor(pageRows[pageRows.length - 1]) : null;\n\n    return { items: pageRows.map(mapChatThreadListRow), nextCursor };\n  }\n\n  async getChatThreadForOwner(threadId: string, ownerId: string): Promise<ChatThreadListItem | null> {\n    const sortExpr = \"coalesce(t.last_activity_at, t.updated_at, t.created_at)\";\n    const row = await this.db\n      .prepare(\n        `\n          select\n            t.id as thread_id,\n            t.request_state,\n            t.request_sender_id,\n            t.request_message_id,\n            t.last_message_id,\n            t.last_activity_at,\n            ${sortExpr} as sort_activity,\n            p.last_read_message_id,\n            (\n              select count(*)\n              from chat_messages cm\n              where cm.thread_id = t.id\n                and cm.sender_id <> p.owner_id\n                and (\n                  lr.created_at is null\n                  or cm.created_at > lr.created_at\n                  or (cm.created_at = lr.created_at and cm.id > lr.id)\n                )\n            ) as unread_count,\n            p.archived_at,\n            p.deleted_at,\n            o.uuid as other_uuid,\n            o.display_name as other_display_name,\n            o.avatar_url as other_avatar_url,\n            m.body_text as last_message_preview\n          from chat_thread_participants p\n          join chat_threads t on t.id = p.thread_id\n          join owners o on o.uuid = case when t.owner_a_id = ? then t.owner_b_id else t.owner_a_id end\n          left join chat_messages m on m.id = t.last_message_id\n          left join chat_messages lr on lr.id = p.last_read_message_id\n          where p.owner_id = ? and t.id = ?\n          limit 1\n        `\n      )\n      .bind(ownerId, ownerId, threadId)\n      .first<ChatThreadListRow>();\n    return row ? mapChatThreadListRow(row) : null;\n  }\n\n  async listChatMessages(\n    threadId: string,\n    limit: number,\n    beforeCursor?: string | null\n  ): Promise<{ items: ChatMessage[]; nextCursor: string | null }> {\n    const safeLimit = Math.min(Math.max(limit, 1), 50);\n    let parsed = parseChatMessageCursor(beforeCursor);\n    if (!parsed && beforeCursor) {\n      if (looksLikeTimestamp(beforeCursor)) {\n        parsed = { createdAt: beforeCursor };\n      } else {\n        const anchor = await this.db\n          .prepare(`select created_at from chat_messages where id = ?`)\n          .bind(beforeCursor)\n          .first<{ created_at: string }>();\n        if (anchor?.created_at) {\n          parsed = { createdAt: anchor.created_at, id: beforeCursor };\n        }\n      }\n    }\n    const clauses: string[] = [\"thread_id = ?\"];\n    const params: Array<string> = [threadId];\n\n    if (parsed) {\n      if (parsed.id) {\n        clauses.push(\"(created_at < ? or (created_at = ? and id < ?))\");\n        params.push(parsed.createdAt, parsed.createdAt, parsed.id);\n      } else {\n        clauses.push(\"created_at < ?\");\n        params.push(parsed.createdAt);\n      }\n    }\n\n    const { results } = await this.db\n      .prepare(\n        `\n          select\n            id,\n            thread_id,\n            sender_id,\n            body_text,\n            created_at\n          from chat_messages\n          where ${clauses.join(\" and \")}\n          order by created_at desc, id desc\n          limit ?\n        `\n      )\n      .bind(...params, safeLimit + 1)\n      .all<ChatMessageRow>();\n\n    const rows = results ?? [];\n    const hasMore = rows.length > safeLimit;\n    const pageRows = hasMore ? rows.slice(0, safeLimit) : rows;\n    const nextCursor = hasMore && pageRows.length > 0 ? toChatMessageCursor(pageRows[pageRows.length - 1]) : null;\n    const items = pageRows.slice().reverse().map(mapChatMessageRow);\n\n    return { items, nextCursor };\n  }\n\n  async updateChatThreadOnNewMessage(\n    threadId: string,\n    lastMessageId: string,\n    options?: { requestMessageId?: string | null; requestSenderId?: string | null }\n  ): Promise<void> {\n    const updates: string[] = [\"last_message_id = ?\", \"last_activity_at = datetime('now')\", \"updated_at = datetime('now')\"];\n    const params: Array<string> = [lastMessageId];\n    if (options?.requestMessageId) {\n      updates.push(\"request_message_id = ?\");\n      params.push(options.requestMessageId);\n    }\n    if (options?.requestSenderId) {\n      updates.push(\"request_sender_id = ?\");\n      params.push(options.requestSenderId);\n    }\n    await this.db\n      .prepare(`update chat_threads set ${updates.join(\", \")} where id = ?`)\n      .bind(...params, threadId)\n      .run();\n  }\n\n  async updateChatThreadRequestState(\n    threadId: string,\n    requestState: ChatRequestState,\n    requestSenderId?: string | null,\n    requestMessageId?: string | null\n  ): Promise<void> {\n    const updates: string[] = [\"request_state = ?\", \"updated_at = datetime('now')\"];\n    const params: Array<string | null> = [requestState];\n    if (requestSenderId !== undefined) {\n      updates.push(\"request_sender_id = ?\");\n      params.push(requestSenderId ?? null);\n    }\n    if (requestMessageId !== undefined) {\n      updates.push(\"request_message_id = ?\");\n      params.push(requestMessageId ?? null);\n    }\n    await this.db\n      .prepare(`update chat_threads set ${updates.join(\", \")} where id = ?`)\n      .bind(...params, threadId)\n      .run();\n  }\n\r\n  private async populateOriginPosts(posts: Post[]): Promise<void> {\r\n    const originIds = Array.from(new Set(posts.map((post) => post.originPostId).filter((id): id is string => !!id)));\r\n    if (originIds.length === 0) return;\r\n    const placeholders = originIds.map(() => \"?\").join(\",\");\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            p.id,\r\n            p.owner_id,\r\n            p.content_text,\r\n            p.visibility,\r\n            p.post_type,\r\n            p.media_count,\r\n            p.like_count,\r\n            p.comment_count,\r\n            p.repost_count,\r\n            p.origin_post_id,\r\n            p.is_deleted,\r\n            p.created_at,\r\n            o.display_name as author_display_name\r\n          from posts p\r\n          left join owners o on o.uuid = p.owner_id\r\n          where p.id in (${placeholders})\r\n        `\r\n      )\r\n      .bind(...originIds)\r\n      .all<PostRow>();\r\n\r\n    const originPosts = (results ?? []).map(mapPostRow);\r\n    await this.populateMedia(originPosts);\r\n\r\n    const byId = new Map(originPosts.map((post) => [post.id, post]));\r\n    for (const post of posts) {\r\n      const originId = post.originPostId ?? null;\r\n      if (!originId) continue;\r\n      const origin = byId.get(originId);\r\n      if (origin) {\r\n        post.originPost = origin;\r\n      } else {\r\n        post.originPost = {\r\n          id: originId,\r\n          authorId: \"\",\r\n          body: null,\r\n          mediaKey: null,\r\n          createdAt: \"\",\r\n          isDeleted: 1,\r\n          repostCount: 0\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  private async populateMedia(posts: Post[]): Promise<void> {\r\n    if (posts.length === 0) return;\r\n    const ids = posts.map((p) => p.id);\r\n    const placeholders = ids.map(() => \"?\").join(\",\");\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select pm.post_id, ma.url\r\n          from post_media pm\r\n          join media_assets ma on ma.id = pm.asset_id\r\n          where pm.post_id in (${placeholders})\r\n          order by pm.post_id, pm.order_index\r\n        `\r\n      )\r\n      .bind(...ids)\r\n      .all<{ post_id: string; url: string | null }>();\r\n\r\n    const grouped = new Map<string, string[]>();\r\n    for (const row of results ?? []) {\r\n      const arr = grouped.get(row.post_id) ?? [];\r\n      if (row.url) arr.push(this.sanitizeStreamUrl(row.url));\r\n      grouped.set(row.post_id, arr);\r\n    }\r\n    for (const p of posts) {\r\n      p.mediaUrls = grouped.get(p.id) ?? [];\r\n    }\r\n  }\r\n\r\n  // Fix legacy/badly formatted Cloudflare Stream URLs that might contain duplicated customer- or host segments.\r\n  // Example bad: https://customer-customer-abc.cloudflarestream.com.cloudflarestream.com/uid/manifest/video.m3u8\r\n  // Example good: https://customer-abc.cloudflarestream.com/uid/manifest/video.m3u8\r\n  private sanitizeStreamUrl(url: string | null): string | null {\r\n    if (!url) return url;\r\n    let cleaned = url.replace(/customer-customer-/gi, \"customer-\");\r\n    cleaned = cleaned.replace(/\\.cloudflarestream\\.com\\.cloudflarestream\\.com/gi, \".cloudflarestream.com\");\r\n    return cleaned;\r\n  }\r\n\r\n  async getOwnerByEmail(email: string): Promise<Owner | null> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            o.account_id,\r\n            o.uuid,\r\n            a.email,\r\n            a.password_hash,\r\n            o.display_name,\r\n            o.avatar_url,\r\n            o.max_pets,\r\n            o.city,\r\n            o.region,\r\n            o.created_at,\r\n            o.updated_at,\r\n            o.is_active,\r\n            a.is_verified,\r\n            a.id_license_front_url,\r\n            a.id_license_back_url,\r\n            a.face_with_license_url\r\n          from owners o\r\n          join accounts a on a.id = o.account_id\r\n          where a.email = ?\r\n        `\r\n      )\r\n      .bind(email)\r\n      .first<OwnerRow>();\r\n\r\n    return row ? mapOwnerRow(row) : null;\r\n  }\r\n\r\n  async getOwnerByUuid(uuid: string): Promise<Owner | null> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            o.account_id,\r\n            o.uuid,\r\n            a.email,\r\n            a.password_hash,\r\n            o.display_name,\r\n            o.avatar_url,\r\n            o.max_pets,\r\n            o.city,\r\n            o.region,\r\n            o.created_at,\r\n            o.updated_at,\r\n            o.is_active,\r\n            a.is_verified,\r\n            a.id_license_front_url,\r\n            a.id_license_back_url,\r\n            a.face_with_license_url\r\n          from owners o\r\n          join accounts a on a.id = o.account_id\r\n          where o.uuid = ?\r\n        `\r\n      )\r\n      .bind(uuid)\r\n      .first<OwnerRow>();\r\n\r\n    return row ? mapOwnerRow(row) : null;\r\n  }\r\n\r\n  async getOwnerByAccountId(accountId: string): Promise<Owner | null> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            o.account_id,\r\n            o.uuid,\r\n            a.email,\r\n            a.password_hash,\r\n            o.display_name,\r\n            o.avatar_url,\r\n            o.max_pets,\r\n            o.city,\r\n            o.region,\r\n            o.created_at,\r\n            o.updated_at,\r\n            o.is_active,\r\n            a.is_verified,\r\n            a.id_license_front_url,\r\n            a.id_license_back_url,\r\n            a.face_with_license_url\r\n          from owners o\r\n          join accounts a on a.id = o.account_id\r\n          where o.account_id = ?\r\n        `\r\n      )\r\n      .bind(accountId)\r\n      .first<OwnerRow>();\r\n\r\n    return row ? mapOwnerRow(row) : null;\r\n  }\r\n\r\n  async searchOwnersByDisplayName(\r\n    keyword: string,\r\n    limit: number,\r\n    excludeOwnerUuid: string\r\n  ): Promise<OwnerPublic[]> {\r\n    const kw = keyword.trim().toLowerCase();\r\n    const rows = await this.db\r\n      .prepare(\r\n        `\r\n        select uuid, display_name, avatar_url, city, region\r\n        from owners\r\n        where uuid != ?\r\n          and (\r\n            display_name = ?\r\n            or display_name like (? || '%')\r\n          )\r\n        order by\r\n          case\r\n            when display_name = ? then 0\r\n            when display_name like (? || '%') then 1\r\n            else 3\r\n          end,\r\n          length(display_name) asc,\r\n          display_name asc\r\n        limit ?\r\n        `\r\n      )\r\n      .bind(excludeOwnerUuid, kw, kw, kw, kw, limit)\r\n      .all<OwnerPublicRow>();\r\n\r\n    return (rows.results ?? []).map(mapOwnerPublicRow);\r\n  }\r\n\r\n  async getFriendshipRowByPairKey(pairKey: string): Promise<{ status: string; requestedBy: string } | null> {\r\n    const row = await this.db\r\n      .prepare(`select status, requested_by from owner_friendships where pair_key = ?`)\r\n      .bind(pairKey)\r\n      .first<FriendshipRow>();\r\n\r\n    return row ? { status: row.status, requestedBy: row.requested_by } : null;\r\n  }\r\n\r\n  async createFriendRequest(input: {\n    ownerA: string;\n    ownerB: string;\n    requestedBy: string;\n    pairKey: string;\n  }): Promise<number> {\n    const res = await this.db\n      .prepare(\n        `\n        insert into owner_friendships (owner_id, friend_id, status, requested_by, pair_key)\n        values (?, ?, 'pending', ?, ?)\n        `\n      )\n      .bind(input.ownerA, input.ownerB, input.requestedBy, input.pairKey)\n      .run();\n    return ((res as { meta?: { last_row_id?: number } })?.meta?.last_row_id ?? 0) as number;\n  }\n\r\n  async deletePendingRequest(pairKey: string, requestedBy: string): Promise<number> {\r\n    const res = await this.db\r\n      .prepare(`delete from owner_friendships where pair_key = ? and status = 'pending' and requested_by = ?`)\r\n      .bind(pairKey, requestedBy)\r\n      .run();\r\n    return res.meta.changes ?? 0;\r\n  }\r\n\r\n  async deletePendingIncoming(pairKey: string, me: string): Promise<number> {\r\n    const res = await this.db\r\n      .prepare(`delete from owner_friendships where pair_key = ? and status = 'pending' and requested_by != ?`)\r\n      .bind(pairKey, me)\r\n      .run();\r\n    return res.meta.changes ?? 0;\r\n  }\r\n\r\n  async acceptPendingIncoming(pairKey: string, me: string): Promise<number> {\r\n    const res = await this.db\r\n      .prepare(\r\n        `\r\n        update owner_friendships\r\n        set status = 'accepted', updated_at = datetime('now')\r\n        where pair_key = ? and status = 'pending' and requested_by != ?\r\n        `\r\n      )\r\n      .bind(pairKey, me)\r\n      .run();\r\n    return res.meta.changes ?? 0;\r\n  }\r\n\r\n  async deleteFriendship(pairKey: string): Promise<number> {\r\n    const res = await this.db\r\n      .prepare(`delete from owner_friendships where pair_key = ? and status = 'accepted'`)\r\n      .bind(pairKey)\r\n      .run();\r\n    return res.meta.changes ?? 0;\r\n  }\r\n\r\n  async listIncomingRequests(\r\n    me: string,\r\n    limit: number\r\n  ): Promise<FriendshipRequestItem[]> {\r\n    const rows = await this.db\r\n      .prepare(\r\n        `\r\n        select\r\n          o.uuid, o.display_name, o.avatar_url, o.city, o.region,\r\n          f.created_at\r\n        from owner_friendships f\r\n        join owners o\r\n          on o.uuid = (case when f.owner_id = ? then f.friend_id else f.owner_id end)\r\n        where f.status = 'pending'\r\n          and (f.owner_id = ? or f.friend_id = ?)\r\n          and f.requested_by != ?\r\n        order by f.created_at desc\r\n        limit ?\r\n        `\r\n      )\r\n      .bind(me, me, me, me, limit)\r\n      .all<{\r\n        uuid: string;\r\n        display_name: string;\r\n        avatar_url: string | null;\r\n        city: string | null;\r\n        region: string | null;\r\n        created_at: string;\r\n      }>();\r\n\r\n    return (rows.results ?? []).map((row) => ({\r\n      otherOwner: mapOwnerPublicRow(row as OwnerPublicRow),\r\n      createdAt: row.created_at\r\n    }));\r\n  }\r\n\r\n  async listOutgoingRequests(\n    me: string,\n    limit: number\n  ): Promise<FriendshipRequestItem[]> {\n    const rows = await this.db\r\n      .prepare(\r\n        `\r\n        select\r\n          o.uuid, o.display_name, o.avatar_url, o.city, o.region,\r\n          f.created_at\r\n        from owner_friendships f\r\n        join owners o\r\n          on o.uuid = (case when f.owner_id = ? then f.friend_id else f.owner_id end)\r\n        where f.status = 'pending'\r\n          and f.requested_by = ?\r\n        order by f.created_at desc\r\n        limit ?\r\n        `\r\n      )\r\n      .bind(me, me, limit)\r\n      .all<{\r\n        uuid: string;\r\n        display_name: string;\r\n        avatar_url: string | null;\r\n        city: string | null;\r\n        region: string | null;\r\n        created_at: string;\r\n      }>();\r\n\r\n    return (rows.results ?? []).map((row) => ({\n      otherOwner: mapOwnerPublicRow(row as OwnerPublicRow),\n      createdAt: row.created_at\n    }));\n  }\n\n  async listFriends(me: string, limit: number): Promise<OwnerPublic[]> {\n    const rows = await this.db\n      .prepare(\n        `\n        select\n          o.uuid, o.display_name, o.avatar_url, o.city, o.region\n        from owner_friendships f\n        join owners o\n          on o.uuid = (case when f.owner_id = ? then f.friend_id else f.owner_id end)\n        where f.status = 'accepted'\n          and (f.owner_id = ? or f.friend_id = ?)\n        order by f.updated_at desc\n        limit ?\n        `\n      )\n      .bind(me, me, me, limit)\n      .all<OwnerPublicRow>();\n\n    return (rows.results ?? []).map(mapOwnerPublicRow);\n  }\n\r\n  async countActivePetsByOwner(ownerId: string): Promise<number> {\r\n    const row = await this.db\r\n      .prepare(`select count(*) as c from pets where owner_id = ? and is_active = 1`)\r\n      .bind(ownerId)\r\n      .first<{ c: number }>();\r\n    return row?.c ?? 0;\r\n  }\r\n\r\n  async listPetsByOwner(ownerId: string): Promise<Array<{ id: string; name: string; avatarUrl: string | null }>> {\r\n    const rows = await this.db\r\n      .prepare(\r\n        `\r\n          select id, name, avatar_url\r\n          from pets\r\n          where owner_id = ? and is_active = 1\r\n          order by created_at desc\r\n        `\r\n      )\r\n      .bind(ownerId)\r\n      .all<{ id: string; name: string; avatar_url: string | null }>();\r\n\r\n    return (rows.results ?? []).map((row) => ({\r\n      id: row.id,\r\n      name: row.name,\r\n      avatarUrl: row.avatar_url ?? null\r\n    }));\r\n  }\r\n\r\n  async isPetOwnedByOwner(petId: string, ownerId: string): Promise<boolean> {\r\n    const row = await this.db\r\n      .prepare(`select 1 as ok from pets where id = ? and owner_id = ? limit 1`)\r\n      .bind(petId, ownerId)\r\n      .first<{ ok: number }>();\r\n    return row?.ok === 1;\r\n  }\r\n\r\n  async isFollowingPet(followerOwnerId: string, petId: string): Promise<boolean> {\r\n    const row = await this.db\r\n      .prepare(`select 1 as ok from pet_follows where follower_owner_id = ? and pet_id = ? limit 1`)\r\n      .bind(followerOwnerId, petId)\r\n      .first<{ ok: number }>();\r\n    return row?.ok === 1;\r\n  }\r\n\r\n  async followPetTx(followerOwnerId: string, petId: string): Promise<number> {\r\n    const now = new Date().toISOString();\r\n    const [_, __, countResult] = await this.db.batch([\r\n      this.db\r\n        .prepare(\r\n          `\r\n            insert into pet_follows (follower_owner_id, pet_id, created_at)\r\n            values (?, ?, ?)\r\n            on conflict(follower_owner_id, pet_id) do nothing\r\n          `\r\n        )\r\n        .bind(followerOwnerId, petId, now),\r\n      this.db\r\n        .prepare(\r\n          `\r\n            update pets\r\n            set followers_count = followers_count + (case when changes() > 0 then 1 else 0 end)\r\n            where id = ?\r\n          `\r\n        )\r\n        .bind(petId),\r\n      this.db.prepare(`select followers_count from pets where id = ?`).bind(petId)\r\n    ]);\r\n\r\n    const count = (countResult?.results?.[0] as { followers_count?: number } | undefined)?.followers_count;\r\n    return count ?? 0;\r\n  }\r\n\r\n  async unfollowPetTx(followerOwnerId: string, petId: string): Promise<number> {\r\n    const [_, __, countResult] = await this.db.batch([\r\n      this.db\r\n        .prepare(`delete from pet_follows where follower_owner_id = ? and pet_id = ?`)\r\n        .bind(followerOwnerId, petId),\r\n      this.db\r\n        .prepare(\r\n          `\r\n            update pets\r\n            set followers_count = case\r\n              when changes() > 0 and followers_count > 0 then followers_count - 1\r\n              else followers_count\r\n            end\r\n            where id = ?\r\n          `\r\n        )\r\n        .bind(petId),\r\n      this.db.prepare(`select followers_count from pets where id = ?`).bind(petId)\r\n    ]);\r\n\r\n    const count = (countResult?.results?.[0] as { followers_count?: number } | undefined)?.followers_count;\r\n    return count ?? 0;\r\n  }\r\n\r\n  async listFollowedPets(\r\n    followerOwnerId: string,\r\n    limit: number,\r\n    cursor?: number | null\r\n  ): Promise<{\r\n    items: Array<{\r\n      id: string;\r\n      name: string;\r\n      avatarUrl: string | null;\r\n      species: string | null;\r\n      breed: string | null;\r\n      followersCount: number;\r\n      isActive: number;\r\n    }>;\r\n    nextCursor: string | null;\r\n  }> {\r\n    const safeLimit = Math.min(Math.max(limit, 1), 50);\r\n    const params: Array<string | number> = [followerOwnerId];\r\n    const clauses: string[] = [\"pf.follower_owner_id = ?\"];\r\n    if (cursor) {\r\n      clauses.push(\"pf.id < ?\");\r\n      params.push(cursor);\r\n    }\r\n\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            pf.id as follow_id,\r\n            p.id,\r\n            p.name,\r\n            p.avatar_url,\r\n            p.species,\r\n            p.breed,\r\n            p.followers_count,\r\n            p.is_active\r\n          from pet_follows pf\r\n          join pets p on p.id = pf.pet_id\r\n          where ${clauses.join(\" and \")}\r\n          order by pf.id desc\r\n          limit ?\r\n        `\r\n      )\r\n      .bind(...params, safeLimit + 1)\r\n      .all<{\r\n        follow_id: number;\r\n        id: string;\r\n        name: string;\r\n        avatar_url: string | null;\r\n        species: string | null;\r\n        breed: string | null;\r\n        followers_count: number;\r\n        is_active: number;\r\n      }>();\r\n\r\n    const rows = results ?? [];\r\n    const hasMore = rows.length > safeLimit;\r\n    const pageRows = hasMore ? rows.slice(0, safeLimit) : rows;\r\n    const nextCursor = hasMore && pageRows.length > 0 ? String(pageRows[pageRows.length - 1].follow_id) : null;\r\n\r\n    const items = pageRows.map((row) => ({\r\n      id: row.id,\r\n      name: row.name,\r\n      avatarUrl: row.avatar_url ?? null,\r\n      species: row.species ?? null,\r\n      breed: row.breed ?? null,\r\n      followersCount: row.followers_count ?? 0,\r\n      isActive: row.is_active ?? 1\r\n    }));\r\n\r\n    return { items, nextCursor };\r\n  }\r\n\r\n  async listPetFollowers(\r\n    petId: string,\r\n    limit: number,\r\n    cursor?: number | null\r\n  ): Promise<{\r\n    items: Array<{ uuid: string; displayName: string; avatarUrl: string | null }>;\r\n    nextCursor: string | null;\r\n  }> {\r\n    const safeLimit = Math.min(Math.max(limit, 1), 50);\r\n    const params: Array<string | number> = [petId];\r\n    const clauses: string[] = [\"pf.pet_id = ?\"];\r\n    if (cursor) {\r\n      clauses.push(\"pf.id < ?\");\r\n      params.push(cursor);\r\n    }\r\n\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            pf.id as follow_id,\r\n            o.uuid,\r\n            o.display_name,\r\n            o.avatar_url\r\n          from pet_follows pf\r\n          join owners o on o.uuid = pf.follower_owner_id\r\n          where ${clauses.join(\" and \")}\r\n          order by pf.id desc\r\n          limit ?\r\n        `\r\n      )\r\n      .bind(...params, safeLimit + 1)\r\n      .all<{ follow_id: number; uuid: string; display_name: string; avatar_url: string | null }>();\r\n\r\n    const rows = results ?? [];\r\n    const hasMore = rows.length > safeLimit;\r\n    const pageRows = hasMore ? rows.slice(0, safeLimit) : rows;\r\n    const nextCursor = hasMore && pageRows.length > 0 ? String(pageRows[pageRows.length - 1].follow_id) : null;\r\n\r\n    const items = pageRows.map((row) => ({\r\n      uuid: row.uuid,\r\n      displayName: row.display_name,\r\n      avatarUrl: row.avatar_url ?? null\r\n    }));\r\n\r\n    return { items, nextCursor };\r\n  }\r\n\r\n  async createPet(input: {\r\n    id: string;\r\n    ownerId: string;\r\n    name: string;\r\n    class?: string | null;\r\n    species?: string | null;\r\n    breed?: string | null;\r\n    gender?: \"male\" | \"female\" | \"unknown\";\r\n    birthday?: string | null;\r\n    avatarAssetId?: string | null;\r\n    avatarUrl?: string | null;\r\n    bio?: string | null;\r\n  }): Promise<Pet> {\r\n    const now = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          insert into pets (\r\n            id, owner_id, name, \"class\", species, breed, gender, birthday, avatar_asset_id,\r\n            avatar_url, bio, created_at, updated_at, is_active\r\n          )\r\n          values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1)\r\n        `\r\n      )\r\n      .bind(\r\n        input.id,\r\n        input.ownerId,\r\n        input.name,\r\n        input.class ?? null,\r\n        input.species ?? null,\r\n        input.breed ?? null,\r\n        input.gender ?? \"unknown\",\r\n        input.birthday ?? null,\r\n        input.avatarAssetId ?? null,\r\n        input.avatarUrl ?? null,\r\n        input.bio ?? null,\r\n        now,\r\n        now\r\n      )\r\n      .run();\r\n\r\n    const row = await this.getPetById(input.id);\r\n    if (!row) throw new Error(\"Failed to create pet\");\r\n    return row;\r\n  }\r\n\r\n  async getPetById(id: string): Promise<Pet | null> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            id, owner_id, name, \"class\" as class, species, breed, gender, birthday,\r\n            avatar_asset_id, avatar_url, bio, followers_count, created_at, updated_at, is_active\r\n          from pets\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(id)\r\n      .first<PetRow>();\r\n    return row ? mapPetRow(row) : null;\r\n  }\r\n\r\n  async createOwner(input: {\r\n    accountId: string;\r\n    uuid: string;\r\n    displayName: string;\r\n    avatarUrl?: string | null;\r\n  }): Promise<Owner> {\r\n    const createdAt = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          insert into owners (account_id, uuid, display_name, avatar_url, city, region, created_at, updated_at)\r\n          values (?, ?, ?, ?, ?, ?, ?, ?)\r\n        `\r\n      )\r\n      .bind(\r\n        input.accountId,\r\n        input.uuid,\r\n        input.displayName,\r\n        input.avatarUrl ?? null,\r\n        null,\r\n        null,\r\n        createdAt,\r\n        createdAt\r\n      )\r\n      .run();\r\n\r\n    const row = await this.getOwnerByUuid(input.uuid);\r\n    if (!row) {\r\n      throw new Error(\"Failed to create owner\");\r\n    }\r\n    return row;\r\n  }\r\n\r\n  async createAccount(input: {\r\n    accountId: string;\r\n    email: string;\r\n    passwordHash: string;\r\n    realName?: string | null;\r\n    idNumber?: string | null;\r\n    phoneNumber?: string | null;\r\n  }): Promise<Account> {\r\n    const now = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          insert into accounts (id, email, password_hash, real_name, id_number, phone_number, is_verified, created_at, updated_at, face_with_license_url, id_license_front_url, id_license_back_url)\r\n          values (?, ?, ?, ?, ?, ?, 0, ?, ?, NULL, NULL, NULL)\r\n        `\r\n      )\r\n      .bind(\r\n        input.accountId,\r\n        input.email,\r\n        input.passwordHash,\r\n        input.realName ?? null,\r\n        input.idNumber ?? null,\r\n        input.phoneNumber ?? null,\r\n        now,\r\n        now\r\n      )\r\n      .run();\r\n\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select id as account_id, email, password_hash, real_name, id_number, phone_number, is_verified, id_license_front_url, id_license_back_url, face_with_license_url, created_at, updated_at\r\n          from accounts\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(input.accountId)\r\n      .first<AccountRow>();\r\n\r\n    if (!row) throw new Error(\"Failed to create account\");\r\n    return mapAccountRow(row);\r\n  }\r\n\r\n  async updateOwnerLocation(ownerUuid: string, city: string, region: string): Promise<Owner> {\r\n    const updatedAt = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          update owners\r\n          set city = ?, region = ?, updated_at = ?\r\n          where uuid = ?\r\n        `\r\n      )\r\n      .bind(city, region, updatedAt, ownerUuid)\r\n      .run();\r\n\r\n    const row = await this.getOwnerByUuid(ownerUuid);\r\n    if (!row) {\r\n      throw new Error(\"Owner not found\");\r\n    }\r\n    return row;\r\n  }\r\n\r\n  async getAccountById(accountId: string): Promise<Account | null> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select id as account_id, email, password_hash, real_name, id_number, phone_number, is_verified,\r\n                 id_license_front_url, id_license_back_url, face_with_license_url, created_at, updated_at\r\n          from accounts\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(accountId)\r\n      .first<AccountRow>();\r\n    return row ? mapAccountRow(row) : null;\r\n  }\r\n\r\n  async getAccountByEmail(email: string): Promise<Account | null> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select id as account_id, email, password_hash, real_name, id_number, phone_number, is_verified,\r\n                 id_license_front_url, id_license_back_url, face_with_license_url, created_at, updated_at\r\n          from accounts\r\n          where email = ?\r\n        `\r\n      )\r\n      .bind(email)\r\n      .first<AccountRow>();\r\n    return row ? mapAccountRow(row) : null;\r\n  }\r\n\r\n  async updateAccountVerificationUrls(\r\n    accountId: string,\r\n    urls: { frontUrl?: string | null; backUrl?: string | null; faceUrl?: string | null; setPending?: boolean }\r\n  ): Promise<void> {\r\n    const updatedAt = new Date().toISOString();\r\n    const setPendingClause = urls.setPending ? \", is_verified = case when is_verified = 0 then 2 else is_verified end\" : \"\";\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          update accounts\r\n          set\r\n            id_license_front_url = coalesce(?, id_license_front_url),\r\n            id_license_back_url = coalesce(?, id_license_back_url),\r\n            face_with_license_url = coalesce(?, face_with_license_url),\r\n            updated_at = ?${setPendingClause}\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(urls.frontUrl ?? null, urls.backUrl ?? null, urls.faceUrl ?? null, updatedAt, accountId)\r\n      .run();\r\n  }\r\n\r\n  async updateAccountVerificationStatus(accountId: string, status: number): Promise<void> {\r\n    const updatedAt = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          update accounts\r\n          set is_verified = ?, updated_at = ?\r\n          where id = ?\r\n        `\r\n      )\r\n      .bind(status, updatedAt, accountId)\r\n      .run();\r\n  }\r\n\r\n  async countVerificationStatuses(): Promise<{ pending: number; verified: number; awaiting: number; failed: number }> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select\r\n            sum(case when is_verified = 2 then 1 else 0 end) as pending,\r\n            sum(case when is_verified = 1 then 1 else 0 end) as verified,\r\n            sum(case when is_verified = 0 then 1 else 0 end) as awaiting,\r\n            sum(case when is_verified = 3 then 1 else 0 end) as failed\r\n          from accounts\r\n        `\r\n      )\r\n      .first<{ pending: number; verified: number; awaiting: number; failed: number }>();\r\n    return {\r\n      pending: row?.pending ?? 0,\r\n      verified: row?.verified ?? 0,\r\n      awaiting: row?.awaiting ?? 0,\r\n      failed: row?.failed ?? 0\r\n    };\r\n  }\r\n\r\n  async listVerifications(): Promise<\r\n    Array<{\r\n      accountId: string;\r\n      realName: string | null;\r\n      phoneNumber: string | null;\r\n      idNumber: string | null;\r\n      createdAt: string;\r\n      isVerified: number;\r\n    }>\r\n  > {\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select account_id, real_name, id_number, phone_number, is_verified, created_at\r\n          from accounts\r\n          order by created_at desc\r\n        `\r\n      )\r\n      .all<VerificationRow>();\r\n\r\n    return (results ?? []).map((row) => ({\r\n      accountId: row.account_id,\r\n      realName: row.real_name ?? null,\r\n      idNumber: row.id_number ?? null,\r\n      phoneNumber: row.phone_number ?? null,\r\n      createdAt: row.created_at,\r\n      isVerified: row.is_verified\r\n    }));\r\n  }\r\n\r\n  async listAdminAccounts(): Promise<AdminAccount[]> {\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select id, admin_id, permission, ip_allowlist, created_at, last_at, updated_at\r\n          from admin_accounts\r\n          order by id desc\r\n        `\r\n      )\r\n      .all<AdminAccountRow>();\r\n    return (results ?? []).map(mapAdminAccountRow);\r\n  }\r\n\r\n  async createAdminAccount(input: { adminId: string; password: string; permission: string }): Promise<AdminAccount> {\r\n    const now = new Date().toISOString();\r\n    await this.db\r\n      .prepare(\r\n        `\r\n          insert into admin_accounts (admin_id, password, permission, created_at, updated_at)\r\n          values (?, ?, ?, ?, ?)\r\n        `\r\n      )\r\n      .bind(input.adminId, input.password, input.permission, now, now)\r\n      .run();\r\n\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select id, admin_id, permission, ip_allowlist, created_at, last_at, updated_at\r\n          from admin_accounts\r\n          where admin_id = ?\r\n        `\r\n      )\r\n      .bind(input.adminId)\r\n      .first<AdminAccountRow>();\r\n    if (!row) throw new Error(\"Failed to create admin account\");\r\n    return mapAdminAccountRow(row);\r\n  }\r\n\r\n  async getAdminByAdminId(adminId: string): Promise<(AdminAccount & { passwordHash: string }) | null> {\r\n    const row = await this.db\r\n      .prepare(\r\n        `\r\n          select id, admin_id, password, permission, ip_allowlist, created_at, last_at, updated_at\r\n          from admin_accounts\r\n          where admin_id = ?\r\n        `\r\n      )\r\n      .bind(adminId)\r\n      .first<AdminAccountRow>();\r\n    if (!row) return null;\r\n    return { ...mapAdminAccountRow(row), passwordHash: row.password };\r\n  }\r\n\r\n  async updateAdminLastAt(adminId: string, ts: string): Promise<void> {\r\n    await this.db.prepare(`update admin_accounts set last_at = ? where admin_id = ?`).bind(ts, adminId).run();\r\n  }\r\n\r\n  async updateAdminPassword(adminId: string, passwordHash: string): Promise<void> {\r\n    const ts = new Date().toISOString();\r\n    await this.db\r\n      .prepare(`update admin_accounts set password = ?, updated_at = ? where admin_id = ?`)\r\n      .bind(passwordHash, ts, adminId)\r\n      .run();\r\n  }\r\n\r\n  async updateAdminIpAllowlist(adminId: string, ipAllowlist: string | null): Promise<boolean> {\r\n    const ts = new Date().toISOString();\r\n    const result = await this.db\r\n      .prepare(`update admin_accounts set ip_allowlist = ?, updated_at = ? where admin_id = ?`)\r\n      .bind(ipAllowlist, ts, adminId)\r\n      .run();\r\n    const changes = (result as { meta?: { changes?: number } })?.meta?.changes ?? 0;\r\n    return changes > 0;\r\n  }\r\n\r\n  async listAdminIpAllowlist(): Promise<string[]> {\r\n    const { results } = await this.db\r\n      .prepare(\r\n        `\r\n          select ip_allowlist\r\n          from admin_accounts\r\n          where ip_allowlist is not null and trim(ip_allowlist) <> ''\r\n        `\r\n      )\r\n      .all<{ ip_allowlist: string | null }>();\r\n    return (results ?? []).map((row) => row.ip_allowlist ?? \"\").filter(Boolean);\r\n  }\r\n}\r\n\r\nfunction mapPostRow(row: PostRow): Post {\r\n  const repostCount = row.repost_count ?? 0;\r\n  return {\r\n    id: row.id,\r\n    authorId: row.owner_id,\r\n    body: row.content_text ?? null,\r\n    mediaKey: row.media_key ?? null,\r\n    createdAt: row.created_at,\r\n    authorDisplayName: row.author_display_name ?? null,\r\n    visibility: row.visibility,\r\n    postType: row.post_type,\r\n    mediaCount: row.media_count,\r\n    likeCount: row.like_count ?? 0,\r\n    commentCount: row.comment_count ?? 0,\r\n    repostCount,\r\n    originPostId: row.origin_post_id ?? null,\r\n    isDeleted: row.is_deleted ?? 0,\r\n    isLiked: row.is_liked === 1\r\n  };\r\n}\r\n\r\nfunction mapCommentRow(row: CommentRow): Comment {\r\n  return {\r\n    id: row.id,\r\n    postId: row.post_id,\r\n    ownerId: row.owner_id,\r\n    ownerDisplayName: row.owner_display_name ?? null,\r\n    content: row.content_text,\r\n    parentCommentId: row.parent_comment_id ?? null,\r\n    createdAt: row.created_at,\r\n    likeCount: row.like_count ?? 0,\r\n    isLiked: row.is_liked === 1\r\n  };\r\n}\r\n\r\nfunction parseCommentCursor(cursor?: string | null): { createdAt: string; id: string } | null {\r\n  if (!cursor) return null;\r\n  const [createdAt, id] = cursor.split(\"|\");\r\n  if (!createdAt || !id) return null;\r\n  return { createdAt, id };\r\n}\r\n\r\nfunction toCommentCursor(row: CommentRow): string {\n  return `${row.created_at}|${row.id}`;\n}\n\nfunction parseChatThreadCursor(cursor?: string | null): { activityAt: string; id?: string } | null {\n  if (!cursor) return null;\n  const [activityAt, id] = cursor.split(\"|\");\n  if (activityAt && id) return { activityAt, id };\n  if (activityAt && looksLikeTimestamp(activityAt)) return { activityAt };\n  return null;\n}\n\nfunction toChatThreadCursor(row: ChatThreadListRow): string | null {\n  const activityAt = row.sort_activity ?? row.last_activity_at;\n  if (!activityAt) return null;\n  return `${activityAt}|${row.thread_id}`;\n}\n\nfunction parseChatMessageCursor(cursor?: string | null): { createdAt: string; id?: string } | null {\n  if (!cursor) return null;\n  const [createdAt, id] = cursor.split(\"|\");\n  if (!createdAt || !id) return null;\n  return { createdAt, id };\n}\n\nfunction toChatMessageCursor(row: ChatMessageRow): string {\n  return `${row.created_at}|${row.id}`;\n}\n\nfunction looksLikeTimestamp(value: string): boolean {\n  return value.includes(\"-\") && value.includes(\":\");\n}\n\nfunction mapOwnerPublicRow(row: OwnerPublicRow) {\n  return {\n    uuid: row.uuid,\n    displayName: row.display_name,\n    avatarUrl: row.avatar_url,\n    city: row.city,\n    region: row.region\n  };\n}\n\nfunction mapChatThreadRow(row: ChatThreadRow): ChatThread {\n  return {\n    id: row.id,\n    ownerAId: row.owner_a_id,\n    ownerBId: row.owner_b_id,\n    pairKey: row.pair_key,\n    requestState: row.request_state as ChatRequestState,\n    requestSenderId: row.request_sender_id ?? null,\n    requestMessageId: row.request_message_id ?? null,\n    lastMessageId: row.last_message_id ?? null,\n    lastActivityAt: row.last_activity_at ?? null,\n    createdAt: row.created_at ?? null,\n    updatedAt: row.updated_at ?? null\n  };\n}\n\nfunction mapChatThreadParticipantRow(row: ChatThreadParticipantRow): ChatThreadParticipant {\n  return {\n    threadId: row.thread_id,\n    ownerId: row.owner_id,\n    lastReadMessageId: row.last_read_message_id ?? null,\n    archivedAt: row.archived_at ?? null,\n    deletedAt: row.deleted_at ?? null\n  };\n}\n\nfunction mapChatMessageRow(row: ChatMessageRow): ChatMessage {\n  return {\n    id: row.id,\n    threadId: row.thread_id,\n    senderId: row.sender_id,\n    bodyText: row.body_text,\n    createdAt: row.created_at\n  };\n}\n\nfunction mapChatThreadListRow(row: ChatThreadListRow): ChatThreadListItem {\n  return {\n    threadId: row.thread_id,\n    requestState: row.request_state as ChatRequestState,\n    requestSenderId: row.request_sender_id ?? null,\n    requestMessageId: row.request_message_id ?? null,\n    lastMessageId: row.last_message_id ?? null,\n    lastActivityAt: row.last_activity_at ?? null,\n    lastMessagePreview: row.last_message_preview ?? null,\n    lastReadMessageId: row.last_read_message_id ?? null,\n    unreadCount: row.unread_count ?? 0,\n    archivedAt: row.archived_at ?? null,\n    deletedAt: row.deleted_at ?? null,\n    otherOwner: mapOwnerPublicRow({\n      uuid: row.other_uuid,\n      display_name: row.other_display_name,\n      avatar_url: row.other_avatar_url,\n      city: null,\n      region: null\n    })\n  };\n}\n\nfunction mapOwnerRow(row: OwnerRow): Owner {\n  return {\n    accountId: row.account_id,\n    uuid: row.uuid,\r\n    displayName: row.display_name,\r\n    email: row.email ?? null,\r\n    avatarUrl: row.avatar_url ?? null,\r\n    passwordHash: row.password_hash ?? undefined,\r\n    maxPets: row.max_pets,\r\n    city: row.city ?? null,\r\n    region: row.region ?? null,\r\n    createdAt: row.created_at,\r\n    updatedAt: row.updated_at,\r\n    isActive: row.is_active,\r\n    isVerified: row.is_verified ?? 0,\r\n    idLicenseFrontUrl: row.id_license_front_url ?? null,\r\n    idLicenseBackUrl: row.id_license_back_url ?? null,\r\n    faceWithLicenseUrl: row.face_with_license_url ?? null\r\n  };\r\n}\r\n\r\nfunction mapPetRow(row: PetRow): Pet {\r\n  return {\r\n    id: row.id,\r\n    ownerId: row.owner_id,\r\n    name: row.name,\r\n    class: row.class ?? null,\r\n    species: row.species ?? null,\r\n    breed: row.breed ?? null,\r\n    gender: row.gender ?? \"unknown\",\r\n    birthday: row.birthday ?? null,\r\n    avatarAssetId: row.avatar_asset_id ?? null,\r\n    avatarUrl: row.avatar_url ?? null,\r\n    bio: row.bio ?? null,\r\n    followersCount: row.followers_count ?? 0,\r\n    createdAt: row.created_at,\r\n    updatedAt: row.updated_at,\r\n    isActive: row.is_active ?? 1\r\n  };\r\n}\r\n\r\nfunction mapAccountRow(row: AccountRow): Account {\r\n  return {\r\n    accountId: row.account_id,\r\n    email: row.email,\r\n    passwordHash: row.password_hash,\r\n    realName: row.real_name ?? null,\r\n    idNumber: row.id_number ?? null,\r\n    phoneNumber: row.phone_number ?? null,\r\n    isVerified: row.is_verified,\r\n    idLicenseFrontUrl: row.id_license_front_url ?? null,\r\n    idLicenseBackUrl: row.id_license_back_url ?? null,\r\n    faceWithLicenseUrl: row.face_with_license_url ?? null,\r\n    createdAt: row.created_at,\r\n    updatedAt: row.updated_at\r\n  };\r\n}\r\n\r\nfunction mapAdminAccountRow(row: AdminAccountRow): AdminAccount {\r\n  return {\r\n    id: row.id,\r\n    adminId: row.admin_id,\r\n    permission: row.permission,\r\n    ipAllowlist: row.ip_allowlist ?? null,\r\n    createdAt: row.created_at,\r\n    lastAt: row.last_at ?? null,\r\n    updatedAt: row.updated_at\r\n  };\r\n}\r\n\r\nfunction mapMediaAssetRow(row: MediaAssetRow): MediaAsset {\r\n  return {\r\n    id: row.id,\r\n    ownerId: row.owner_id,\r\n    kind: row.kind as MediaAsset[\"kind\"],\r\n    usage: row.usage as MediaAsset[\"usage\"],\r\n    storageProvider: row.storage_provider as MediaAsset[\"storageProvider\"],\r\n    storageKey: row.storage_key,\r\n    url: row.url ?? null,\r\n    thumbnailUrl: row.thumbnail_url ?? null,\r\n    mimeType: row.mime_type ?? null,\r\n    sizeBytes: row.size_bytes ?? null,\r\n    width: row.width ?? null,\r\n    height: row.height ?? null,\r\n    durationSec: row.duration_sec ?? null,\r\n    status: row.status as MediaAsset[\"status\"],\r\n    createdAt: row.created_at,\r\n    updatedAt: row.updated_at\r\n  };\r\n}\r\n", "import { D1Client } from \"./d1-client\";\nimport { DBClient } from \"./interface\";\n\ntype DBEnv = { DB: D1Database };\n\nexport function createDB(env: DBEnv): DBClient {\n  return new D1Client(env.DB);\n}\n\nexport type { DBClient } from \"./interface\";\nexport type {\n  Post,\n  User,\n  Pet,\n  ChatThread,\n  ChatThreadParticipant,\n  ChatThreadListItem,\n  ChatMessage,\n  ChatRequestState\n} from \"./models\";\n", "import { DBClient } from \"../db\";\nimport { Env } from \"../types\";\n\nexport async function checkHealth(env: Env, db: DBClient) {\n  const d1Ok = await db.ping();\n\n  let r2Ok = true;\n  try {\n    await env.R2_MEDIA.head(\"healthcheck.txt\");\n  } catch (err) {\n    console.warn(\"R2 health check failed\", err);\n    r2Ok = false;\n  }\n\n  const cfAccountId = env.CF_ACCOUNT_ID;\n  const cfToken = env.CF_API_TOKEN;\n  let cfMediaOk = !!(cfAccountId && cfToken);\n  if (cfMediaOk) {\n    try {\n      const imgResp = await fetch(`https://api.cloudflare.com/client/v4/accounts/${cfAccountId}/images/v1?per_page=1`, {\n        headers: { Authorization: `Bearer ${cfToken}` }\n      });\n      const streamResp = await fetch(`https://api.cloudflare.com/client/v4/accounts/${cfAccountId}/stream?per_page=1`, {\n        headers: { Authorization: `Bearer ${cfToken}` }\n      });\n      cfMediaOk = imgResp.ok && streamResp.ok;\n    } catch (err) {\n      console.warn(\"Cloudflare media health check failed\", err);\n      cfMediaOk = false;\n    }\n  }\n\n  const ok = d1Ok && r2Ok && cfMediaOk;\n  return {\n    ok,\n    environment: env.ENVIRONMENT ?? \"development\",\n    d1: d1Ok,\n    r2: r2Ok,\n    cfMedia: cfMediaOk,\n    ts: new Date().toISOString()\n  };\n}\n", "import { HandlerContext } from \"../../types\";\nimport { checkHealth } from \"../../services/health\";\nimport { okJson } from \"../utils\";\nimport { Route } from \"./types\";\n\nasync function healthRoute(ctx: HandlerContext): Promise<Response> {\n  const status = await checkHealth(ctx.env, ctx.db);\n  return okJson(status, 200);\n}\n\nasync function rootRoute(): Promise<Response> {\n  return okJson(\n    {\n      message: \"Rubypets API\",\n      endpoints: [\n        \"/api/health\",\n        \"/api/posts\",\n        \"/api/posts?userId=...\",\n        \"/api/posts/:id/media/attach\",\n        \"/api/auth/register\",\n        \"/api/auth/login\",\n        \"/api/media/images/init\",\n        \"/api/media/videos/init\",\n        \"/api/me\",\n        \"/api/owners/:uuid\"\n      ]\n    },\n    200\n  );\n}\n\nexport const routes: Route[] = [\n  { method: \"GET\", path: \"/health\", handler: healthRoute },\n  { method: \"GET\", path: \"/\", handler: rootRoute }\n];\n", "import { DBClient, Owner } from \"../db\";\nimport { readJson } from \"../api/utils\";\n\nexport interface RegisterPayload {\n  email: string;\n  password: string;\n  displayName?: string;\n  phoneNumber?: string;\n  realName?: string;\n}\n\nexport interface RegisterAccountOnlyPayload {\n  email: string;\n  password: string;\n}\n\nexport interface RegisterOwnerPayload {\n  accountId: string;\n  displayName: string;\n}\n\nexport interface LoginPayload {\n  email: string;\n  password: string;\n}\n\nexport async function parseRegisterPayload(request: Request): Promise<RegisterPayload> {\n  return readJson<RegisterPayload>(request);\n}\n\nexport async function parseRegisterAccountOnlyPayload(request: Request): Promise<RegisterAccountOnlyPayload> {\n  return readJson<RegisterAccountOnlyPayload>(request);\n}\n\nexport async function parseRegisterOwnerPayload(request: Request): Promise<RegisterOwnerPayload> {\n  return readJson<RegisterOwnerPayload>(request);\n}\n\nexport async function parseLoginPayload(request: Request): Promise<LoginPayload> {\n  return readJson<LoginPayload>(request);\n}\n\nexport async function registerUser(db: DBClient, payload: RegisterPayload) {\n  const email = (payload.email ?? \"\").trim().toLowerCase();\n  const password = payload.password ?? \"\";\n  const displayName = (payload.displayName ?? email.split(\"@\")[0] ?? \"user\").trim();\n  const phoneNumber = (payload.phoneNumber ?? \"\").trim() || null;\n  const realName = (payload.realName ?? displayName).trim();\n\n  if (!email || !password) {\n    throw new Error(\"email and password are required\");\n  }\n\n  const existingEmail = await db.getOwnerByEmail(email);\n  if (existingEmail) {\n    throw new Error(\"email already registered\");\n  }\n\n  const passwordHash = await hashPassword(password);\n  const accountId = generateAccountId();\n  const uuid = generateOwnerUuid();\n\n  await db.createAccount({\n    accountId,\n    email,\n    passwordHash,\n    realName,\n    phoneNumber: phoneNumber ?? undefined\n  });\n\n  const owner = await db.createOwner({\n    accountId,\n    uuid,\n    displayName\n  });\n\n  const tokens = issueTokens(owner.uuid);\n  return { owner: toPublicOwner(owner), tokens };\n}\n\nexport async function registerAccountOnly(db: DBClient, payload: RegisterAccountOnlyPayload) {\n  const email = (payload.email ?? \"\").trim().toLowerCase();\n  const password = payload.password ?? \"\";\n  if (!email || !password) throw new Error(\"email and password are required\");\n\n  const existingAccount = await db.getAccountByEmail(email);\n  if (existingAccount) {\n    throw new Error(\"email already registered\");\n  }\n\n  const passwordHash = await hashPassword(password);\n  const accountId = generateAccountId();\n\n  const account = await db.createAccount({\n    accountId,\n    email,\n    passwordHash,\n    realName: null,\n    phoneNumber: null\n  });\n\n  return { accountId: account.accountId, email: account.email };\n}\n\nexport async function registerOwnerForAccount(db: DBClient, payload: RegisterOwnerPayload) {\n  const accountId = (payload.accountId ?? \"\").trim();\n  const displayName = (payload.displayName ?? \"\").trim();\n  if (!accountId || !displayName) throw new Error(\"accountId and displayName are required\");\n\n  const account = await db.getAccountById(accountId);\n  if (!account) throw new Error(\"account not found\");\n\n  const existingOwner = await db.getOwnerByAccountId(accountId);\n  if (existingOwner) throw new Error(\"owner already exists for this account\");\n\n  const uuid = generateOwnerUuid();\n  const owner = await db.createOwner({\n    accountId,\n    uuid,\n    displayName\n  });\n\n  const tokens = issueTokens(owner.uuid);\n  return { owner: toPublicOwner(owner), tokens };\n}\n\nexport async function loginUser(db: DBClient, payload: LoginPayload) {\n  const email = (payload.email ?? \"\").trim().toLowerCase();\n  const password = payload.password ?? \"\";\n  if (!email || !password) {\n    throw new Error(\"email and password are required\");\n  }\n  const owner = await db.getOwnerByEmail(email);\n  if (!owner || !owner.passwordHash) {\n    throw new Error(\"invalid credentials\");\n  }\n  const ok = await verifyPassword(password, owner.passwordHash);\n  if (!ok) throw new Error(\"invalid credentials\");\n\n  const tokens = issueTokens(owner.uuid);\n  return { owner: toPublicOwner(owner), tokens };\n}\n\nexport async function getUserFromAuthHeader(db: DBClient, request: Request): Promise<Owner | null> {\n  const header = request.headers.get(\"authorization\");\n  if (!header?.toLowerCase().startsWith(\"bearer \")) return null;\n  const token = header.slice(\"bearer \".length).trim();\n  const ownerUuid = parseUserIdFromToken(token);\n  if (!ownerUuid) return null;\n  return db.getOwnerByUuid(ownerUuid);\n}\n\nexport function toPublicOwner(owner: Owner) {\n  const email = owner.email ?? \"\";\n  return {\n    id: owner.uuid,\n    handle: owner.displayName || email.split(\"@\")[0] || owner.uuid,\n    displayName: owner.displayName,\n    email: owner.email ?? null,\n    avatarUrl: owner.avatarUrl ?? null,\n    maxPets: owner.maxPets,\n    createdAt: owner.createdAt,\n    updatedAt: owner.updatedAt,\n    isActive: owner.isActive\n  };\n}\n\nexport function issueTokens(ownerUuid: string) {\n  return {\n    accessToken: `owner:${ownerUuid}`,\n    expiresIn: 60 * 60 * 24 * 30\n  };\n}\n\nexport function parseUserIdFromToken(token: string): string | null {\n  if (!token.startsWith(\"owner:\")) return null;\n  return token.slice(\"owner:\".length);\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  const salt = crypto.randomUUID();\n  const data = new TextEncoder().encode(`${salt}:${password}`);\n  const digest = await crypto.subtle.digest(\"SHA-256\", data);\n  const hashHex = bufferToHex(digest);\n  return `${salt}:${hashHex}`;\n}\n\nexport async function verifyPassword(password: string, stored: string): Promise<boolean> {\n  const [salt, hashHex] = stored.split(\":\");\n  if (!salt || !hashHex) return false;\n  const data = new TextEncoder().encode(`${salt}:${password}`);\n  const digest = await crypto.subtle.digest(\"SHA-256\", data);\n  return bufferToHex(digest) === hashHex;\n}\n\nfunction bufferToHex(buf: ArrayBuffer): string {\n  return [...new Uint8Array(buf)].map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n}\n\nfunction randomId(len = 8): string {\n  const chars = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n  let out = \"\";\n  const bytes = crypto.getRandomValues(new Uint8Array(len));\n  for (let i = 0; i < len; i++) {\n    out += chars[bytes[i] % chars.length];\n  }\n  return out;\n}\n\nfunction randomLowerId(len = 8): string {\n  const chars = \"abcdefghijklmnopqrstuvwxyz0123456789\";\n  let out = \"\";\n  const bytes = crypto.getRandomValues(new Uint8Array(len));\n  for (let i = 0; i < len; i++) {\n    out += chars[bytes[i] % chars.length];\n  }\n  return out;\n}\n\nfunction generateAccountId() {\n  return `acct_${randomLowerId(12)}`;\n}\n\nfunction generateOwnerUuid() {\n  return `owner_${randomLowerId(8)}`;\n}\n", "import { HandlerContext } from \"../../types\";\r\nimport { errorJson, okJson } from \"../utils\";\r\nimport {\r\n  getUserFromAuthHeader,\r\n  loginUser,\r\n  parseLoginPayload,\r\n  parseRegisterAccountOnlyPayload,\r\n  parseRegisterPayload,\r\n  parseRegisterOwnerPayload,\r\n  registerAccountOnly,\r\n  registerOwnerForAccount,\r\n  registerUser,\r\n  toPublicOwner\r\n} from \"../../services/auth\";\r\nimport { Route } from \"./types\";\r\n\r\nasync function registerRoute(ctx: HandlerContext): Promise<Response> {\r\n  try {\r\n    const payload = await parseRegisterPayload(ctx.request);\r\n    const { owner, tokens } = await registerUser(ctx.db, payload);\r\n    return okJson({ user: owner, ...tokens }, 201);\r\n  } catch (err) {\r\n    return errorJson((err as Error).message, 400);\r\n  }\r\n}\r\n\r\nasync function registerAccountRoute(ctx: HandlerContext): Promise<Response> {\r\n  try {\r\n    const payload = await parseRegisterAccountOnlyPayload(ctx.request);\r\n    const account = await registerAccountOnly(ctx.db, payload);\r\n    return okJson({ account }, 201);\r\n  } catch (err) {\r\n    return errorJson((err as Error).message, 400);\r\n  }\r\n}\r\n\r\nasync function registerOwnerRoute(ctx: HandlerContext): Promise<Response> {\r\n  try {\r\n    const payload = await parseRegisterOwnerPayload(ctx.request);\r\n    const { owner, tokens } = await registerOwnerForAccount(ctx.db, payload);\r\n    return okJson({ user: owner, ...tokens }, 201);\r\n  } catch (err) {\r\n    return errorJson((err as Error).message, 400);\r\n  }\r\n}\r\n\r\nasync function loginRoute(ctx: HandlerContext): Promise<Response> {\r\n  try {\r\n    const payload = await parseLoginPayload(ctx.request);\r\n    const { owner, tokens } = await loginUser(ctx.db, payload);\r\n    return okJson({ user: owner, ...tokens }, 200);\r\n  } catch (err) {\r\n    const message = (err as Error).message;\r\n    const status = message === \"invalid credentials\" ? 401 : 400;\r\n    return errorJson(message, status);\r\n  }\r\n}\r\n\r\nasync function meRoute(ctx: HandlerContext): Promise<Response> {\r\n  const user = await getUserFromAuthHeader(ctx.db, ctx.request);\r\n  if (!user) return errorJson(\"Unauthorized\", 401);\r\n  return okJson(toPublicOwner(user), 200);\r\n}\r\n\r\nexport const routes: Route[] = [\r\n  { method: \"POST\", path: \"/auth/register\", handler: registerRoute },\r\n  { method: \"POST\", path: \"/auth/register/account\", handler: registerAccountRoute },\r\n  { method: \"POST\", path: \"/auth/register/owner\", handler: registerOwnerRoute },\r\n  { method: \"POST\", path: \"/auth/login\", handler: loginRoute },\r\n  { method: \"GET\", path: \"/me\", handler: meRoute }\r\n];\r\n", "import { DBClient } from \"../db\";\nimport { Post } from \"../db/models\";\n\nexport interface CreatePostInput {\n  authorId: string;\n  content: string;\n  visibility?: string;\n  postType?: string;\n  originPostId?: string | null;\n}\n\nexport async function listRecentPosts(db: DBClient, limit = 20, currentOwnerUuid?: string): Promise<Post[]> {\n  return db.listRecentPosts(limit, currentOwnerUuid);\n}\n\nexport async function getPostsByOwner(db: DBClient, ownerUuid: string, limit = 20, currentOwnerUuid?: string): Promise<Post[]> {\n  return db.getPostsByOwner(ownerUuid, limit, currentOwnerUuid);\n}\n\nexport async function createPost(db: DBClient, input: CreatePostInput): Promise<Post> {\n  return db.createPost({\n    authorId: input.authorId,\n    body: input.content,\n    visibility: input.visibility ?? \"public\",\n    postType: input.postType ?? \"text\",\n    mediaCount: 0,\n    originPostId: input.originPostId ?? null\n  });\n}\n", "export const encoder = new TextEncoder();\nexport const decoder = new TextDecoder();\nconst MAX_INT32 = 2 ** 32;\nexport function concat(...buffers) {\n    const size = buffers.reduce((acc, { length }) => acc + length, 0);\n    const buf = new Uint8Array(size);\n    let i = 0;\n    for (const buffer of buffers) {\n        buf.set(buffer, i);\n        i += buffer.length;\n    }\n    return buf;\n}\nfunction writeUInt32BE(buf, value, offset) {\n    if (value < 0 || value >= MAX_INT32) {\n        throw new RangeError(`value must be >= 0 and <= ${MAX_INT32 - 1}. Received ${value}`);\n    }\n    buf.set([value >>> 24, value >>> 16, value >>> 8, value & 0xff], offset);\n}\nexport function uint64be(value) {\n    const high = Math.floor(value / MAX_INT32);\n    const low = value % MAX_INT32;\n    const buf = new Uint8Array(8);\n    writeUInt32BE(buf, high, 0);\n    writeUInt32BE(buf, low, 4);\n    return buf;\n}\nexport function uint32be(value) {\n    const buf = new Uint8Array(4);\n    writeUInt32BE(buf, value);\n    return buf;\n}\nexport function encode(string) {\n    const bytes = new Uint8Array(string.length);\n    for (let i = 0; i < string.length; i++) {\n        const code = string.charCodeAt(i);\n        if (code > 127) {\n            throw new TypeError('non-ASCII string encountered in encode()');\n        }\n        bytes[i] = code;\n    }\n    return bytes;\n}\n", "export function encodeBase64(input) {\n    if (Uint8Array.prototype.toBase64) {\n        return input.toBase64();\n    }\n    const CHUNK_SIZE = 0x8000;\n    const arr = [];\n    for (let i = 0; i < input.length; i += CHUNK_SIZE) {\n        arr.push(String.fromCharCode.apply(null, input.subarray(i, i + CHUNK_SIZE)));\n    }\n    return btoa(arr.join(''));\n}\nexport function decodeBase64(encoded) {\n    if (Uint8Array.fromBase64) {\n        return Uint8Array.fromBase64(encoded);\n    }\n    const binary = atob(encoded);\n    const bytes = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i++) {\n        bytes[i] = binary.charCodeAt(i);\n    }\n    return bytes;\n}\n", "import { encoder, decoder } from '../lib/buffer_utils.js';\nimport { encodeBase64, decodeBase64 } from '../lib/base64.js';\nexport function decode(input) {\n    if (Uint8Array.fromBase64) {\n        return Uint8Array.fromBase64(typeof input === 'string' ? input : decoder.decode(input), {\n            alphabet: 'base64url',\n        });\n    }\n    let encoded = input;\n    if (encoded instanceof Uint8Array) {\n        encoded = decoder.decode(encoded);\n    }\n    encoded = encoded.replace(/-/g, '+').replace(/_/g, '/');\n    try {\n        return decodeBase64(encoded);\n    }\n    catch {\n        throw new TypeError('The input to be decoded is not correctly encoded.');\n    }\n}\nexport function encode(input) {\n    let unencoded = input;\n    if (typeof unencoded === 'string') {\n        unencoded = encoder.encode(unencoded);\n    }\n    if (Uint8Array.prototype.toBase64) {\n        return unencoded.toBase64({ alphabet: 'base64url', omitPadding: true });\n    }\n    return encodeBase64(unencoded).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n", "export class JOSEError extends Error {\n    static code = 'ERR_JOSE_GENERIC';\n    code = 'ERR_JOSE_GENERIC';\n    constructor(message, options) {\n        super(message, options);\n        this.name = this.constructor.name;\n        Error.captureStackTrace?.(this, this.constructor);\n    }\n}\nexport class JWTClaimValidationFailed extends JOSEError {\n    static code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n    code = 'ERR_JWT_CLAIM_VALIDATION_FAILED';\n    claim;\n    reason;\n    payload;\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nexport class JWTExpired extends JOSEError {\n    static code = 'ERR_JWT_EXPIRED';\n    code = 'ERR_JWT_EXPIRED';\n    claim;\n    reason;\n    payload;\n    constructor(message, payload, claim = 'unspecified', reason = 'unspecified') {\n        super(message, { cause: { claim, reason, payload } });\n        this.claim = claim;\n        this.reason = reason;\n        this.payload = payload;\n    }\n}\nexport class JOSEAlgNotAllowed extends JOSEError {\n    static code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n    code = 'ERR_JOSE_ALG_NOT_ALLOWED';\n}\nexport class JOSENotSupported extends JOSEError {\n    static code = 'ERR_JOSE_NOT_SUPPORTED';\n    code = 'ERR_JOSE_NOT_SUPPORTED';\n}\nexport class JWEDecryptionFailed extends JOSEError {\n    static code = 'ERR_JWE_DECRYPTION_FAILED';\n    code = 'ERR_JWE_DECRYPTION_FAILED';\n    constructor(message = 'decryption operation failed', options) {\n        super(message, options);\n    }\n}\nexport class JWEInvalid extends JOSEError {\n    static code = 'ERR_JWE_INVALID';\n    code = 'ERR_JWE_INVALID';\n}\nexport class JWSInvalid extends JOSEError {\n    static code = 'ERR_JWS_INVALID';\n    code = 'ERR_JWS_INVALID';\n}\nexport class JWTInvalid extends JOSEError {\n    static code = 'ERR_JWT_INVALID';\n    code = 'ERR_JWT_INVALID';\n}\nexport class JWKInvalid extends JOSEError {\n    static code = 'ERR_JWK_INVALID';\n    code = 'ERR_JWK_INVALID';\n}\nexport class JWKSInvalid extends JOSEError {\n    static code = 'ERR_JWKS_INVALID';\n    code = 'ERR_JWKS_INVALID';\n}\nexport class JWKSNoMatchingKey extends JOSEError {\n    static code = 'ERR_JWKS_NO_MATCHING_KEY';\n    code = 'ERR_JWKS_NO_MATCHING_KEY';\n    constructor(message = 'no applicable key found in the JSON Web Key Set', options) {\n        super(message, options);\n    }\n}\nexport class JWKSMultipleMatchingKeys extends JOSEError {\n    [Symbol.asyncIterator];\n    static code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    code = 'ERR_JWKS_MULTIPLE_MATCHING_KEYS';\n    constructor(message = 'multiple matching keys found in the JSON Web Key Set', options) {\n        super(message, options);\n    }\n}\nexport class JWKSTimeout extends JOSEError {\n    static code = 'ERR_JWKS_TIMEOUT';\n    code = 'ERR_JWKS_TIMEOUT';\n    constructor(message = 'request timed out', options) {\n        super(message, options);\n    }\n}\nexport class JWSSignatureVerificationFailed extends JOSEError {\n    static code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    code = 'ERR_JWS_SIGNATURE_VERIFICATION_FAILED';\n    constructor(message = 'signature verification failed', options) {\n        super(message, options);\n    }\n}\n", "const unusable = (name, prop = 'algorithm.name') => new TypeError(`CryptoKey does not support this operation, its ${prop} must be ${name}`);\nconst isAlgorithm = (algorithm, name) => algorithm.name === name;\nfunction getHashLength(hash) {\n    return parseInt(hash.name.slice(4), 10);\n}\nfunction getNamedCurve(alg) {\n    switch (alg) {\n        case 'ES256':\n            return 'P-256';\n        case 'ES384':\n            return 'P-384';\n        case 'ES512':\n            return 'P-521';\n        default:\n            throw new Error('unreachable');\n    }\n}\nfunction checkUsage(key, usage) {\n    if (usage && !key.usages.includes(usage)) {\n        throw new TypeError(`CryptoKey does not support this operation, its usages must include ${usage}.`);\n    }\n}\nexport function checkSigCryptoKey(key, alg, usage) {\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512': {\n            if (!isAlgorithm(key.algorithm, 'HMAC'))\n                throw unusable('HMAC');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'RS256':\n        case 'RS384':\n        case 'RS512': {\n            if (!isAlgorithm(key.algorithm, 'RSASSA-PKCS1-v1_5'))\n                throw unusable('RSASSA-PKCS1-v1_5');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'PS256':\n        case 'PS384':\n        case 'PS512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-PSS'))\n                throw unusable('RSA-PSS');\n            const expected = parseInt(alg.slice(2), 10);\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        case 'Ed25519':\n        case 'EdDSA': {\n            if (!isAlgorithm(key.algorithm, 'Ed25519'))\n                throw unusable('Ed25519');\n            break;\n        }\n        case 'ML-DSA-44':\n        case 'ML-DSA-65':\n        case 'ML-DSA-87': {\n            if (!isAlgorithm(key.algorithm, alg))\n                throw unusable(alg);\n            break;\n        }\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            if (!isAlgorithm(key.algorithm, 'ECDSA'))\n                throw unusable('ECDSA');\n            const expected = getNamedCurve(alg);\n            const actual = key.algorithm.namedCurve;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.namedCurve');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usage);\n}\nexport function checkEncCryptoKey(key, alg, usage) {\n    switch (alg) {\n        case 'A128GCM':\n        case 'A192GCM':\n        case 'A256GCM': {\n            if (!isAlgorithm(key.algorithm, 'AES-GCM'))\n                throw unusable('AES-GCM');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'A128KW':\n        case 'A192KW':\n        case 'A256KW': {\n            if (!isAlgorithm(key.algorithm, 'AES-KW'))\n                throw unusable('AES-KW');\n            const expected = parseInt(alg.slice(1, 4), 10);\n            const actual = key.algorithm.length;\n            if (actual !== expected)\n                throw unusable(expected, 'algorithm.length');\n            break;\n        }\n        case 'ECDH': {\n            switch (key.algorithm.name) {\n                case 'ECDH':\n                case 'X25519':\n                    break;\n                default:\n                    throw unusable('ECDH or X25519');\n            }\n            break;\n        }\n        case 'PBES2-HS256+A128KW':\n        case 'PBES2-HS384+A192KW':\n        case 'PBES2-HS512+A256KW':\n            if (!isAlgorithm(key.algorithm, 'PBKDF2'))\n                throw unusable('PBKDF2');\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512': {\n            if (!isAlgorithm(key.algorithm, 'RSA-OAEP'))\n                throw unusable('RSA-OAEP');\n            const expected = parseInt(alg.slice(9), 10) || 1;\n            const actual = getHashLength(key.algorithm.hash);\n            if (actual !== expected)\n                throw unusable(`SHA-${expected}`, 'algorithm.hash');\n            break;\n        }\n        default:\n            throw new TypeError('CryptoKey does not support this operation');\n    }\n    checkUsage(key, usage);\n}\n", "function message(msg, actual, ...types) {\n    types = types.filter(Boolean);\n    if (types.length > 2) {\n        const last = types.pop();\n        msg += `one of type ${types.join(', ')}, or ${last}.`;\n    }\n    else if (types.length === 2) {\n        msg += `one of type ${types[0]} or ${types[1]}.`;\n    }\n    else {\n        msg += `of type ${types[0]}.`;\n    }\n    if (actual == null) {\n        msg += ` Received ${actual}`;\n    }\n    else if (typeof actual === 'function' && actual.name) {\n        msg += ` Received function ${actual.name}`;\n    }\n    else if (typeof actual === 'object' && actual != null) {\n        if (actual.constructor?.name) {\n            msg += ` Received an instance of ${actual.constructor.name}`;\n        }\n    }\n    return msg;\n}\nexport const invalidKeyInput = (actual, ...types) => message('Key must be ', actual, ...types);\nexport const withAlg = (alg, actual, ...types) => message(`Key for the ${alg} algorithm must be `, actual, ...types);\n", "export function assertCryptoKey(key) {\n    if (!isCryptoKey(key)) {\n        throw new Error('CryptoKey instance expected');\n    }\n}\nexport const isCryptoKey = (key) => {\n    if (key?.[Symbol.toStringTag] === 'CryptoKey')\n        return true;\n    try {\n        return key instanceof CryptoKey;\n    }\n    catch {\n        return false;\n    }\n};\nexport const isKeyObject = (key) => key?.[Symbol.toStringTag] === 'KeyObject';\nexport const isKeyLike = (key) => isCryptoKey(key) || isKeyObject(key);\n", "export function isDisjoint(...headers) {\n    const sources = headers.filter(Boolean);\n    if (sources.length === 0 || sources.length === 1) {\n        return true;\n    }\n    let acc;\n    for (const header of sources) {\n        const parameters = Object.keys(header);\n        if (!acc || acc.size === 0) {\n            acc = new Set(parameters);\n            continue;\n        }\n        for (const parameter of parameters) {\n            if (acc.has(parameter)) {\n                return false;\n            }\n            acc.add(parameter);\n        }\n    }\n    return true;\n}\n", "const isObjectLike = (value) => typeof value === 'object' && value !== null;\nexport function isObject(input) {\n    if (!isObjectLike(input) || Object.prototype.toString.call(input) !== '[object Object]') {\n        return false;\n    }\n    if (Object.getPrototypeOf(input) === null) {\n        return true;\n    }\n    let proto = input;\n    while (Object.getPrototypeOf(proto) !== null) {\n        proto = Object.getPrototypeOf(proto);\n    }\n    return Object.getPrototypeOf(input) === proto;\n}\n", "export function checkKeyLength(alg, key) {\n    if (alg.startsWith('RS') || alg.startsWith('PS')) {\n        const { modulusLength } = key.algorithm;\n        if (typeof modulusLength !== 'number' || modulusLength < 2048) {\n            throw new TypeError(`${alg} requires key modulusLength to be 2048 bits or larger`);\n        }\n    }\n}\n", "import { invalidKeyInput } from './invalid_key_input.js';\nimport { encodeBase64, decodeBase64 } from '../lib/base64.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { isCryptoKey, isKeyObject } from './is_key_like.js';\nconst formatPEM = (b64, descriptor) => {\n    const newlined = (b64.match(/.{1,64}/g) || []).join('\\n');\n    return `-----BEGIN ${descriptor}-----\\n${newlined}\\n-----END ${descriptor}-----`;\n};\nconst genericExport = async (keyType, keyFormat, key) => {\n    if (isKeyObject(key)) {\n        if (key.type !== keyType) {\n            throw new TypeError(`key is not a ${keyType} key`);\n        }\n        return key.export({ format: 'pem', type: keyFormat });\n    }\n    if (!isCryptoKey(key)) {\n        throw new TypeError(invalidKeyInput(key, 'CryptoKey', 'KeyObject'));\n    }\n    if (!key.extractable) {\n        throw new TypeError('CryptoKey is not extractable');\n    }\n    if (key.type !== keyType) {\n        throw new TypeError(`key is not a ${keyType} key`);\n    }\n    return formatPEM(encodeBase64(new Uint8Array(await crypto.subtle.exportKey(keyFormat, key))), `${keyType.toUpperCase()} KEY`);\n};\nexport const toSPKI = (key) => genericExport('public', 'spki', key);\nexport const toPKCS8 = (key) => genericExport('private', 'pkcs8', key);\nconst bytesEqual = (a, b) => {\n    if (a.byteLength !== b.length)\n        return false;\n    for (let i = 0; i < a.byteLength; i++) {\n        if (a[i] !== b[i])\n            return false;\n    }\n    return true;\n};\nconst createASN1State = (data) => ({ data, pos: 0 });\nconst parseLength = (state) => {\n    const first = state.data[state.pos++];\n    if (first & 0x80) {\n        const lengthOfLen = first & 0x7f;\n        let length = 0;\n        for (let i = 0; i < lengthOfLen; i++) {\n            length = (length << 8) | state.data[state.pos++];\n        }\n        return length;\n    }\n    return first;\n};\nconst skipElement = (state, count = 1) => {\n    if (count <= 0)\n        return;\n    state.pos++;\n    const length = parseLength(state);\n    state.pos += length;\n    if (count > 1) {\n        skipElement(state, count - 1);\n    }\n};\nconst expectTag = (state, expectedTag, errorMessage) => {\n    if (state.data[state.pos++] !== expectedTag) {\n        throw new Error(errorMessage);\n    }\n};\nconst getSubarray = (state, length) => {\n    const result = state.data.subarray(state.pos, state.pos + length);\n    state.pos += length;\n    return result;\n};\nconst parseAlgorithmOID = (state) => {\n    expectTag(state, 0x06, 'Expected algorithm OID');\n    const oidLen = parseLength(state);\n    return getSubarray(state, oidLen);\n};\nfunction parsePKCS8Header(state) {\n    expectTag(state, 0x30, 'Invalid PKCS#8 structure');\n    parseLength(state);\n    expectTag(state, 0x02, 'Expected version field');\n    const verLen = parseLength(state);\n    state.pos += verLen;\n    expectTag(state, 0x30, 'Expected algorithm identifier');\n    const algIdLen = parseLength(state);\n    const algIdStart = state.pos;\n    return { algIdStart, algIdLength: algIdLen };\n}\nfunction parseSPKIHeader(state) {\n    expectTag(state, 0x30, 'Invalid SPKI structure');\n    parseLength(state);\n    expectTag(state, 0x30, 'Expected algorithm identifier');\n    const algIdLen = parseLength(state);\n    const algIdStart = state.pos;\n    return { algIdStart, algIdLength: algIdLen };\n}\nconst parseECAlgorithmIdentifier = (state) => {\n    const algOid = parseAlgorithmOID(state);\n    if (bytesEqual(algOid, [0x2b, 0x65, 0x6e])) {\n        return 'X25519';\n    }\n    if (!bytesEqual(algOid, [0x2a, 0x86, 0x48, 0xce, 0x3d, 0x02, 0x01])) {\n        throw new Error('Unsupported key algorithm');\n    }\n    expectTag(state, 0x06, 'Expected curve OID');\n    const curveOidLen = parseLength(state);\n    const curveOid = getSubarray(state, curveOidLen);\n    for (const { name, oid } of [\n        { name: 'P-256', oid: [0x2a, 0x86, 0x48, 0xce, 0x3d, 0x03, 0x01, 0x07] },\n        { name: 'P-384', oid: [0x2b, 0x81, 0x04, 0x00, 0x22] },\n        { name: 'P-521', oid: [0x2b, 0x81, 0x04, 0x00, 0x23] },\n    ]) {\n        if (bytesEqual(curveOid, oid)) {\n            return name;\n        }\n    }\n    throw new Error('Unsupported named curve');\n};\nconst genericImport = async (keyFormat, keyData, alg, options) => {\n    let algorithm;\n    let keyUsages;\n    const isPublic = keyFormat === 'spki';\n    const getSigUsages = () => (isPublic ? ['verify'] : ['sign']);\n    const getEncUsages = () => isPublic ? ['encrypt', 'wrapKey'] : ['decrypt', 'unwrapKey'];\n    switch (alg) {\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            algorithm = { name: 'RSA-PSS', hash: `SHA-${alg.slice(-3)}` };\n            keyUsages = getSigUsages();\n            break;\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${alg.slice(-3)}` };\n            keyUsages = getSigUsages();\n            break;\n        case 'RSA-OAEP':\n        case 'RSA-OAEP-256':\n        case 'RSA-OAEP-384':\n        case 'RSA-OAEP-512':\n            algorithm = {\n                name: 'RSA-OAEP',\n                hash: `SHA-${parseInt(alg.slice(-3), 10) || 1}`,\n            };\n            keyUsages = getEncUsages();\n            break;\n        case 'ES256':\n        case 'ES384':\n        case 'ES512': {\n            const curveMap = { ES256: 'P-256', ES384: 'P-384', ES512: 'P-521' };\n            algorithm = { name: 'ECDSA', namedCurve: curveMap[alg] };\n            keyUsages = getSigUsages();\n            break;\n        }\n        case 'ECDH-ES':\n        case 'ECDH-ES+A128KW':\n        case 'ECDH-ES+A192KW':\n        case 'ECDH-ES+A256KW': {\n            try {\n                const namedCurve = options.getNamedCurve(keyData);\n                algorithm = namedCurve === 'X25519' ? { name: 'X25519' } : { name: 'ECDH', namedCurve };\n            }\n            catch (cause) {\n                throw new JOSENotSupported('Invalid or unsupported key format');\n            }\n            keyUsages = isPublic ? [] : ['deriveBits'];\n            break;\n        }\n        case 'Ed25519':\n        case 'EdDSA':\n            algorithm = { name: 'Ed25519' };\n            keyUsages = getSigUsages();\n            break;\n        case 'ML-DSA-44':\n        case 'ML-DSA-65':\n        case 'ML-DSA-87':\n            algorithm = { name: alg };\n            keyUsages = getSigUsages();\n            break;\n        default:\n            throw new JOSENotSupported('Invalid or unsupported \"alg\" (Algorithm) value');\n    }\n    return crypto.subtle.importKey(keyFormat, keyData, algorithm, options?.extractable ?? (isPublic ? true : false), keyUsages);\n};\nconst processPEMData = (pem, pattern) => {\n    return decodeBase64(pem.replace(pattern, ''));\n};\nexport const fromPKCS8 = (pem, alg, options) => {\n    const keyData = processPEMData(pem, /(?:-----(?:BEGIN|END) PRIVATE KEY-----|\\s)/g);\n    let opts = options;\n    if (alg?.startsWith?.('ECDH-ES')) {\n        opts ||= {};\n        opts.getNamedCurve = (keyData) => {\n            const state = createASN1State(keyData);\n            parsePKCS8Header(state);\n            return parseECAlgorithmIdentifier(state);\n        };\n    }\n    return genericImport('pkcs8', keyData, alg, opts);\n};\nexport const fromSPKI = (pem, alg, options) => {\n    const keyData = processPEMData(pem, /(?:-----(?:BEGIN|END) PUBLIC KEY-----|\\s)/g);\n    let opts = options;\n    if (alg?.startsWith?.('ECDH-ES')) {\n        opts ||= {};\n        opts.getNamedCurve = (keyData) => {\n            const state = createASN1State(keyData);\n            parseSPKIHeader(state);\n            return parseECAlgorithmIdentifier(state);\n        };\n    }\n    return genericImport('spki', keyData, alg, opts);\n};\nfunction spkiFromX509(buf) {\n    const state = createASN1State(buf);\n    expectTag(state, 0x30, 'Invalid certificate structure');\n    parseLength(state);\n    expectTag(state, 0x30, 'Invalid tbsCertificate structure');\n    parseLength(state);\n    if (buf[state.pos] === 0xa0) {\n        skipElement(state, 6);\n    }\n    else {\n        skipElement(state, 5);\n    }\n    const spkiStart = state.pos;\n    expectTag(state, 0x30, 'Invalid SPKI structure');\n    const spkiContentLen = parseLength(state);\n    return buf.subarray(spkiStart, spkiStart + spkiContentLen + (state.pos - spkiStart));\n}\nfunction extractX509SPKI(x509) {\n    const derBytes = processPEMData(x509, /(?:-----(?:BEGIN|END) CERTIFICATE-----|\\s)/g);\n    return spkiFromX509(derBytes);\n}\nexport const fromX509 = (pem, alg, options) => {\n    let spki;\n    try {\n        spki = extractX509SPKI(pem);\n    }\n    catch (cause) {\n        throw new TypeError('Failed to parse the X.509 certificate', { cause });\n    }\n    return fromSPKI(formatPEM(encodeBase64(spki), 'PUBLIC KEY'), alg, options);\n};\n", "import { JOSENotSupported } from '../util/errors.js';\nfunction subtleMapping(jwk) {\n    let algorithm;\n    let keyUsages;\n    switch (jwk.kty) {\n        case 'AKP': {\n            switch (jwk.alg) {\n                case 'ML-DSA-44':\n                case 'ML-DSA-65':\n                case 'ML-DSA-87':\n                    algorithm = { name: jwk.alg };\n                    keyUsages = jwk.priv ? ['sign'] : ['verify'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'RSA': {\n            switch (jwk.alg) {\n                case 'PS256':\n                case 'PS384':\n                case 'PS512':\n                    algorithm = { name: 'RSA-PSS', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RS256':\n                case 'RS384':\n                case 'RS512':\n                    algorithm = { name: 'RSASSA-PKCS1-v1_5', hash: `SHA-${jwk.alg.slice(-3)}` };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'RSA-OAEP':\n                case 'RSA-OAEP-256':\n                case 'RSA-OAEP-384':\n                case 'RSA-OAEP-512':\n                    algorithm = {\n                        name: 'RSA-OAEP',\n                        hash: `SHA-${parseInt(jwk.alg.slice(-3), 10) || 1}`,\n                    };\n                    keyUsages = jwk.d ? ['decrypt', 'unwrapKey'] : ['encrypt', 'wrapKey'];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'EC': {\n            switch (jwk.alg) {\n                case 'ES256':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-256' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES384':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-384' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ES512':\n                    algorithm = { name: 'ECDSA', namedCurve: 'P-521' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: 'ECDH', namedCurve: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        case 'OKP': {\n            switch (jwk.alg) {\n                case 'Ed25519':\n                case 'EdDSA':\n                    algorithm = { name: 'Ed25519' };\n                    keyUsages = jwk.d ? ['sign'] : ['verify'];\n                    break;\n                case 'ECDH-ES':\n                case 'ECDH-ES+A128KW':\n                case 'ECDH-ES+A192KW':\n                case 'ECDH-ES+A256KW':\n                    algorithm = { name: jwk.crv };\n                    keyUsages = jwk.d ? ['deriveBits'] : [];\n                    break;\n                default:\n                    throw new JOSENotSupported('Invalid or unsupported JWK \"alg\" (Algorithm) Parameter value');\n            }\n            break;\n        }\n        default:\n            throw new JOSENotSupported('Invalid or unsupported JWK \"kty\" (Key Type) Parameter value');\n    }\n    return { algorithm, keyUsages };\n}\nexport async function jwkToKey(jwk) {\n    if (!jwk.alg) {\n        throw new TypeError('\"alg\" argument is required when \"jwk.alg\" is not present');\n    }\n    const { algorithm, keyUsages } = subtleMapping(jwk);\n    const keyData = { ...jwk };\n    if (keyData.kty !== 'AKP') {\n        delete keyData.alg;\n    }\n    delete keyData.use;\n    return crypto.subtle.importKey('jwk', keyData, algorithm, jwk.ext ?? (jwk.d || jwk.priv ? false : true), jwk.key_ops ?? keyUsages);\n}\n", "import { decode as decodeBase64URL } from '../util/base64url.js';\nimport { fromSPKI, fromPKCS8, fromX509 } from '../lib/asn1.js';\nimport { jwkToKey } from '../lib/jwk_to_key.js';\nimport { JOSENotSupported } from '../util/errors.js';\nimport { isObject } from '../lib/is_object.js';\nexport async function importSPKI(spki, alg, options) {\n    if (typeof spki !== 'string' || spki.indexOf('-----BEGIN PUBLIC KEY-----') !== 0) {\n        throw new TypeError('\"spki\" must be SPKI formatted string');\n    }\n    return fromSPKI(spki, alg, options);\n}\nexport async function importX509(x509, alg, options) {\n    if (typeof x509 !== 'string' || x509.indexOf('-----BEGIN CERTIFICATE-----') !== 0) {\n        throw new TypeError('\"x509\" must be X.509 formatted string');\n    }\n    return fromX509(x509, alg, options);\n}\nexport async function importPKCS8(pkcs8, alg, options) {\n    if (typeof pkcs8 !== 'string' || pkcs8.indexOf('-----BEGIN PRIVATE KEY-----') !== 0) {\n        throw new TypeError('\"pkcs8\" must be PKCS#8 formatted string');\n    }\n    return fromPKCS8(pkcs8, alg, options);\n}\nexport async function importJWK(jwk, alg, options) {\n    if (!isObject(jwk)) {\n        throw new TypeError('JWK must be an object');\n    }\n    let ext;\n    alg ??= jwk.alg;\n    ext ??= options?.extractable ?? jwk.ext;\n    switch (jwk.kty) {\n        case 'oct':\n            if (typeof jwk.k !== 'string' || !jwk.k) {\n                throw new TypeError('missing \"k\" (Key Value) Parameter value');\n            }\n            return decodeBase64URL(jwk.k);\n        case 'RSA':\n            if ('oth' in jwk && jwk.oth !== undefined) {\n                throw new JOSENotSupported('RSA JWK \"oth\" (Other Primes Info) Parameter value is not supported');\n            }\n            return jwkToKey({ ...jwk, alg, ext });\n        case 'AKP': {\n            if (typeof jwk.alg !== 'string' || !jwk.alg) {\n                throw new TypeError('missing \"alg\" (Algorithm) Parameter value');\n            }\n            if (alg !== undefined && alg !== jwk.alg) {\n                throw new TypeError('JWK alg and alg option value mismatch');\n            }\n            return jwkToKey({ ...jwk, ext });\n        }\n        case 'EC':\n        case 'OKP':\n            return jwkToKey({ ...jwk, alg, ext });\n        default:\n            throw new JOSENotSupported('Unsupported \"kty\" (Key Type) Parameter value');\n    }\n}\n", "import { JOSENotSupported, JWEInvalid, JWSInvalid } from '../util/errors.js';\nexport function validateCrit(Err, recognizedDefault, recognizedOption, protectedHeader, joseHeader) {\n    if (joseHeader.crit !== undefined && protectedHeader?.crit === undefined) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be integrity protected');\n    }\n    if (!protectedHeader || protectedHeader.crit === undefined) {\n        return new Set();\n    }\n    if (!Array.isArray(protectedHeader.crit) ||\n        protectedHeader.crit.length === 0 ||\n        protectedHeader.crit.some((input) => typeof input !== 'string' || input.length === 0)) {\n        throw new Err('\"crit\" (Critical) Header Parameter MUST be an array of non-empty strings when present');\n    }\n    let recognized;\n    if (recognizedOption !== undefined) {\n        recognized = new Map([...Object.entries(recognizedOption), ...recognizedDefault.entries()]);\n    }\n    else {\n        recognized = recognizedDefault;\n    }\n    for (const parameter of protectedHeader.crit) {\n        if (!recognized.has(parameter)) {\n            throw new JOSENotSupported(`Extension Header Parameter \"${parameter}\" is not recognized`);\n        }\n        if (joseHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" is missing`);\n        }\n        if (recognized.get(parameter) && protectedHeader[parameter] === undefined) {\n            throw new Err(`Extension Header Parameter \"${parameter}\" MUST be integrity protected`);\n        }\n    }\n    return new Set(protectedHeader.crit);\n}\n", "import { isObject } from './is_object.js';\nexport const isJWK = (key) => isObject(key) && typeof key.kty === 'string';\nexport const isPrivateJWK = (key) => key.kty !== 'oct' &&\n    ((key.kty === 'AKP' && typeof key.priv === 'string') || typeof key.d === 'string');\nexport const isPublicJWK = (key) => key.kty !== 'oct' && key.d === undefined && key.priv === undefined;\nexport const isSecretJWK = (key) => key.kty === 'oct' && typeof key.k === 'string';\n", "import { isJWK } from './is_jwk.js';\nimport { decode } from '../util/base64url.js';\nimport { jwkToKey } from './jwk_to_key.js';\nimport { isCryptoKey, isKeyObject } from './is_key_like.js';\nlet cache;\nconst handleJWK = async (key, jwk, alg, freeze = false) => {\n    cache ||= new WeakMap();\n    let cached = cache.get(key);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const cryptoKey = await jwkToKey({ ...jwk, alg });\n    if (freeze)\n        Object.freeze(key);\n    if (!cached) {\n        cache.set(key, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nconst handleKeyObject = (keyObject, alg) => {\n    cache ||= new WeakMap();\n    let cached = cache.get(keyObject);\n    if (cached?.[alg]) {\n        return cached[alg];\n    }\n    const isPublic = keyObject.type === 'public';\n    const extractable = isPublic ? true : false;\n    let cryptoKey;\n    if (keyObject.asymmetricKeyType === 'x25519') {\n        switch (alg) {\n            case 'ECDH-ES':\n            case 'ECDH-ES+A128KW':\n            case 'ECDH-ES+A192KW':\n            case 'ECDH-ES+A256KW':\n                break;\n            default:\n                throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n        }\n        cryptoKey = keyObject.toCryptoKey(keyObject.asymmetricKeyType, extractable, isPublic ? [] : ['deriveBits']);\n    }\n    if (keyObject.asymmetricKeyType === 'ed25519') {\n        if (alg !== 'EdDSA' && alg !== 'Ed25519') {\n            throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n        }\n        cryptoKey = keyObject.toCryptoKey(keyObject.asymmetricKeyType, extractable, [\n            isPublic ? 'verify' : 'sign',\n        ]);\n    }\n    switch (keyObject.asymmetricKeyType) {\n        case 'ml-dsa-44':\n        case 'ml-dsa-65':\n        case 'ml-dsa-87': {\n            if (alg !== keyObject.asymmetricKeyType.toUpperCase()) {\n                throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n            }\n            cryptoKey = keyObject.toCryptoKey(keyObject.asymmetricKeyType, extractable, [\n                isPublic ? 'verify' : 'sign',\n            ]);\n        }\n    }\n    if (keyObject.asymmetricKeyType === 'rsa') {\n        let hash;\n        switch (alg) {\n            case 'RSA-OAEP':\n                hash = 'SHA-1';\n                break;\n            case 'RS256':\n            case 'PS256':\n            case 'RSA-OAEP-256':\n                hash = 'SHA-256';\n                break;\n            case 'RS384':\n            case 'PS384':\n            case 'RSA-OAEP-384':\n                hash = 'SHA-384';\n                break;\n            case 'RS512':\n            case 'PS512':\n            case 'RSA-OAEP-512':\n                hash = 'SHA-512';\n                break;\n            default:\n                throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n        }\n        if (alg.startsWith('RSA-OAEP')) {\n            return keyObject.toCryptoKey({\n                name: 'RSA-OAEP',\n                hash,\n            }, extractable, isPublic ? ['encrypt'] : ['decrypt']);\n        }\n        cryptoKey = keyObject.toCryptoKey({\n            name: alg.startsWith('PS') ? 'RSA-PSS' : 'RSASSA-PKCS1-v1_5',\n            hash,\n        }, extractable, [isPublic ? 'verify' : 'sign']);\n    }\n    if (keyObject.asymmetricKeyType === 'ec') {\n        const nist = new Map([\n            ['prime256v1', 'P-256'],\n            ['secp384r1', 'P-384'],\n            ['secp521r1', 'P-521'],\n        ]);\n        const namedCurve = nist.get(keyObject.asymmetricKeyDetails?.namedCurve);\n        if (!namedCurve) {\n            throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n        }\n        if (alg === 'ES256' && namedCurve === 'P-256') {\n            cryptoKey = keyObject.toCryptoKey({\n                name: 'ECDSA',\n                namedCurve,\n            }, extractable, [isPublic ? 'verify' : 'sign']);\n        }\n        if (alg === 'ES384' && namedCurve === 'P-384') {\n            cryptoKey = keyObject.toCryptoKey({\n                name: 'ECDSA',\n                namedCurve,\n            }, extractable, [isPublic ? 'verify' : 'sign']);\n        }\n        if (alg === 'ES512' && namedCurve === 'P-521') {\n            cryptoKey = keyObject.toCryptoKey({\n                name: 'ECDSA',\n                namedCurve,\n            }, extractable, [isPublic ? 'verify' : 'sign']);\n        }\n        if (alg.startsWith('ECDH-ES')) {\n            cryptoKey = keyObject.toCryptoKey({\n                name: 'ECDH',\n                namedCurve,\n            }, extractable, isPublic ? [] : ['deriveBits']);\n        }\n    }\n    if (!cryptoKey) {\n        throw new TypeError('given KeyObject instance cannot be used for this algorithm');\n    }\n    if (!cached) {\n        cache.set(keyObject, { [alg]: cryptoKey });\n    }\n    else {\n        cached[alg] = cryptoKey;\n    }\n    return cryptoKey;\n};\nexport async function normalizeKey(key, alg) {\n    if (key instanceof Uint8Array) {\n        return key;\n    }\n    if (isCryptoKey(key)) {\n        return key;\n    }\n    if (isKeyObject(key)) {\n        if (key.type === 'secret') {\n            return key.export();\n        }\n        if ('toCryptoKey' in key && typeof key.toCryptoKey === 'function') {\n            try {\n                return handleKeyObject(key, alg);\n            }\n            catch (err) {\n                if (err instanceof TypeError) {\n                    throw err;\n                }\n            }\n        }\n        let jwk = key.export({ format: 'jwk' });\n        return handleJWK(key, jwk, alg);\n    }\n    if (isJWK(key)) {\n        if (key.k) {\n            return decode(key.k);\n        }\n        return handleJWK(key, key, alg, true);\n    }\n    throw new Error('unreachable');\n}\n", "import { withAlg as invalidKeyInput } from './invalid_key_input.js';\nimport { isKeyLike } from './is_key_like.js';\nimport * as jwk from './is_jwk.js';\nconst tag = (key) => key?.[Symbol.toStringTag];\nconst jwkMatchesOp = (alg, key, usage) => {\n    if (key.use !== undefined) {\n        let expected;\n        switch (usage) {\n            case 'sign':\n            case 'verify':\n                expected = 'sig';\n                break;\n            case 'encrypt':\n            case 'decrypt':\n                expected = 'enc';\n                break;\n        }\n        if (key.use !== expected) {\n            throw new TypeError(`Invalid key for this operation, its \"use\" must be \"${expected}\" when present`);\n        }\n    }\n    if (key.alg !== undefined && key.alg !== alg) {\n        throw new TypeError(`Invalid key for this operation, its \"alg\" must be \"${alg}\" when present`);\n    }\n    if (Array.isArray(key.key_ops)) {\n        let expectedKeyOp;\n        switch (true) {\n            case usage === 'sign' || usage === 'verify':\n            case alg === 'dir':\n            case alg.includes('CBC-HS'):\n                expectedKeyOp = usage;\n                break;\n            case alg.startsWith('PBES2'):\n                expectedKeyOp = 'deriveBits';\n                break;\n            case /^A\\d{3}(?:GCM)?(?:KW)?$/.test(alg):\n                if (!alg.includes('GCM') && alg.endsWith('KW')) {\n                    expectedKeyOp = usage === 'encrypt' ? 'wrapKey' : 'unwrapKey';\n                }\n                else {\n                    expectedKeyOp = usage;\n                }\n                break;\n            case usage === 'encrypt' && alg.startsWith('RSA'):\n                expectedKeyOp = 'wrapKey';\n                break;\n            case usage === 'decrypt':\n                expectedKeyOp = alg.startsWith('RSA') ? 'unwrapKey' : 'deriveBits';\n                break;\n        }\n        if (expectedKeyOp && key.key_ops?.includes?.(expectedKeyOp) === false) {\n            throw new TypeError(`Invalid key for this operation, its \"key_ops\" must include \"${expectedKeyOp}\" when present`);\n        }\n    }\n    return true;\n};\nconst symmetricTypeCheck = (alg, key, usage) => {\n    if (key instanceof Uint8Array)\n        return;\n    if (jwk.isJWK(key)) {\n        if (jwk.isSecretJWK(key) && jwkMatchesOp(alg, key, usage))\n            return;\n        throw new TypeError(`JSON Web Key for symmetric algorithms must have JWK \"kty\" (Key Type) equal to \"oct\" and the JWK \"k\" (Key Value) present`);\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, 'CryptoKey', 'KeyObject', 'JSON Web Key', 'Uint8Array'));\n    }\n    if (key.type !== 'secret') {\n        throw new TypeError(`${tag(key)} instances for symmetric algorithms must be of type \"secret\"`);\n    }\n};\nconst asymmetricTypeCheck = (alg, key, usage) => {\n    if (jwk.isJWK(key)) {\n        switch (usage) {\n            case 'decrypt':\n            case 'sign':\n                if (jwk.isPrivateJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation must be a private JWK`);\n            case 'encrypt':\n            case 'verify':\n                if (jwk.isPublicJWK(key) && jwkMatchesOp(alg, key, usage))\n                    return;\n                throw new TypeError(`JSON Web Key for this operation must be a public JWK`);\n        }\n    }\n    if (!isKeyLike(key)) {\n        throw new TypeError(invalidKeyInput(alg, key, 'CryptoKey', 'KeyObject', 'JSON Web Key'));\n    }\n    if (key.type === 'secret') {\n        throw new TypeError(`${tag(key)} instances for asymmetric algorithms must not be of type \"secret\"`);\n    }\n    if (key.type === 'public') {\n        switch (usage) {\n            case 'sign':\n                throw new TypeError(`${tag(key)} instances for asymmetric algorithm signing must be of type \"private\"`);\n            case 'decrypt':\n                throw new TypeError(`${tag(key)} instances for asymmetric algorithm decryption must be of type \"private\"`);\n        }\n    }\n    if (key.type === 'private') {\n        switch (usage) {\n            case 'verify':\n                throw new TypeError(`${tag(key)} instances for asymmetric algorithm verifying must be of type \"public\"`);\n            case 'encrypt':\n                throw new TypeError(`${tag(key)} instances for asymmetric algorithm encryption must be of type \"public\"`);\n        }\n    }\n};\nexport function checkKeyType(alg, key, usage) {\n    switch (alg.substring(0, 2)) {\n        case 'A1':\n        case 'A2':\n        case 'di':\n        case 'HS':\n        case 'PB':\n            symmetricTypeCheck(alg, key, usage);\n            break;\n        default:\n            asymmetricTypeCheck(alg, key, usage);\n    }\n}\n", "import { JOSENotSupported } from '../util/errors.js';\nexport function subtleAlgorithm(alg, algorithm) {\n    const hash = `SHA-${alg.slice(-3)}`;\n    switch (alg) {\n        case 'HS256':\n        case 'HS384':\n        case 'HS512':\n            return { hash, name: 'HMAC' };\n        case 'PS256':\n        case 'PS384':\n        case 'PS512':\n            return { hash, name: 'RSA-PSS', saltLength: parseInt(alg.slice(-3), 10) >> 3 };\n        case 'RS256':\n        case 'RS384':\n        case 'RS512':\n            return { hash, name: 'RSASSA-PKCS1-v1_5' };\n        case 'ES256':\n        case 'ES384':\n        case 'ES512':\n            return { hash, name: 'ECDSA', namedCurve: algorithm.namedCurve };\n        case 'Ed25519':\n        case 'EdDSA':\n            return { name: 'Ed25519' };\n        case 'ML-DSA-44':\n        case 'ML-DSA-65':\n        case 'ML-DSA-87':\n            return { name: alg };\n        default:\n            throw new JOSENotSupported(`alg ${alg} is not supported either by JOSE or your javascript runtime`);\n    }\n}\n", "import { checkSigCryptoKey } from './crypto_key.js';\nimport { invalidKeyInput } from './invalid_key_input.js';\nexport async function getSigKey(alg, key, usage) {\n    if (key instanceof Uint8Array) {\n        if (!alg.startsWith('HS')) {\n            throw new TypeError(invalidKeyInput(key, 'CryptoKey', 'KeyObject', 'JSON Web Key'));\n        }\n        return crypto.subtle.importKey('raw', key, { hash: `SHA-${alg.slice(-3)}`, name: 'HMAC' }, false, [usage]);\n    }\n    checkSigCryptoKey(key, alg, usage);\n    return key;\n}\n", "import { JWTClaimValidationFailed, JWTExpired, JWTInvalid } from '../util/errors.js';\nimport { encoder, decoder } from './buffer_utils.js';\nimport { isObject } from './is_object.js';\nconst epoch = (date) => Math.floor(date.getTime() / 1000);\nconst minute = 60;\nconst hour = minute * 60;\nconst day = hour * 24;\nconst week = day * 7;\nconst year = day * 365.25;\nconst REGEX = /^(\\+|\\-)? ?(\\d+|\\d+\\.\\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;\nexport function secs(str) {\n    const matched = REGEX.exec(str);\n    if (!matched || (matched[4] && matched[1])) {\n        throw new TypeError('Invalid time period format');\n    }\n    const value = parseFloat(matched[2]);\n    const unit = matched[3].toLowerCase();\n    let numericDate;\n    switch (unit) {\n        case 'sec':\n        case 'secs':\n        case 'second':\n        case 'seconds':\n        case 's':\n            numericDate = Math.round(value);\n            break;\n        case 'minute':\n        case 'minutes':\n        case 'min':\n        case 'mins':\n        case 'm':\n            numericDate = Math.round(value * minute);\n            break;\n        case 'hour':\n        case 'hours':\n        case 'hr':\n        case 'hrs':\n        case 'h':\n            numericDate = Math.round(value * hour);\n            break;\n        case 'day':\n        case 'days':\n        case 'd':\n            numericDate = Math.round(value * day);\n            break;\n        case 'week':\n        case 'weeks':\n        case 'w':\n            numericDate = Math.round(value * week);\n            break;\n        default:\n            numericDate = Math.round(value * year);\n            break;\n    }\n    if (matched[1] === '-' || matched[4] === 'ago') {\n        return -numericDate;\n    }\n    return numericDate;\n}\nfunction validateInput(label, input) {\n    if (!Number.isFinite(input)) {\n        throw new TypeError(`Invalid ${label} input`);\n    }\n    return input;\n}\nconst normalizeTyp = (value) => {\n    if (value.includes('/')) {\n        return value.toLowerCase();\n    }\n    return `application/${value.toLowerCase()}`;\n};\nconst checkAudiencePresence = (audPayload, audOption) => {\n    if (typeof audPayload === 'string') {\n        return audOption.includes(audPayload);\n    }\n    if (Array.isArray(audPayload)) {\n        return audOption.some(Set.prototype.has.bind(new Set(audPayload)));\n    }\n    return false;\n};\nexport function validateClaimsSet(protectedHeader, encodedPayload, options = {}) {\n    let payload;\n    try {\n        payload = JSON.parse(decoder.decode(encodedPayload));\n    }\n    catch {\n    }\n    if (!isObject(payload)) {\n        throw new JWTInvalid('JWT Claims Set must be a top-level JSON object');\n    }\n    const { typ } = options;\n    if (typ &&\n        (typeof protectedHeader.typ !== 'string' ||\n            normalizeTyp(protectedHeader.typ) !== normalizeTyp(typ))) {\n        throw new JWTClaimValidationFailed('unexpected \"typ\" JWT header value', payload, 'typ', 'check_failed');\n    }\n    const { requiredClaims = [], issuer, subject, audience, maxTokenAge } = options;\n    const presenceCheck = [...requiredClaims];\n    if (maxTokenAge !== undefined)\n        presenceCheck.push('iat');\n    if (audience !== undefined)\n        presenceCheck.push('aud');\n    if (subject !== undefined)\n        presenceCheck.push('sub');\n    if (issuer !== undefined)\n        presenceCheck.push('iss');\n    for (const claim of new Set(presenceCheck.reverse())) {\n        if (!(claim in payload)) {\n            throw new JWTClaimValidationFailed(`missing required \"${claim}\" claim`, payload, claim, 'missing');\n        }\n    }\n    if (issuer &&\n        !(Array.isArray(issuer) ? issuer : [issuer]).includes(payload.iss)) {\n        throw new JWTClaimValidationFailed('unexpected \"iss\" claim value', payload, 'iss', 'check_failed');\n    }\n    if (subject && payload.sub !== subject) {\n        throw new JWTClaimValidationFailed('unexpected \"sub\" claim value', payload, 'sub', 'check_failed');\n    }\n    if (audience &&\n        !checkAudiencePresence(payload.aud, typeof audience === 'string' ? [audience] : audience)) {\n        throw new JWTClaimValidationFailed('unexpected \"aud\" claim value', payload, 'aud', 'check_failed');\n    }\n    let tolerance;\n    switch (typeof options.clockTolerance) {\n        case 'string':\n            tolerance = secs(options.clockTolerance);\n            break;\n        case 'number':\n            tolerance = options.clockTolerance;\n            break;\n        case 'undefined':\n            tolerance = 0;\n            break;\n        default:\n            throw new TypeError('Invalid clockTolerance option type');\n    }\n    const { currentDate } = options;\n    const now = epoch(currentDate || new Date());\n    if ((payload.iat !== undefined || maxTokenAge) && typeof payload.iat !== 'number') {\n        throw new JWTClaimValidationFailed('\"iat\" claim must be a number', payload, 'iat', 'invalid');\n    }\n    if (payload.nbf !== undefined) {\n        if (typeof payload.nbf !== 'number') {\n            throw new JWTClaimValidationFailed('\"nbf\" claim must be a number', payload, 'nbf', 'invalid');\n        }\n        if (payload.nbf > now + tolerance) {\n            throw new JWTClaimValidationFailed('\"nbf\" claim timestamp check failed', payload, 'nbf', 'check_failed');\n        }\n    }\n    if (payload.exp !== undefined) {\n        if (typeof payload.exp !== 'number') {\n            throw new JWTClaimValidationFailed('\"exp\" claim must be a number', payload, 'exp', 'invalid');\n        }\n        if (payload.exp <= now - tolerance) {\n            throw new JWTExpired('\"exp\" claim timestamp check failed', payload, 'exp', 'check_failed');\n        }\n    }\n    if (maxTokenAge) {\n        const age = now - payload.iat;\n        const max = typeof maxTokenAge === 'number' ? maxTokenAge : secs(maxTokenAge);\n        if (age - tolerance > max) {\n            throw new JWTExpired('\"iat\" claim timestamp check failed (too far in the past)', payload, 'iat', 'check_failed');\n        }\n        if (age < 0 - tolerance) {\n            throw new JWTClaimValidationFailed('\"iat\" claim timestamp check failed (it should be in the past)', payload, 'iat', 'check_failed');\n        }\n    }\n    return payload;\n}\nexport class JWTClaimsBuilder {\n    #payload;\n    constructor(payload) {\n        if (!isObject(payload)) {\n            throw new TypeError('JWT Claims Set MUST be an object');\n        }\n        this.#payload = structuredClone(payload);\n    }\n    data() {\n        return encoder.encode(JSON.stringify(this.#payload));\n    }\n    get iss() {\n        return this.#payload.iss;\n    }\n    set iss(value) {\n        this.#payload.iss = value;\n    }\n    get sub() {\n        return this.#payload.sub;\n    }\n    set sub(value) {\n        this.#payload.sub = value;\n    }\n    get aud() {\n        return this.#payload.aud;\n    }\n    set aud(value) {\n        this.#payload.aud = value;\n    }\n    set jti(value) {\n        this.#payload.jti = value;\n    }\n    set nbf(value) {\n        if (typeof value === 'number') {\n            this.#payload.nbf = validateInput('setNotBefore', value);\n        }\n        else if (value instanceof Date) {\n            this.#payload.nbf = validateInput('setNotBefore', epoch(value));\n        }\n        else {\n            this.#payload.nbf = epoch(new Date()) + secs(value);\n        }\n    }\n    set exp(value) {\n        if (typeof value === 'number') {\n            this.#payload.exp = validateInput('setExpirationTime', value);\n        }\n        else if (value instanceof Date) {\n            this.#payload.exp = validateInput('setExpirationTime', epoch(value));\n        }\n        else {\n            this.#payload.exp = epoch(new Date()) + secs(value);\n        }\n    }\n    set iat(value) {\n        if (value === undefined) {\n            this.#payload.iat = epoch(new Date());\n        }\n        else if (value instanceof Date) {\n            this.#payload.iat = validateInput('setIssuedAt', epoch(value));\n        }\n        else if (typeof value === 'string') {\n            this.#payload.iat = validateInput('setIssuedAt', epoch(new Date()) + secs(value));\n        }\n        else {\n            this.#payload.iat = validateInput('setIssuedAt', value);\n        }\n    }\n}\n", "import { subtleAlgorithm } from './subtle_dsa.js';\nimport { checkKeyLength } from './check_key_length.js';\nimport { getSigKey } from './get_sign_verify_key.js';\nexport async function sign(alg, key, data) {\n    const cryptoKey = await getSigKey(alg, key, 'sign');\n    checkKeyLength(alg, cryptoKey);\n    const signature = await crypto.subtle.sign(subtleAlgorithm(alg, cryptoKey.algorithm), cryptoKey, data);\n    return new Uint8Array(signature);\n}\n", "import { encode as b64u } from '../../util/base64url.js';\nimport { sign } from '../../lib/sign.js';\nimport { isDisjoint } from '../../lib/is_disjoint.js';\nimport { JWSInvalid } from '../../util/errors.js';\nimport { concat, encode } from '../../lib/buffer_utils.js';\nimport { checkKeyType } from '../../lib/check_key_type.js';\nimport { validateCrit } from '../../lib/validate_crit.js';\nimport { normalizeKey } from '../../lib/normalize_key.js';\nexport class FlattenedSign {\n    #payload;\n    #protectedHeader;\n    #unprotectedHeader;\n    constructor(payload) {\n        if (!(payload instanceof Uint8Array)) {\n            throw new TypeError('payload must be an instance of Uint8Array');\n        }\n        this.#payload = payload;\n    }\n    setProtectedHeader(protectedHeader) {\n        if (this.#protectedHeader) {\n            throw new TypeError('setProtectedHeader can only be called once');\n        }\n        this.#protectedHeader = protectedHeader;\n        return this;\n    }\n    setUnprotectedHeader(unprotectedHeader) {\n        if (this.#unprotectedHeader) {\n            throw new TypeError('setUnprotectedHeader can only be called once');\n        }\n        this.#unprotectedHeader = unprotectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        if (!this.#protectedHeader && !this.#unprotectedHeader) {\n            throw new JWSInvalid('either setProtectedHeader or setUnprotectedHeader must be called before #sign()');\n        }\n        if (!isDisjoint(this.#protectedHeader, this.#unprotectedHeader)) {\n            throw new JWSInvalid('JWS Protected and JWS Unprotected Header Parameter names must be disjoint');\n        }\n        const joseHeader = {\n            ...this.#protectedHeader,\n            ...this.#unprotectedHeader,\n        };\n        const extensions = validateCrit(JWSInvalid, new Map([['b64', true]]), options?.crit, this.#protectedHeader, joseHeader);\n        let b64 = true;\n        if (extensions.has('b64')) {\n            b64 = this.#protectedHeader.b64;\n            if (typeof b64 !== 'boolean') {\n                throw new JWSInvalid('The \"b64\" (base64url-encode payload) Header Parameter must be a boolean');\n            }\n        }\n        const { alg } = joseHeader;\n        if (typeof alg !== 'string' || !alg) {\n            throw new JWSInvalid('JWS \"alg\" (Algorithm) Header Parameter missing or invalid');\n        }\n        checkKeyType(alg, key, 'sign');\n        let payloadS;\n        let payloadB;\n        if (b64) {\n            payloadS = b64u(this.#payload);\n            payloadB = encode(payloadS);\n        }\n        else {\n            payloadB = this.#payload;\n            payloadS = '';\n        }\n        let protectedHeaderString;\n        let protectedHeaderBytes;\n        if (this.#protectedHeader) {\n            protectedHeaderString = b64u(JSON.stringify(this.#protectedHeader));\n            protectedHeaderBytes = encode(protectedHeaderString);\n        }\n        else {\n            protectedHeaderString = '';\n            protectedHeaderBytes = new Uint8Array();\n        }\n        const data = concat(protectedHeaderBytes, encode('.'), payloadB);\n        const k = await normalizeKey(key, alg);\n        const signature = await sign(alg, k, data);\n        const jws = {\n            signature: b64u(signature),\n            payload: payloadS,\n        };\n        if (this.#unprotectedHeader) {\n            jws.header = this.#unprotectedHeader;\n        }\n        if (this.#protectedHeader) {\n            jws.protected = protectedHeaderString;\n        }\n        return jws;\n    }\n}\n", "import { FlattenedSign } from '../flattened/sign.js';\nexport class CompactSign {\n    #flattened;\n    constructor(payload) {\n        this.#flattened = new FlattenedSign(payload);\n    }\n    setProtectedHeader(protectedHeader) {\n        this.#flattened.setProtectedHeader(protectedHeader);\n        return this;\n    }\n    async sign(key, options) {\n        const jws = await this.#flattened.sign(key, options);\n        if (jws.payload === undefined) {\n            throw new TypeError('use the flattened module for creating JWS with b64: false');\n        }\n        return `${jws.protected}.${jws.payload}.${jws.signature}`;\n    }\n}\n", "import { CompactSign } from '../jws/compact/sign.js';\nimport { JWTInvalid } from '../util/errors.js';\nimport { JWTClaimsBuilder } from '../lib/jwt_claims_set.js';\nexport class SignJWT {\n    #protectedHeader;\n    #jwt;\n    constructor(payload = {}) {\n        this.#jwt = new JWTClaimsBuilder(payload);\n    }\n    setIssuer(issuer) {\n        this.#jwt.iss = issuer;\n        return this;\n    }\n    setSubject(subject) {\n        this.#jwt.sub = subject;\n        return this;\n    }\n    setAudience(audience) {\n        this.#jwt.aud = audience;\n        return this;\n    }\n    setJti(jwtId) {\n        this.#jwt.jti = jwtId;\n        return this;\n    }\n    setNotBefore(input) {\n        this.#jwt.nbf = input;\n        return this;\n    }\n    setExpirationTime(input) {\n        this.#jwt.exp = input;\n        return this;\n    }\n    setIssuedAt(input) {\n        this.#jwt.iat = input;\n        return this;\n    }\n    setProtectedHeader(protectedHeader) {\n        this.#protectedHeader = protectedHeader;\n        return this;\n    }\n    async sign(key, options) {\n        const sig = new CompactSign(this.#jwt.data());\n        sig.setProtectedHeader(this.#protectedHeader);\n        if (Array.isArray(this.#protectedHeader?.crit) &&\n            this.#protectedHeader.crit.includes('b64') &&\n            this.#protectedHeader.b64 === false) {\n            throw new JWTInvalid('JWTs MUST NOT use unencoded payload');\n        }\n        return sig.sign(key, options);\n    }\n}\n", "\uFEFFimport { importPKCS8, SignJWT } from \"jose\";\n\ntype Env = {\n  FCM_SERVICE_ACCOUNT_JSON: string;\n  FCM_PROJECT_ID: string;\n};\n\nlet cached: { token: string; expMs: number } | null = null;\n\nconst nowSec = () => Math.floor(Date.now() / 1000);\n\nexport async function getFcmAccessToken(env: Env): Promise<string> {\n  if (cached && Date.now() < cached.expMs - 60_000) return cached.token;\n\n  const sa = JSON.parse(env.FCM_SERVICE_ACCOUNT_JSON);\n  const clientEmail: string = sa.client_email;\n  const privateKeyPem: string = sa.private_key;\n  const tokenUri: string = sa.token_uri || \"https://oauth2.googleapis.com/token\";\n\n  const iat = nowSec();\n  const exp = iat + 3600;\n\n  const pk = await importPKCS8(privateKeyPem, \"RS256\");\n\n  const jwt = await new SignJWT({ scope: \"https://www.googleapis.com/auth/firebase.messaging\" })\n    .setProtectedHeader({ alg: \"RS256\", typ: \"JWT\" })\n    .setIssuer(clientEmail)\n    .setSubject(clientEmail)\n    .setAudience(tokenUri)\n    .setIssuedAt(iat)\n    .setExpirationTime(exp)\n    .sign(pk);\n\n  const body = new URLSearchParams({\n    grant_type: \"urn:ietf:params:oauth:grant-type:jwt-bearer\",\n    assertion: jwt\n  });\n\n  const resp = await fetch(tokenUri, {\n    method: \"POST\",\n    headers: { \"content-type\": \"application/x-www-form-urlencoded\" },\n    body\n  });\n\n  if (!resp.ok) throw new Error(`FCM token exchange failed: ${resp.status} ${await resp.text()}`);\n\n  const json = (await resp.json()) as { access_token: string; expires_in: number };\n  cached = { token: json.access_token, expMs: Date.now() + json.expires_in * 1000 };\n  return json.access_token;\n}\n\nexport async function fcmSend(env: Env, message: any): Promise<Response> {\n  const accessToken = await getFcmAccessToken(env);\n  const url = `https://fcm.googleapis.com/v1/projects/${env.FCM_PROJECT_ID}/messages:send`;\n  return fetch(url, {\n    method: \"POST\",\n    headers: {\n      authorization: `Bearer ${accessToken}`,\n      \"content-type\": \"application/json\"\n    },\n    body: JSON.stringify({ message })\n  });\n}\r\n", "\uFEFFimport { fcmSend } from \"../lib/fcm\";\n\nexport type NotificationType = \"post_like\" | \"comment_like\" | \"post_comment\" | \"comment_reply\" | \"friend_request\";\n\ntype FcmEnv = {\n  FCM_SERVICE_ACCOUNT_JSON?: string;\n  FCM_PROJECT_ID?: string;\n};\n\ntype PushTokenRow = { fcm_token: string; platform: string };\n\ntype NotificationRow = {\n  id: string;\n  type: NotificationType;\n  recipient_owner_id: string;\n  actor_count: number;\n  latest_actor_owner_id: string | null;\n  latest_action_at: string | null;\n  post_id: string | null;\n  comment_id: string | null;\n  friendship_id: number | null;\n  created_at: string;\n};\n\ntype ActorRow = { actor_owner_id: string; display_name: string };\n\nconst nowIso = () => new Date().toISOString();\n\nexport async function registerPushToken(\n  db: D1Database,\n  ownerId: string,\n  platform: \"ios\" | \"android\",\n  fcmToken: string\n): Promise<void> {\n  const ts = nowIso();\n  await db\n    .prepare(\n      `\n      insert into push_tokens (owner_id, platform, fcm_token, is_active, last_seen_at, created_at, updated_at)\n      values (?, ?, ?, 1, ?, ?, ?)\n      on conflict(fcm_token) do update set\n        owner_id = excluded.owner_id,\n        platform = excluded.platform,\n        is_active = 1,\n        last_seen_at = excluded.last_seen_at,\n        updated_at = excluded.updated_at\n      `\n    )\n    .bind(ownerId, platform, fcmToken, ts, ts, ts)\n    .run();\n}\n\nexport async function unregisterPushToken(db: D1Database, fcmToken: string): Promise<void> {\n  const ts = nowIso();\n  await db\n    .prepare(\n      `\n      update push_tokens set is_active = 0, updated_at = ?\n      where fcm_token = ?\n      `\n    )\n    .bind(ts, fcmToken)\n    .run();\n}\n\nexport async function listActivePushTokens(db: D1Database, ownerId: string): Promise<PushTokenRow[]> {\n  const { results } = await db\n    .prepare(\n      `\n      select fcm_token, platform\n      from push_tokens\n      where owner_id = ? and is_active = 1\n      `\n    )\n    .bind(ownerId)\n    .all<PushTokenRow>();\n  return results ?? [];\n}\n\nexport async function notifyPostLike(args: {\n  env: FcmEnv;\n  db: D1Database;\n  recipientId: string;\n  actorId: string;\n  postId: string;\n}): Promise<void> {\n  await notifyAggregated({\n    ...args,\n    type: \"post_like\",\n    groupKey: `post_like:${args.recipientId}:${args.postId}`,\n    postId: args.postId\n  });\n}\n\nexport async function notifyCommentLike(args: {\n  env: FcmEnv;\n  db: D1Database;\n  recipientId: string;\n  actorId: string;\n  postId: string;\n  commentId: string;\n}): Promise<void> {\n  await notifyAggregated({\n    ...args,\n    type: \"comment_like\",\n    groupKey: `comment_like:${args.recipientId}:${args.commentId}`,\n    postId: args.postId,\n    commentId: args.commentId\n  });\n}\n\nexport async function notifyPostComment(args: {\n  env: FcmEnv;\n  db: D1Database;\n  recipientId: string;\n  actorId: string;\n  postId: string;\n}): Promise<void> {\n  await notifySingle({\n    ...args,\n    type: \"post_comment\",\n    postId: args.postId\n  });\n}\n\nexport async function notifyCommentReply(args: {\n  env: FcmEnv;\n  db: D1Database;\n  recipientId: string;\n  actorId: string;\n  postId: string;\n  commentId: string;\n}): Promise<void> {\n  await notifySingle({\n    ...args,\n    type: \"comment_reply\",\n    postId: args.postId,\n    commentId: args.commentId\n  });\n}\n\nexport async function notifyFriendRequest(args: {\n  env: FcmEnv;\n  db: D1Database;\n  recipientId: string;\n  actorId: string;\n  friendshipId: number;\n}): Promise<void> {\n  await notifySingle({\n    ...args,\n    type: \"friend_request\",\n    friendshipId: args.friendshipId\n  });\n}\n\ntype AggregatedArgs = {\n  env: FcmEnv;\n  db: D1Database;\n  type: NotificationType;\n  recipientId: string;\n  actorId: string;\n  groupKey: string;\n  postId?: string;\n  commentId?: string;\n};\n\ntype SingleArgs = {\n  env: FcmEnv;\n  db: D1Database;\n  type: NotificationType;\n  recipientId: string;\n  actorId: string;\n  postId?: string;\n  commentId?: string;\n  friendshipId?: number;\n};\n\nasync function notifyAggregated(args: AggregatedArgs): Promise<void> {\n  const { db } = args;\n  const ts = nowIso();\n  const id = crypto.randomUUID();\n\n  await db\n    .prepare(\n      `\n      insert into notifications (\n        id, type, recipient_owner_id, actor_count,\n        latest_actor_owner_id, latest_action_at,\n        post_id, comment_id, friendship_id,\n        group_key, is_read, read_at, is_hidden, hidden_at,\n        created_at, updated_at\n      )\n      values (?, ?, ?, 0, ?, ?, ?, ?, null, ?, 0, null, 0, null, ?, ?)\n      on conflict(group_key) do update set\n        latest_actor_owner_id = excluded.latest_actor_owner_id,\n        latest_action_at = excluded.latest_action_at,\n        is_read = 0,\n        read_at = null,\n        is_hidden = 0,\n        hidden_at = null,\n        updated_at = excluded.updated_at\n      `\n    )\n    .bind(\n      id,\n      args.type,\n      args.recipientId,\n      args.actorId,\n      ts,\n      args.postId ?? null,\n      args.commentId ?? null,\n      args.groupKey,\n      ts,\n      ts\n    )\n    .run();\n\n  const notifRow = await db\n    .prepare(`select id from notifications where group_key = ?`)\n    .bind(args.groupKey)\n    .first<{ id: string }>();\n\n  const notificationId = notifRow?.id ?? id;\n\n  await db\n    .prepare(\n      `\n      insert into notification_actors (notification_id, actor_owner_id, first_action_at, last_action_at)\n      values (?, ?, ?, ?)\n      on conflict(notification_id, actor_owner_id) do update set\n        last_action_at = excluded.last_action_at\n      `\n    )\n    .bind(notificationId, args.actorId, ts, ts)\n    .run();\n\n  await db\n    .prepare(\n      `\n      update notifications\n      set actor_count = (select count(*) from notification_actors where notification_id = ?)\n      where id = ?\n      `\n    )\n    .bind(notificationId, notificationId)\n    .run();\n\n  const row = await db\n    .prepare(\n      `\n      select id, type, recipient_owner_id, actor_count, latest_actor_owner_id, latest_action_at, post_id, comment_id, friendship_id, created_at\n      from notifications where id = ?\n      `\n    )\n    .bind(notificationId)\n    .first<NotificationRow>();\n\n  if (!row) return;\n  await pushNotification(args.env, db, row);\n}\n\nasync function notifySingle(args: SingleArgs): Promise<void> {\n  const { db } = args;\n  const ts = nowIso();\n  const id = crypto.randomUUID();\n\n  await db\n    .prepare(\n      `\n      insert into notifications (\n        id, type, recipient_owner_id, actor_count,\n        latest_actor_owner_id, latest_action_at,\n        post_id, comment_id, friendship_id,\n        group_key, is_read, read_at, is_hidden, hidden_at,\n        created_at, updated_at\n      )\n      values (?, ?, ?, 1, ?, ?, ?, ?, ?, null, 0, null, 0, null, ?, ?)\n      `\n    )\n    .bind(\n      id,\n      args.type,\n      args.recipientId,\n      args.actorId,\n      ts,\n      args.postId ?? null,\n      args.commentId ?? null,\n      args.friendshipId ?? null,\n      ts,\n      ts\n    )\n    .run();\n\n  await db\n    .prepare(\n      `\n      insert into notification_actors (notification_id, actor_owner_id, first_action_at, last_action_at)\n      values (?, ?, ?, ?)\n      `\n    )\n    .bind(id, args.actorId, ts, ts)\n    .run();\n\n  const row: NotificationRow = {\n    id,\n    type: args.type,\n    recipient_owner_id: args.recipientId,\n    actor_count: 1,\n    latest_actor_owner_id: args.actorId,\n    latest_action_at: ts,\n    post_id: args.postId ?? null,\n    comment_id: args.commentId ?? null,\n    friendship_id: args.friendshipId ?? null,\n    created_at: ts\n  };\n\n  await pushNotification(args.env, db, row);\n}\n\nasync function pushNotification(env: FcmEnv, db: D1Database, notif: NotificationRow): Promise<void> {\n  try {\n    const fcmEnv = requireFcmEnv(env);\n    const tokens = await listActivePushTokens(db, notif.recipient_owner_id);\n    if (tokens.length === 0) return;\n\n    const actors = await listTopActors(db, notif.id, 3);\n    const body = buildNotificationBody(notif.type, actors, notif.actor_count);\n\n    const data = {\n      notif_id: notif.id,\n      type: notif.type,\n      post_id: notif.post_id ?? \"\",\n      comment_id: notif.comment_id ?? \"\",\n      friendship_id: notif.friendship_id ? String(notif.friendship_id) : \"\"\n    };\n\n    for (const tokenRow of tokens) {\n      const message = {\n        token: tokenRow.fcm_token,\n        notification: {\n          title: \"Rubypets\",\n          body\n        },\n        data\n      };\n\n      let resp: Response | null = null;\n      let text = \"\";\n      try {\n        resp = await fcmSend(fcmEnv, message);\n        text = await resp.text();\n      } catch (err) {\n        console.error(\"FCM send failed\", err);\n        continue;\n      }\n\n      if (!resp.ok) {\n        const shouldDisable = resp.status === 404 || text.includes(\"UNREGISTERED\");\n        if (shouldDisable) {\n          await unregisterPushToken(db, tokenRow.fcm_token);\n        }\n        console.warn(\"FCM response not ok\", resp.status, text);\n      }\n    }\n  } catch (err) {\n    console.error(\"pushNotification failed\", err);\n  }\n}\n\nfunction requireFcmEnv(env: FcmEnv): { FCM_SERVICE_ACCOUNT_JSON: string; FCM_PROJECT_ID: string } {\n  if (!env.FCM_SERVICE_ACCOUNT_JSON || !env.FCM_PROJECT_ID) {\n    throw new Error(\"FCM not configured\");\n  }\n  return {\n    FCM_SERVICE_ACCOUNT_JSON: env.FCM_SERVICE_ACCOUNT_JSON,\n    FCM_PROJECT_ID: env.FCM_PROJECT_ID\n  };\n}\n\nasync function listTopActors(db: D1Database, notificationId: string, limit: number): Promise<string[]> {\n  const { results } = await db\n    .prepare(\n      `\n      select na.actor_owner_id, o.display_name\n      from notification_actors na\n      join owners o on o.uuid = na.actor_owner_id\n      where na.notification_id = ?\n      order by na.last_action_at desc\n      limit ?\n      `\n    )\n    .bind(notificationId, limit)\n    .all<ActorRow>();\n\n  return (results ?? []).map((row) => row.display_name || row.actor_owner_id);\n}\n\nfunction buildNotificationBody(type: NotificationType, actors: string[], actorCount: number): string {\n  const nameA = actors[0] || \"Someone\";\n  const nameB = actors[1] || \"Someone\";\n\n  switch (type) {\n    case \"post_like\":\n      return buildAggregatedBody(nameA, nameB, actorCount, \"liked your post\");\n    case \"comment_like\":\n      return buildAggregatedBody(nameA, nameB, actorCount, \"liked your comment\");\n    case \"post_comment\":\n      return `${nameA} commented on your post`;\n    case \"comment_reply\":\n      return `${nameA} replied to your comment`;\n    case \"friend_request\":\n      return `${nameA} sent you a friend request`;\n    default:\n      return \"You have a new notification\";\n  }\n}\n\nfunction buildAggregatedBody(nameA: string, nameB: string, count: number, action: string): string {\n  if (count <= 1) return `${nameA} ${action}`;\n  if (count === 2) return `${nameA} and ${nameB} ${action}`;\n  const others = Math.max(0, count - 2);\n  return `${nameA}, ${nameB}, and ${others} others ${action}`;\n}\r\n", "import { HandlerContext } from \"../../types\";\nimport { getUserFromAuthHeader } from \"../../services/auth\";\n\nexport async function requireAuthOwner(ctx: HandlerContext) {\n  const me = await getUserFromAuthHeader(ctx.db, ctx.request);\n  if (!me) throw Object.assign(new Error(\"Unauthorized\"), { status: 401 });\n  return me;\n}\n", "import { HandlerContext } from \"../../types\";\nimport { asNumber, errorJson, okJson } from \"../utils\";\nimport { getUserFromAuthHeader } from \"../../services/auth\";\nimport { createPost, getPostsByOwner, listRecentPosts } from \"../../services/posts\";\nimport {\n  notifyCommentLike,\n  notifyCommentReply,\n  notifyPostComment,\n  notifyPostLike\n} from \"../../services/notifications\";\nimport { DynamicRoute, Route } from \"./types\";\nimport { requireAuthOwner } from \"./shared\";\n\nasync function postsListRoute(ctx: HandlerContext): Promise<Response> {\n  const url = new URL(ctx.request.url);\n  const limit = asNumber(url.searchParams.get(\"limit\"), 20);\n  const userId = url.searchParams.get(\"userId\");\n\n  const currentUser = await getUserFromAuthHeader(ctx.db, ctx.request).catch(() => null);\n  const posts = userId\n    ? await getPostsByOwner(ctx.db, userId, limit, currentUser?.uuid)\n    : await listRecentPosts(ctx.db, limit, currentUser?.uuid);\n\n  return okJson(posts, 200);\n}\n\nasync function createPostRoute(ctx: HandlerContext): Promise<Response> {\n  const payload = (await ctx.request.json()) as {\n    content?: string;\n    mediaKey?: string | null; // deprecated\n    post_type?: string;\n    visibility?: string;\n  };\n\n  const content = (payload.content ?? \"\").trim();\n  if (!content) {\n    return errorJson(\"content is required\", 400);\n  }\n\n  const postType = (payload.post_type ?? \"text\").trim();\n  if (![\"text\", \"image_set\", \"video\"].includes(postType)) {\n    return errorJson(\"invalid post_type\", 400);\n  }\n\n  const visibility = (payload.visibility ?? \"public\").trim();\n  if (![\"public\", \"friends\", \"private\"].includes(visibility)) {\n    return errorJson(\"invalid visibility\", 400);\n  }\n\n  const user = await requireAuthOwner(ctx);\n  const authorId = user.uuid;\n\n  const post = await createPost(ctx.db, {\n    authorId,\n    content,\n    visibility,\n    postType\n  });\n\n  return okJson(post, 201);\n}\n\nasync function repostRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const user = await requireAuthOwner(ctx);\n\n  const origin = await ctx.db.getPostById(params.id);\n  if (!origin) return errorJson(\"post not found\", 404);\n  if (origin.isDeleted === 1) return errorJson(\"origin post deleted\", 409);\n  if ((origin.visibility ?? \"public\") !== \"public\") return errorJson(\"forbidden\", 403);\n\n  const payload = (await ctx.request.json().catch(() => ({}))) as { content?: string | null; visibility?: string };\n  const visibility = (payload.visibility ?? \"public\").trim();\n  if (![\"public\", \"friends\", \"private\"].includes(visibility)) {\n    return errorJson(\"invalid visibility\", 400);\n  }\n\n  const rawContent = typeof payload.content === \"string\" ? payload.content : \"\";\n  const trimmed = rawContent.trim();\n  const content = trimmed ? trimmed : null;\n\n  const repost = await ctx.db.createPost({\n    authorId: user.uuid,\n    body: content,\n    visibility,\n    postType: \"text\",\n    mediaCount: 0,\n    originPostId: origin.id\n  });\n\n  const repostCount = await ctx.db.updateRepostCount(origin.id);\n  const repostWithAuthor = (await ctx.db.getPostById(repost.id)) ?? repost;\n\n  return okJson(\n    {\n      post: { ...repostWithAuthor, originPost: origin },\n      origin: { id: origin.id, repost_count: repostCount }\n    },\n    201\n  );\n}\n\nasync function attachMediaRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  try {\n    const postId = params.id;\n    const user = await requireAuthOwner(ctx);\n\n    const body = (await ctx.request.json().catch(() => ({}))) as {\n      post_type?: \"image_set\" | \"video\";\n      asset_ids?: string[];\n      pet_tags?: string[];\n    };\n    const postType = body.post_type;\n    const assetIds = body.asset_ids ?? [];\n\n    if (!postType || ![\"image_set\", \"video\"].includes(postType)) return errorJson(\"invalid post_type\", 400);\n    if (assetIds.length === 0) return errorJson(\"asset_ids required\", 400);\n\n    const post = await ctx.db.getPostById(postId);\n    if (!post) return errorJson(\"post not found\", 404);\n    if (post.authorId !== user.uuid) return errorJson(\"forbidden\", 403);\n\n    const assets = await ctx.db.getMediaAssetsByIds(assetIds);\n    if (assets.length !== assetIds.length) return errorJson(\"asset not found\", 404);\n    for (const a of assets) {\n      if (a.ownerId !== user.uuid) return errorJson(\"forbidden asset\", 403);\n      if (a.usage !== \"post\") return errorJson(\"asset usage must be post\", 400);\n      if (postType === \"image_set\" && a.kind !== \"image\") return errorJson(\"only images allowed\", 400);\n      if (postType === \"video\" && a.kind !== \"video\") return errorJson(\"only video allowed\", 400);\n    }\n    if (postType === \"image_set\" && (assetIds.length < 1 || assetIds.length > 5)) {\n      return errorJson(\"image_set must have 1-5 images\", 400);\n    }\n    if (postType === \"video\" && assetIds.length !== 1) {\n      return errorJson(\"video must have exactly 1 asset\", 400);\n    }\n\n    await ctx.db.attachMediaToPost(postId, postType, assetIds);\n\n    return okJson(null, 200);\n  } catch (err) {\n    console.error(\"attachMedia error\", err);\n    return errorJson((err as Error).message, 500);\n  }\n}\n\nasync function likeRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const user = await requireAuthOwner(ctx);\n  const postId = params.id;\n  const post = await ctx.db.getPostById(postId);\n  if (!post) return errorJson(\"post not found\", 404);\n\n  const result = await ctx.db.toggleLike(postId, user.uuid);\n  if (result.isLiked && post.authorId !== user.uuid) {\n    ctx.ctx.waitUntil(\n      notifyPostLike({\n        env: ctx.env,\n        db: ctx.env.DB,\n        recipientId: post.authorId,\n        actorId: user.uuid,\n        postId\n      })\n    );\n  }\n  return okJson({ isLiked: result.isLiked, like_count: result.likeCount }, 200);\n}\n\nasync function unlikeRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const user = await requireAuthOwner(ctx);\n  const postId = params.id;\n  const post = await ctx.db.getPostById(postId);\n  if (!post) return errorJson(\"post not found\", 404);\n\n  await ctx.db.unlikePost(postId, user.uuid);\n  const updated = await ctx.db.getPostById(postId);\n  return okJson({ like_count: updated?.likeCount ?? 0 }, 200);\n}\n\nasync function ensureCommentAccess(\n  ctx: HandlerContext,\n  postId: string,\n  user: { uuid: string }\n): Promise<Response | { post: import(\"../../db/models\").Post }> {\n  const post = await ctx.db.getPostById(postId);\n  if (!post || post.isDeleted === 1) return errorJson(\"post not found\", 404);\n\n  const visibility = post.visibility ?? \"public\";\n  if (visibility === \"private\" && post.authorId !== user.uuid) {\n    return errorJson(\"forbidden\", 403);\n  }\n  if (visibility === \"friends\" && post.authorId !== user.uuid) {\n    const ok = await ctx.db.isFriends(post.authorId, user.uuid);\n    if (!ok) return errorJson(\"forbidden\", 403);\n  }\n\n  return { post };\n}\n\nasync function listLatestCommentRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const user = await requireAuthOwner(ctx);\n  const access = await ensureCommentAccess(ctx, params.id, user);\n  if (access instanceof Response) return access;\n  const latest = await ctx.db.getLatestComment(params.id, user.uuid);\n  return okJson({ comment: latest, comment_count: access.post.commentCount ?? 0 }, 200);\n}\n\nasync function createCommentRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const user = await requireAuthOwner(ctx);\n  const postId = params.id;\n  const body = (await ctx.request.json().catch(() => ({}))) as {\n    content?: string;\n    parent_comment_id?: string | null;\n    reply_to_comment_id?: string | null;\n  };\n  const content = (body.content ?? \"\").trim();\n  if (!content) return errorJson(\"content required\", 400);\n\n  const access = await ensureCommentAccess(ctx, postId, user);\n  if (access instanceof Response) return access;\n\n  const replyToId = (body.reply_to_comment_id ?? \"\").trim() || null;\n  const parentId = (body.parent_comment_id ?? \"\").trim() || null;\n\n  let finalParentId: string | null = null;\n  let finalContent = content;\n  let replyTargetOwnerId: string | null = null;\n  let replyTargetCommentId: string | null = null;\n\n  if (replyToId) {\n    const target = await ctx.db.getCommentById(replyToId);\n    if (!target) return errorJson(\"comment not found\", 404);\n    if (target.postId !== postId) return errorJson(\"comment not in post\", 400);\n    finalParentId = target.parentCommentId ?? target.id;\n    replyTargetOwnerId = target.ownerId;\n    replyTargetCommentId = target.id;\n  } else if (parentId) {\n    const parent = await ctx.db.getCommentById(parentId);\n    if (!parent) return errorJson(\"comment not found\", 404);\n    if (parent.postId !== postId) return errorJson(\"comment not in post\", 400);\n    if (parent.parentCommentId) return errorJson(\"invalid parent_comment_id\", 400);\n    finalParentId = parent.id;\n    replyTargetOwnerId = parent.ownerId;\n    replyTargetCommentId = parent.id;\n  }\n\n  const created = await ctx.db.createComment({\n    postId,\n    ownerId: user.uuid,\n    content: finalContent,\n    parentCommentId: finalParentId\n  });\n\n  // Verify the comment was written by fetching it back by id.\n  const check = await ctx.db.getCommentById(created.id);\n  if (!check) {\n    console.error(\"COMMENT_WRITE_VERIFY_FAILED\", { createdId: created.id, postId });\n    return errorJson(\"comment write verify failed\", 500);\n  }\n\n  const updated = await ctx.db.getPostById(postId);\n\n  const actorId = user.uuid;\n  const postAuthorId = access.post.authorId;\n  const replyRecipientId = replyTargetOwnerId && replyTargetOwnerId !== actorId ? replyTargetOwnerId : null;\n  const replyCommentId = replyTargetCommentId ?? \"\";\n\n  if (replyRecipientId && replyCommentId) {\n    if (replyRecipientId === postAuthorId) {\n      ctx.ctx.waitUntil(\n        notifyCommentReply({\n          env: ctx.env,\n          db: ctx.env.DB,\n          recipientId: replyRecipientId,\n          actorId,\n          postId,\n          commentId: replyCommentId\n        })\n      );\n    } else {\n      if (postAuthorId !== actorId) {\n        ctx.ctx.waitUntil(\n          notifyPostComment({\n            env: ctx.env,\n            db: ctx.env.DB,\n            recipientId: postAuthorId,\n            actorId,\n            postId\n          })\n        );\n      }\n      ctx.ctx.waitUntil(\n        notifyCommentReply({\n          env: ctx.env,\n          db: ctx.env.DB,\n          recipientId: replyRecipientId,\n          actorId,\n          postId,\n          commentId: replyCommentId\n        })\n      );\n    }\n  } else if (postAuthorId !== actorId) {\n    ctx.ctx.waitUntil(\n      notifyPostComment({\n        env: ctx.env,\n        db: ctx.env.DB,\n        recipientId: postAuthorId,\n        actorId,\n        postId\n      })\n    );\n  }\n\n  return okJson({ comment: created, comment_count: updated?.commentCount ?? (access.post.commentCount ?? 0) + 1 }, 201);\n}\n\nasync function listCommentsRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const user = await requireAuthOwner(ctx);\n  const access = await ensureCommentAccess(ctx, params.id, user);\n  if (access instanceof Response) return access;\n\n  const url = new URL(ctx.request.url);\n  const limit = asNumber(url.searchParams.get(\"limit\"), 20);\n  const cursor = url.searchParams.get(\"cursor\");\n\n  const page = await ctx.db.listPostCommentsThread(params.id, limit, cursor, user.uuid);\n  return okJson({ items: page.items, nextCursor: page.nextCursor, hasMore: page.hasMore }, 200);\n}\n\nasync function toggleCommentLikeRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const user = await requireAuthOwner(ctx);\n  const comment = await ctx.db.getCommentById(params.id);\n  if (!comment) return errorJson(\"comment not found\", 404);\n  const access = await ensureCommentAccess(ctx, comment.postId, user);\n  if (access instanceof Response) return access;\n\n  const result = await ctx.db.toggleCommentLike(comment.id, user.uuid);\n  if (result.isLiked && comment.ownerId !== user.uuid) {\n    ctx.ctx.waitUntil(\n      notifyCommentLike({\n        env: ctx.env,\n        db: ctx.env.DB,\n        recipientId: comment.ownerId,\n        actorId: user.uuid,\n        postId: comment.postId,\n        commentId: comment.id\n      })\n    );\n  }\n  return okJson({ isLiked: result.isLiked, like_count: result.likeCount }, 200);\n}\n\nexport const routes: Route[] = [\n  { method: \"GET\", path: \"/posts\", handler: postsListRoute },\n  { method: \"POST\", path: \"/posts\", handler: createPostRoute }\n];\n\nexport const dynamicRoutes: DynamicRoute[] = [\n  { method: \"POST\", pattern: /^\\/posts\\/([^/]+)\\/media\\/attach$/, handler: attachMediaRoute },\n  { method: \"POST\", pattern: /^\\/posts\\/([^/]+)\\/like$/, handler: likeRoute },\n  { method: \"DELETE\", pattern: /^\\/posts\\/([^/]+)\\/like$/, handler: unlikeRoute },\n  { method: \"POST\", pattern: /^\\/posts\\/([^/]+)\\/repost$/, handler: repostRoute },\n  { method: \"GET\", pattern: /^\\/posts\\/([^/]+)\\/comments\\/list$/, handler: listCommentsRoute },\n  { method: \"GET\", pattern: /^\\/posts\\/([^/]+)\\/comments$/, handler: listLatestCommentRoute },\n  { method: \"POST\", pattern: /^\\/posts\\/([^/]+)\\/comments$/, handler: createCommentRoute },\n  { method: \"POST\", pattern: /^\\/comments\\/([^/]+)\\/like$/, handler: toggleCommentLikeRoute }\n];\n", "import { HandlerContext } from \"../../types\";\nimport { errorJson, okJson } from \"../utils\";\nimport { getUserFromAuthHeader } from \"../../services/auth\";\nimport { DynamicRoute, Route } from \"./types\";\n\nasync function mediaImagesInitRoute(ctx: HandlerContext): Promise<Response> {\n  try {\n    const user = await getUserFromAuthHeader(ctx.db, ctx.request);\n    if (!user) return errorJson(\"Unauthorized\", 401);\n\n    const body = (await ctx.request.json().catch(() => ({}))) as any;\n    const usage = (body.usage ?? \"\").trim();\n    const file = body.file ?? {};\n\n    if (![\"avatar\", \"pet_avatar\", \"post\", \"kyc\", \"other\"].includes(usage)) {\n      return errorJson(\"invalid usage\", 400);\n    }\n    if (!file.filename || !file.mime_type || typeof file.size_bytes !== \"number\") {\n      return errorJson(\"file.filename, file.mime_type, size_bytes are required\", 400);\n    }\n    const allowed = [\"image/jpeg\", \"image/png\", \"image/webp\"];\n    if (!allowed.includes(file.mime_type)) {\n      return errorJson(\"unsupported mime_type\", 422);\n    }\n\n    const cfAccountId = ctx.env.CF_ACCOUNT_ID;\n    const cfToken = ctx.env.CF_API_TOKEN;\n    const cfImagesHash = ctx.env.CF_IMAGES_ACCOUNT_HASH;\n    if (!cfAccountId || !cfToken || !cfImagesHash) return errorJson(\"cloudflare images not configured\", 500);\n\n    const cfResp = await fetch(`https://api.cloudflare.com/client/v4/accounts/${cfAccountId}/images/v2/direct_upload`, {\n      method: \"POST\",\n      headers: { Authorization: `Bearer ${cfToken}` }\n    });\n    const cfJson = (await cfResp.json().catch(() => ({}))) as any;\n    if (!cfResp.ok || !cfJson?.success) {\n      console.error(\"CF Images init failed\", cfJson);\n      return errorJson(\"cloudflare images init failed\", 502);\n    }\n    const cfImageId = cfJson.result?.id;\n    const uploadUrl = cfJson.result?.uploadURL;\n    if (!cfImageId || !uploadUrl) return errorJson(\"cloudflare images init missing uploadURL\", 502);\n\n    const asset = await ctx.db.createMediaAsset({\n      ownerId: user.uuid,\n      kind: \"image\",\n      usage: usage as any,\n      storageProvider: \"cf_media\",\n      storageKey: cfImageId,\n      url: `https://imagedelivery.net/${cfImagesHash}/${cfImageId}/${pickImageVariant(usage)}`,\n      mimeType: file.mime_type,\n      sizeBytes: file.size_bytes,\n      status: \"uploaded\"\n    });\n\n    return okJson({ asset_id: asset.id, upload_url: uploadUrl }, 201);\n  } catch (err) {\n    console.error(\"mediaImagesInit error\", err);\n    return errorJson((err as Error).message, 500);\n  }\n}\n\nasync function mediaVideosInitRoute(ctx: HandlerContext): Promise<Response> {\n  try {\n    const user = await getUserFromAuthHeader(ctx.db, ctx.request);\n    if (!user) return errorJson(\"Unauthorized\", 401);\n\n    const body = (await ctx.request.json().catch(() => ({}))) as any;\n    const usage = (body.usage ?? \"\").trim();\n    const file = body.file ?? {};\n\n    if (usage !== \"post\") return errorJson(\"video upload only supports usage=post for now\", 400);\n    if (!file.filename || !file.mime_type || typeof file.size_bytes !== \"number\") {\n      return errorJson(\"file.filename, file.mime_type, size_bytes are required\", 400);\n    }\n\n    const cfAccountId = ctx.env.CF_ACCOUNT_ID;\n    const cfToken = ctx.env.CF_API_TOKEN;\n    if (!cfAccountId || !cfToken) return errorJson(\"cloudflare stream not configured\", 500);\n    const cfStreamSubdomain = ctx.env.CF_STREAM_SUBDOMAIN; // e.g. abc123 or customer-abc123.cloudflarestream.com\n\n    const cfResp = await fetch(`https://api.cloudflare.com/client/v4/accounts/${cfAccountId}/stream/direct_upload`, {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${cfToken}`,\n        \"content-type\": \"application/json\"\n      },\n      body: JSON.stringify({ maxDurationSeconds: 60, creator: user.uuid })\n    });\n    const cfJson = (await cfResp.json().catch(() => ({}))) as any;\n    if (!cfResp.ok || !cfJson?.success) {\n      console.error(\"CF Stream init failed\", cfJson);\n      return errorJson(\"cloudflare stream init failed\", 502);\n    }\n    const uid = cfJson.result?.uid;\n    const uploadUrl = cfJson.result?.uploadURL;\n    if (!uid || !uploadUrl) return errorJson(\"cloudflare stream init missing uploadURL\", 502);\n\n    const streamUrl =\n      cfStreamSubdomain && uid\n        ? `https://customer-${normalizeStreamSubdomain(cfStreamSubdomain)}.cloudflarestream.com/${uid}/manifest/video.m3u8`\n        : null;\n\n    const asset = await ctx.db.createMediaAsset({\n      ownerId: user.uuid,\n      kind: \"video\",\n      usage: \"post\",\n      storageProvider: \"cf_media\",\n      storageKey: uid,\n      url: streamUrl,\n      mimeType: file.mime_type,\n      sizeBytes: file.size_bytes,\n      status: \"processing\"\n    });\n\n    return okJson({ asset_id: asset.id, upload_url: uploadUrl }, 201);\n  } catch (err) {\n    console.error(\"mediaVideosInit error\", err);\n    return errorJson((err as Error).message, 500);\n  }\n}\n\nasync function mediaUploadStubRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  // Accept upload (stub) and mark ready\n  const assetId = params.id;\n  try {\n    const form = await ctx.request.formData().catch(() => null);\n    if (!form) return okJson({ asset_id: assetId }, 200);\n    // In a real implementation, stream to Cloudflare. Here we just mark as ready.\n    return okJson({ asset_id: assetId }, 200);\n  } catch (err) {\n    console.error(\"mediaUploadStub error\", err);\n    return errorJson((err as Error).message, 500);\n  }\n}\n\nfunction pickImageVariant(usage: string): string {\n  switch (usage) {\n    case \"avatar\":\n      return \"OwnerAvatar256\";\n    case \"pet_avatar\":\n      return \"PetAvatar256\";\n    case \"post\":\n      return \"Post1080\";\n    case \"kyc\":\n      return \"KYCMax1600\";\n    default:\n      return \"public\";\n  }\n}\n\nfunction normalizeStreamSubdomain(value: string): string {\n  let sub = value.trim();\n  sub = sub.replace(/^https?:\\/\\//, \"\");\n  sub = sub.replace(/\\.cloudflarestream\\.com.*$/i, \"\");\n  sub = sub.replace(/^customer-/, \"\");\n  return sub;\n}\n\nexport const routes: Route[] = [\n  { method: \"POST\", path: \"/media/images/init\", handler: mediaImagesInitRoute },\n  { method: \"POST\", path: \"/media/videos/init\", handler: mediaVideosInitRoute }\n];\n\nexport const dynamicRoutes: DynamicRoute[] = [\n  { method: \"POST\", pattern: /^\\/media\\/upload\\/([^/]+)$/, handler: mediaUploadStubRoute }\n];\n", "import { HandlerContext } from \"../../types\";\nimport { asNumber, errorJson, okJson } from \"../utils\";\nimport { hashPassword, verifyPassword } from \"../../services/auth\";\nimport { DynamicRoute, Route } from \"./types\";\n\nfunction getClientIps(request: Request): string[] {\n  const ips: string[] = [];\n  const pushIp = (value: string | null | undefined) => {\n    if (!value) return;\n    const normalized = normalizeIp(value);\n    if (normalized) ips.push(normalized);\n  };\n\n  pushIp(request.headers.get(\"CF-Connecting-IP\"));\n  pushIp(request.headers.get(\"True-Client-IP\"));\n\n  const forwarded = request.headers.get(\"X-Forwarded-For\");\n  if (forwarded) {\n    forwarded\n      .split(\",\")\n      .map((entry) => entry.trim())\n      .forEach((entry) => pushIp(entry));\n  }\n\n  const forwardedHeader = request.headers.get(\"Forwarded\");\n  if (forwardedHeader) {\n    forwardedHeader\n      .split(\",\")\n      .map((entry) => entry.trim())\n      .forEach((entry) => {\n        const match = entry.match(/for=([^;]+)/i);\n        if (match?.[1]) {\n          pushIp(match[1].replace(/^\"|\"$/g, \"\"));\n        }\n      });\n  }\n\n  pushIp(request.headers.get(\"X-Real-IP\"));\n  return Array.from(new Set(ips));\n}\n\nfunction getPrimaryClientIp(request: Request): string | null {\n  const ips = getClientIps(request);\n  return ips.length > 0 ? ips[0] : null;\n}\n\nfunction normalizeIp(value: string): string {\n  const trimmed = value.trim().replace(/^\"|\"$/g, \"\");\n  if (!trimmed) return \"\";\n  if (trimmed.startsWith(\"::ffff:\")) {\n    return trimmed.slice(\"::ffff:\".length);\n  }\n  if (trimmed.startsWith(\"[\") && trimmed.includes(\"]\")) {\n    return trimmed.slice(1, trimmed.indexOf(\"]\"));\n  }\n  const ipv4Match = trimmed.match(/^(\\d{1,3}(?:\\.\\d{1,3}){3})(?::\\d+)?$/);\n  if (ipv4Match) return ipv4Match[1];\n  return trimmed;\n}\n\nfunction splitAllowlist(value: string): string[] {\n  return value\n    .split(/[,\\s\uFF0C;]+/)\n    .map((entry) => normalizeIp(entry))\n    .filter(Boolean);\n}\n\nfunction normalizeAllowlist(value: string): string | null {\n  const entries = splitAllowlist(value);\n  if (entries.length === 0) return null;\n  return entries.join(\",\");\n}\n\nfunction parseAdminIdFromToken(request: Request): string | null {\n  const auth = request.headers.get(\"authorization\") ?? \"\";\n  if (!auth.toLowerCase().startsWith(\"bearer \")) return null;\n  const token = auth.slice(7).trim();\n  if (!token.startsWith(\"admin:\")) return null;\n  const adminId = token.slice(\"admin:\".length).trim();\n  return adminId ? adminId : null;\n}\n\nasync function requireAdmin(ctx: HandlerContext): Promise<{ adminId: string } | Response> {\n  const adminId = parseAdminIdFromToken(ctx.request);\n  if (!adminId) return errorJson(\"Unauthorized\", 401);\n  const admin = await ctx.db.getAdminByAdminId(adminId);\n  if (!admin) return errorJson(\"Unauthorized\", 401);\n  const allowlist = splitAllowlist(admin.ipAllowlist ?? \"\");\n  if (allowlist.length === 0) return { adminId };\n  const ips = getClientIps(ctx.request);\n  if (ips.length === 0 || !ips.some((ip) => allowlist.includes(ip))) return errorJson(\"Forbidden\", 403);\n  return { adminId };\n}\n\nasync function reviewSummaryRoute(ctx: HandlerContext): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const counts = await ctx.db.countVerificationStatuses();\n  return okJson({ ...counts, ts: new Date().toISOString() });\n}\n\nasync function reviewKycPendingRoute(ctx: HandlerContext): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const data = await ctx.db.listVerifications();\n  return okJson(data, 200);\n}\n\nasync function kycDetailRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const account = await ctx.db.getAccountById(params.id);\n  if (!account) return errorJson(\"Not found\", 404);\n\n  const bucket = ctx.env.R2_MEDIA?.bucket?.name ?? \"rubypets-media-dev\";\n  const toUrl = (value: string | null | undefined) => {\n    if (!value) return null;\n    if (value.startsWith(\"http://\") || value.startsWith(\"https://\")) return value;\n    const base = ctx.env.R2_PUBLIC_BASE_URL?.replace(/\\/$/, \"\");\n    let key = value.replace(/^\\/+/, \"\");\n    if (base) {\n      // If key already carries the bucket prefix and base is a custom domain, drop the duplicate.\n      if (key.startsWith(`${bucket}/`)) {\n        key = key.slice(bucket.length + 1);\n      }\n      return `${base}/${key}`;\n    }\n    return `${bucket}/${key}`;\n  };\n\n  return okJson(\n    {\n      accountId: account.accountId,\n      realName: account.realName ?? null,\n      idNumber: account.idNumber ?? null,\n      phoneNumber: account.phoneNumber ?? null,\n      isVerified: account.isVerified,\n      idLicenseFrontUrl: toUrl(account.idLicenseFrontUrl),\n      idLicenseBackUrl: toUrl(account.idLicenseBackUrl),\n      faceWithLicenseUrl: toUrl(account.faceWithLicenseUrl),\n      createdAt: account.createdAt ?? null\n    },\n    200\n  );\n}\n\nasync function kycDecisionRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const accountId = params.id;\n  const body = (await ctx.request.json().catch(() => ({}))) as { status?: number };\n  if (body.status !== 1 && body.status !== 3) return errorJson(\"invalid status\", 400);\n  await ctx.db.updateAccountVerificationStatus(accountId, body.status);\n  return okJson({ accountId, status: body.status }, 200);\n}\n\nasync function adminAccountsListRoute(ctx: HandlerContext): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const admins = await ctx.db.listAdminAccounts();\n  return okJson(admins, 200);\n}\n\nasync function adminAccountsCreateRoute(ctx: HandlerContext): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const payload = (await ctx.request.json().catch(() => ({}))) as {\n    adminId?: string;\n    password?: string;\n    permission?: string;\n  };\n  const adminId = (payload.adminId ?? \"\").trim();\n  const password = payload.password ?? \"\";\n  const permission = (payload.permission ?? \"\").trim() || \"Inspector\";\n  if (!adminId || !password) return errorJson(\"adminId and password are required\", 400);\n  if (![\"super\", \"administrator\", \"Inspector\"].includes(permission)) return errorJson(\"invalid permission\", 400);\n  const hashed = await hashPassword(password);\n  const created = await ctx.db.createAdminAccount({ adminId, password: hashed, permission });\n  const currentIp = getPrimaryClientIp(ctx.request);\n  if (currentIp) {\n    await ctx.db.updateAdminIpAllowlist(adminId, currentIp);\n  }\n  return okJson(created, 201);\n}\n\nasync function adminLoginRoute(ctx: HandlerContext): Promise<Response> {\n  const payload = (await ctx.request.json().catch(() => ({}))) as { adminId?: string; password?: string };\n  const adminId = (payload.adminId ?? \"\").trim();\n  const password = payload.password ?? \"\";\n  if (!adminId || !password) return errorJson(\"adminId and password are required\", 400);\n  const admin = await ctx.db.getAdminByAdminId(adminId);\n  if (!admin) return errorJson(\"invalid credentials\", 401);\n  const ok = await verifyPassword(password, admin.passwordHash);\n  if (!ok) return errorJson(\"invalid credentials\", 401);\n  const allowlist = splitAllowlist(admin.ipAllowlist ?? \"\");\n  if (allowlist.length > 0) {\n    const ips = getClientIps(ctx.request);\n    if (ips.length === 0 || !ips.some((ip) => allowlist.includes(ip))) return errorJson(\"Forbidden\", 403);\n  }\n  const token = `admin:${admin.adminId}`;\n  await ctx.db.updateAdminLastAt(admin.adminId, new Date().toISOString());\n  return okJson({ token, admin: { id: admin.id, adminId: admin.adminId, permission: admin.permission } }, 200);\n}\n\nasync function adminAccountRollRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const id = params.id;\n  const payload = (await ctx.request.json().catch(() => ({}))) as { password?: string };\n  const newPassword = payload.password ?? \"\";\n  if (!newPassword) return errorJson(\"password required\", 400);\n  const hashed = await hashPassword(newPassword);\n  await ctx.db.updateAdminPassword(id, hashed);\n  return okJson({ accountId: id }, 200);\n}\n\nasync function adminPostsListRoute(ctx: HandlerContext): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const url = new URL(ctx.request.url);\n  const limit = asNumber(url.searchParams.get(\"limit\"), 20);\n  const page = Math.max(asNumber(url.searchParams.get(\"page\"), 1), 1);\n  const offset = (page - 1) * limit;\n  const posts = await ctx.db.listAdminPosts(limit, offset);\n  return okJson({ items: posts, page, hasMore: posts.length === limit }, 200);\n}\n\nasync function adminPostDetailRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const post = await ctx.db.getPostById(params.id);\n  if (!post) return errorJson(\"post not found\", 404);\n  return okJson(post, 200);\n}\n\nasync function adminPostModerateRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  try {\n    const postId = params.id;\n    const body = (await ctx.request.json().catch(() => ({}))) as { action?: string };\n    const action = (body.action ?? \"\").trim();\n    const post = await ctx.db.getPostById(postId);\n    if (!post) return errorJson(\"post not found\", 404);\n\n    const assets = await ctx.db.getPostAssets(postId);\n    const assetIds = assets.map((a) => a.assetId);\n\n    if (action === \"disable\") {\n      await ctx.db.markPostDeleted(postId);\n      return okJson(null, 200);\n    }\n\n    if (action === \"disable_delete_media\") {\n      await deleteCloudflareAssets(assets, ctx.env);\n      await ctx.db.deletePostMediaAndAssets(postId, assetIds);\n      await ctx.db.markPostDeleted(postId);\n      return okJson(null, 200);\n    }\n\n    if (action === \"delete_all\") {\n      await deleteCloudflareAssets(assets, ctx.env);\n      await ctx.db.deletePostCascade(postId, assetIds);\n      return okJson(null, 200);\n    }\n\n    return errorJson(\"invalid action\", 400);\n  } catch (err) {\n    console.error(\"adminPostModerate error\", err);\n    return errorJson((err as Error).message, 500);\n  }\n}\n\nasync function adminIpInfoRoute(ctx: HandlerContext): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  return okJson(\n    {\n      primaryIp: getPrimaryClientIp(ctx.request),\n      ips: getClientIps(ctx.request)\n    },\n    200\n  );\n}\n\nasync function adminAccountIpAllowlistRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const auth = await requireAdmin(ctx);\n  if (auth instanceof Response) return auth;\n  const payload = (await ctx.request.json().catch(() => ({}))) as { ipAllowlist?: string | null };\n  const normalized = normalizeAllowlist(payload.ipAllowlist ?? \"\");\n  const updated = await ctx.db.updateAdminIpAllowlist(params.id, normalized);\n  if (!updated) return errorJson(\"Not found\", 404);\n  return okJson({ adminId: params.id, ipAllowlist: normalized }, 200);\n}\n\nasync function deleteCloudflareAssets(\n  assets: { assetId: string; kind: string; storageKey: string }[],\n  env: HandlerContext[\"env\"]\n): Promise<void> {\n  const cfAccountId = env.CF_ACCOUNT_ID;\n  const cfToken = env.CF_API_TOKEN;\n  if (!cfAccountId || !cfToken) {\n    console.warn(\"Cloudflare credentials missing, skip remote delete\");\n    return;\n  }\n  for (const asset of assets) {\n    try {\n      if (asset.kind === \"image\") {\n        await fetch(`https://api.cloudflare.com/client/v4/accounts/${cfAccountId}/images/v1/${asset.storageKey}`, {\n          method: \"DELETE\",\n          headers: { Authorization: `Bearer ${cfToken}` }\n        });\n      } else if (asset.kind === \"video\") {\n        await fetch(`https://api.cloudflare.com/client/v4/accounts/${cfAccountId}/stream/${asset.storageKey}`, {\n          method: \"DELETE\",\n          headers: { Authorization: `Bearer ${cfToken}` }\n        });\n      }\n    } catch (err) {\n      console.error(\"deleteCloudflareAsset failed\", asset, err);\n    }\n  }\n}\n\nexport const routes: Route[] = [\n  { method: \"GET\", path: \"/admin/ip-info\", handler: adminIpInfoRoute },\n  { method: \"GET\", path: \"/admin/review/summary\", handler: reviewSummaryRoute },\n  { method: \"GET\", path: \"/admin/review/kyc-pending\", handler: reviewKycPendingRoute },\n  { method: \"GET\", path: \"/admin/admin-accounts\", handler: adminAccountsListRoute },\n  { method: \"POST\", path: \"/admin/admin-accounts\", handler: adminAccountsCreateRoute },\n  { method: \"POST\", path: \"/admin/auth/login\", handler: adminLoginRoute },\n  { method: \"GET\", path: \"/admin/posts\", handler: adminPostsListRoute }\n];\n\nexport const dynamicRoutes: DynamicRoute[] = [\n  { method: \"GET\", pattern: /^\\/admin\\/review\\/kyc\\/([^/]+)$/, handler: kycDetailRoute },\n  { method: \"POST\", pattern: /^\\/admin\\/review\\/kyc\\/([^/]+)\\/decision$/, handler: kycDecisionRoute },\n  { method: \"POST\", pattern: /^\\/admin\\/admin-accounts\\/([^/]+)\\/roll$/, handler: adminAccountRollRoute },\n  { method: \"POST\", pattern: /^\\/admin\\/admin-accounts\\/([^/]+)\\/ip-allowlist$/, handler: adminAccountIpAllowlistRoute },\n  { method: \"GET\", pattern: /^\\/admin\\/posts\\/([^/]+)$/, handler: adminPostDetailRoute },\n  { method: \"POST\", pattern: /^\\/admin\\/posts\\/([^/]+)\\/moderate$/, handler: adminPostModerateRoute }\n];\n", "{\r\n  \"classes\": [\r\n    {\r\n      \"key\": \"mammals\",\r\n      \"label\": \"mammals\",\r\n      \"species\": [\r\n        {\r\n          \"key\": \"dogs\",\r\n          \"label\": \"dogs\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Taiwan Dog\",\r\n              \"label\": \"Taiwan Dog\"\r\n            },\r\n            {\r\n              \"key\": \"Chihuahua\",\r\n              \"label\": \"Chihuahua\"\r\n            },\r\n            {\r\n              \"key\": \"Pomeranian\",\r\n              \"label\": \"Pomeranian\"\r\n            },\r\n            {\r\n              \"key\": \"Yorkshire Terrier\",\r\n              \"label\": \"Yorkshire Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"Maltese\",\r\n              \"label\": \"Maltese\"\r\n            },\r\n            {\r\n              \"key\": \"Shih Tzu\",\r\n              \"label\": \"Shih Tzu\"\r\n            },\r\n            {\r\n              \"key\": \"Poodle\",\r\n              \"label\": \"Poodle\"\r\n            },\r\n            {\r\n              \"key\": \"Pug\",\r\n              \"label\": \"Pug\"\r\n            },\r\n            {\r\n              \"key\": \"Bichon Frise\",\r\n              \"label\": \"Bichon Frise\"\r\n            },\r\n            {\r\n              \"key\": \"Dachshund\",\r\n              \"label\": \"Dachshund\"\r\n            },\r\n            {\r\n              \"key\": \"Pembroke Welsh Corgi\",\r\n              \"label\": \"Pembroke Welsh Corgi\"\r\n            },\r\n            {\r\n              \"key\": \"Schnauzer\",\r\n              \"label\": \"Schnauzer\"\r\n            },\r\n            {\r\n              \"key\": \"Labrador Retriever\",\r\n              \"label\": \"Labrador Retriever\"\r\n            },\r\n            {\r\n              \"key\": \"Golden Retriever\",\r\n              \"label\": \"Golden Retriever\"\r\n            },\r\n            {\r\n              \"key\": \"Siberian Husky\",\r\n              \"label\": \"Siberian Husky\"\r\n            },\r\n            {\r\n              \"key\": \"Shiba Inu\",\r\n              \"label\": \"Shiba Inu\"\r\n            },\r\n            {\r\n              \"key\": \"Border Collie\",\r\n              \"label\": \"Border Collie\"\r\n            },\r\n            {\r\n              \"key\": \"English Bulldog\",\r\n              \"label\": \"English Bulldog\"\r\n            },\r\n            {\r\n              \"key\": \"French Bulldog\",\r\n              \"label\": \"French Bulldog\"\r\n            },\r\n            {\r\n              \"key\": \"Boxer\",\r\n              \"label\": \"Boxer\"\r\n            },\r\n            {\r\n              \"key\": \"German Shepherd\",\r\n              \"label\": \"German Shepherd\"\r\n            },\r\n            {\r\n              \"key\": \"Rottweiler\",\r\n              \"label\": \"Rottweiler\"\r\n            },\r\n            {\r\n              \"key\": \"Doberman Pinscher\",\r\n              \"label\": \"Doberman Pinscher\"\r\n            },\r\n            {\r\n              \"key\": \"Australian Shepherd\",\r\n              \"label\": \"Australian Shepherd\"\r\n            },\r\n            {\r\n              \"key\": \"Dalmatian\",\r\n              \"label\": \"Dalmatian\"\r\n            },\r\n            {\r\n              \"key\": \"Old English Sheepdog\",\r\n              \"label\": \"Old English Sheepdog\"\r\n            },\r\n            {\r\n              \"key\": \"Shetland Sheepdog\",\r\n              \"label\": \"Shetland Sheepdog\"\r\n            },\r\n            {\r\n              \"key\": \"Alaskan Malamute\",\r\n              \"label\": \"Alaskan Malamute\"\r\n            },\r\n            {\r\n              \"key\": \"Akita\",\r\n              \"label\": \"Akita\"\r\n            },\r\n            {\r\n              \"key\": \"Vizsla\",\r\n              \"label\": \"Vizsla\"\r\n            },\r\n            {\r\n              \"key\": \"American Pit Bull Terrier\",\r\n              \"label\": \"American Pit Bull Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"American Bully\",\r\n              \"label\": \"American Bully\"\r\n            },\r\n            {\r\n              \"key\": \"Boston Terrier\",\r\n              \"label\": \"Boston Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"Beagle\",\r\n              \"label\": \"Beagle\"\r\n            },\r\n            {\r\n              \"key\": \"Whippet\",\r\n              \"label\": \"Whippet\"\r\n            },\r\n            {\r\n              \"key\": \"Greyhound\",\r\n              \"label\": \"Greyhound\"\r\n            },\r\n            {\r\n              \"key\": \"Irish Setter\",\r\n              \"label\": \"Irish Setter\"\r\n            },\r\n            {\r\n              \"key\": \"English Cocker Spaniel\",\r\n              \"label\": \"English Cocker Spaniel\"\r\n            },\r\n            {\r\n              \"key\": \"American Cocker Spaniel\",\r\n              \"label\": \"American Cocker Spaniel\"\r\n            },\r\n            {\r\n              \"key\": \"Basset Hound\",\r\n              \"label\": \"Basset Hound\"\r\n            },\r\n            {\r\n              \"key\": \"Great Dane\",\r\n              \"label\": \"Great Dane\"\r\n            },\r\n            {\r\n              \"key\": \"Bernese Mountain Dog\",\r\n              \"label\": \"Bernese Mountain Dog\"\r\n            },\r\n            {\r\n              \"key\": \"Saint Bernard\",\r\n              \"label\": \"Saint Bernard\"\r\n            },\r\n            {\r\n              \"key\": \"Newfoundland\",\r\n              \"label\": \"Newfoundland\"\r\n            },\r\n            {\r\n              \"key\": \"Lhasa Apso\",\r\n              \"label\": \"Lhasa Apso\"\r\n            },\r\n            {\r\n              \"key\": \"Bull Terrier\",\r\n              \"label\": \"Bull Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"Miniature Bull Terrier\",\r\n              \"label\": \"Miniature Bull Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"Chinese Crested\",\r\n              \"label\": \"Chinese Crested\"\r\n            },\r\n            {\r\n              \"key\": \"West Highland White Terrier\",\r\n              \"label\": \"West Highland White Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"Scottish Terrier\",\r\n              \"label\": \"Scottish Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"Jack Russell Terrier\",\r\n              \"label\": \"Jack Russell Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"Fox Terrier\",\r\n              \"label\": \"Fox Terrier\"\r\n            },\r\n            {\r\n              \"key\": \"Basenji\",\r\n              \"label\": \"Basenji\"\r\n            },\r\n            {\r\n              \"key\": \"Shar Pei\",\r\n              \"label\": \"Shar Pei\"\r\n            },\r\n            {\r\n              \"key\": \"Chow Chow\",\r\n              \"label\": \"Chow Chow\"\r\n            },\r\n            {\r\n              \"key\": \"Tibetan Mastiff\",\r\n              \"label\": \"Tibetan Mastiff\"\r\n            },\r\n            {\r\n              \"key\": \"Portuguese Water Dog\",\r\n              \"label\": \"Portuguese Water Dog\"\r\n            },\r\n            {\r\n              \"key\": \"Coton de Tulear\",\r\n              \"label\": \"Coton de Tulear\"\r\n            },\r\n            {\r\n              \"key\": \"Italian Greyhound\",\r\n              \"label\": \"Italian Greyhound\"\r\n            },\r\n            {\r\n              \"key\": \"Papillon\",\r\n              \"label\": \"Papillon\"\r\n            },\r\n            {\r\n              \"key\": \"Cavalier King Charles Spaniel\",\r\n              \"label\": \"Cavalier King Charles Spaniel\"\r\n            },\r\n            {\r\n              \"key\": \"American Eskimo Dog\",\r\n              \"label\": \"American Eskimo Dog\"\r\n            },\r\n            {\r\n              \"key\": \"Samoyed\",\r\n              \"label\": \"Samoyed\"\r\n            },\r\n            {\r\n              \"key\": \"Belgian Malinois\",\r\n              \"label\": \"Belgian Malinois\"\r\n            },\r\n            {\r\n              \"key\": \"Belgian Tervuren\",\r\n              \"label\": \"Belgian Tervuren\"\r\n            },\r\n            {\r\n              \"key\": \"Belgian Sheepdog\",\r\n              \"label\": \"Belgian Sheepdog\"\r\n            },\r\n            {\r\n              \"key\": \"Foxhound\",\r\n              \"label\": \"Foxhound\"\r\n            },\r\n            {\r\n              \"key\": \"American Foxhound\",\r\n              \"label\": \"American Foxhound\"\r\n            },\r\n            {\r\n              \"key\": \"Treeing Walker Coonhound\",\r\n              \"label\": \"Treeing Walker Coonhound\"\r\n            },\r\n            {\r\n              \"key\": \"Rough Collie\",\r\n              \"label\": \"Rough Collie\"\r\n            },\r\n            {\r\n              \"key\": \"Smooth Collie\",\r\n              \"label\": \"Smooth Collie\"\r\n            },\r\n            {\r\n              \"key\": \"English Setter\",\r\n              \"label\": \"English Setter\"\r\n            },\r\n            {\r\n              \"key\": \"Goldendoodle\",\r\n              \"label\": \"Goldendoodle\"\r\n            },\r\n            {\r\n              \"key\": \"Labradoodle\",\r\n              \"label\": \"Labradoodle\"\r\n            },\r\n            {\r\n              \"key\": \"Mixed\",\r\n              \"label\": \"Mixed\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"cats\",\r\n          \"label\": \"cats\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Mixed\",\r\n              \"label\": \"Mixed\"\r\n            },\r\n            {\r\n              \"key\": \"Persian\",\r\n              \"label\": \"Persian\"\r\n            },\r\n            {\r\n              \"key\": \"British Shorthair\",\r\n              \"label\": \"British Shorthair\"\r\n            },\r\n            {\r\n              \"key\": \"British Longhair\",\r\n              \"label\": \"British Longhair\"\r\n            },\r\n            {\r\n              \"key\": \"American Shorthair\",\r\n              \"label\": \"American Shorthair\"\r\n            },\r\n            {\r\n              \"key\": \"American Longhair\",\r\n              \"label\": \"American Longhair\"\r\n            },\r\n            {\r\n              \"key\": \"Tuxedo Cat\",\r\n              \"label\": \"Tuxedo Cat\"\r\n            },\r\n            {\r\n              \"key\": \"Orange Tabby\",\r\n              \"label\": \"Orange Tabby\"\r\n            },\r\n            {\r\n              \"key\": \"Tabby Cat\",\r\n              \"label\": \"Tabby Cat\"\r\n            },\r\n            {\r\n              \"key\": \"Calico\",\r\n              \"label\": \"Calico\"\r\n            },\r\n            {\r\n              \"key\": \"Tortoiseshell\",\r\n              \"label\": \"Tortoiseshell\"\r\n            },\r\n            {\r\n              \"key\": \"Ragdoll\",\r\n              \"label\": \"Ragdoll\"\r\n            },\r\n            {\r\n              \"key\": \"Maine Coon\",\r\n              \"label\": \"Maine Coon\"\r\n            },\r\n            {\r\n              \"key\": \"Norwegian Forest Cat\",\r\n              \"label\": \"Norwegian Forest Cat\"\r\n            },\r\n            {\r\n              \"key\": \"Birman\",\r\n              \"label\": \"Birman\"\r\n            },\r\n            {\r\n              \"key\": \"Exotic Shorthair\",\r\n              \"label\": \"Exotic Shorthair\"\r\n            },\r\n            {\r\n              \"key\": \"Scottish Fold\",\r\n              \"label\": \"Scottish Fold\"\r\n            },\r\n            {\r\n              \"key\": \"Scottish Straight\",\r\n              \"label\": \"Scottish Straight\"\r\n            },\r\n            {\r\n              \"key\": \"Russian Blue\",\r\n              \"label\": \"Russian Blue\"\r\n            },\r\n            {\r\n              \"key\": \"Egyptian Mau\",\r\n              \"label\": \"Egyptian Mau\"\r\n            },\r\n            {\r\n              \"key\": \"Sphynx\",\r\n              \"label\": \"Sphynx\"\r\n            },\r\n            {\r\n              \"key\": \"Bengal\",\r\n              \"label\": \"Bengal\"\r\n            },\r\n            {\r\n              \"key\": \"Abyssinian\",\r\n              \"label\": \"Abyssinian\"\r\n            },\r\n            {\r\n              \"key\": \"Somali\",\r\n              \"label\": \"Somali\"\r\n            },\r\n            {\r\n              \"key\": \"Turkish Van\",\r\n              \"label\": \"Turkish Van\"\r\n            },\r\n            {\r\n              \"key\": \"Turkish Angora\",\r\n              \"label\": \"Turkish Angora\"\r\n            },\r\n            {\r\n              \"key\": \"Chartreux\",\r\n              \"label\": \"Chartreux\"\r\n            },\r\n            {\r\n              \"key\": \"Himalayan\",\r\n              \"label\": \"Himalayan\"\r\n            },\r\n            {\r\n              \"key\": \"Munchkin\",\r\n              \"label\": \"Munchkin\"\r\n            },\r\n            {\r\n              \"key\": \"Peterbald\",\r\n              \"label\": \"Peterbald\"\r\n            },\r\n            {\r\n              \"key\": \"Devon Rex\",\r\n              \"label\": \"Devon Rex\"\r\n            },\r\n            {\r\n              \"key\": \"Cornish Rex\",\r\n              \"label\": \"Cornish Rex\"\r\n            },\r\n            {\r\n              \"key\": \"Oriental Shorthair\",\r\n              \"label\": \"Oriental Shorthair\"\r\n            },\r\n            {\r\n              \"key\": \"Oriental Longhair\",\r\n              \"label\": \"Oriental Longhair\"\r\n            },\r\n            {\r\n              \"key\": \"Burmese\",\r\n              \"label\": \"Burmese\"\r\n            },\r\n            {\r\n              \"key\": \"Singapura\",\r\n              \"label\": \"Singapura\"\r\n            },\r\n            {\r\n              \"key\": \"Arabian Mau\",\r\n              \"label\": \"Arabian Mau\"\r\n            },\r\n            {\r\n              \"key\": \"Selkirk Rex\",\r\n              \"label\": \"Selkirk Rex\"\r\n            },\r\n            {\r\n              \"key\": \"Japanese Bobtail\",\r\n              \"label\": \"Japanese Bobtail\"\r\n            },\r\n            {\r\n              \"key\": \"Kurilian Bobtail\",\r\n              \"label\": \"Kurilian Bobtail\"\r\n            },\r\n            {\r\n              \"key\": \"American Curl\",\r\n              \"label\": \"American Curl\"\r\n            },\r\n            {\r\n              \"key\": \"Highland Fold\",\r\n              \"label\": \"Highland Fold\"\r\n            },\r\n            {\r\n              \"key\": \"LaPerm\",\r\n              \"label\": \"LaPerm\"\r\n            },\r\n            {\r\n              \"key\": \"Donskoy\",\r\n              \"label\": \"Donskoy\"\r\n            },\r\n            {\r\n              \"key\": \"Savannah\",\r\n              \"label\": \"Savannah\"\r\n            },\r\n            {\r\n              \"key\": \"Ragamuffin\",\r\n              \"label\": \"Ragamuffin\"\r\n            },\r\n            {\r\n              \"key\": \"Minuet (Napoleon)\",\r\n              \"label\": \"Minuet (Napoleon)\"\r\n            },\r\n            {\r\n              \"key\": \"Australian Mist\",\r\n              \"label\": \"Australian Mist\"\r\n            },\r\n            {\r\n              \"key\": \"Snowshoe\",\r\n              \"label\": \"Snowshoe\"\r\n            },\r\n            {\r\n              \"key\": \"Toyger\",\r\n              \"label\": \"Toyger\"\r\n            },\r\n            {\r\n              \"key\": \"Dinkum Cat\",\r\n              \"label\": \"Dinkum Cat\"\r\n            },\r\n            {\r\n              \"key\": \"Ocicat\",\r\n              \"label\": \"Ocicat\"\r\n            },\r\n            {\r\n              \"key\": \"Balinese\",\r\n              \"label\": \"Balinese\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"rabbits\",\r\n          \"label\": \"rabbits\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Spot Rabbit\",\r\n              \"label\": \"Spot Rabbit\"\r\n            },\r\n            {\r\n              \"key\": \"Angora\",\r\n              \"label\": \"Angora\"\r\n            },\r\n            {\r\n              \"key\": \"Creme d'Argent\",\r\n              \"label\": \"Creme d'Argent\"\r\n            },\r\n            {\r\n              \"key\": \"Flemish Rabbit\",\r\n              \"label\": \"Flemish Rabbit\"\r\n            },\r\n            {\r\n              \"key\": \"Dutch\",\r\n              \"label\": \"Dutch\"\r\n            },\r\n            {\r\n              \"key\": \"Oryctolagus cuniculus\",\r\n              \"label\": \"Oryctolagus cuniculus\"\r\n            },\r\n            {\r\n              \"key\": \"Red-eared Slider\",\r\n              \"label\": \"Red-eared Slider\"\r\n            },\r\n            {\r\n              \"key\": \"Yellow-bellied Slider\",\r\n              \"label\": \"Yellow-bellied Slider\"\r\n            },\r\n            {\r\n              \"key\": \"Map Turtle\",\r\n              \"label\": \"Map Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Common Musk Turtle\",\r\n              \"label\": \"Common Musk Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Razor-backed Musk Turtle\",\r\n              \"label\": \"Razor-backed Musk Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Mud Turtle\",\r\n              \"label\": \"Mud Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Diamondback Terrapin\",\r\n              \"label\": \"Diamondback Terrapin\"\r\n            },\r\n            {\r\n              \"key\": \"Chinese Pond Turtle\",\r\n              \"label\": \"Chinese Pond Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Golden Coin Turtle\",\r\n              \"label\": \"Golden Coin Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Reeves's Turtle\",\r\n              \"label\": \"Reeves's Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Asian Leaf Turtle\",\r\n              \"label\": \"Asian Leaf Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Burmese Star Tortoise\",\r\n              \"label\": \"Burmese Star Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Indian Star Tortoise\",\r\n              \"label\": \"Indian Star Tortoise\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"hamster\",\r\n          \"label\": \"hamster\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Sulcata Tortoise\",\r\n              \"label\": \"Sulcata Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Leopard Tortoise\",\r\n              \"label\": \"Leopard Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Hermann's Tortoise\",\r\n              \"label\": \"Hermann's Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Greek Tortoise\",\r\n              \"label\": \"Greek Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Russian Tortoise\",\r\n              \"label\": \"Russian Tortoise\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"pigs\",\r\n          \"label\": \"pigs\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Red-footed Tortoise\",\r\n              \"label\": \"Red-footed Tortoise\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"sheep\",\r\n          \"label\": \"sheep\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Yellow-footed Tortoise\",\r\n              \"label\": \"Yellow-footed Tortoise\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"horses\",\r\n          \"label\": \"horses\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"nan\",\r\n              \"label\": \"nan\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"hedgehogs\",\r\n          \"label\": \"hedgehogs\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"nan\",\r\n              \"label\": \"nan\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"sugar gliders\",\r\n          \"label\": \"sugar gliders\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"nan\",\r\n              \"label\": \"nan\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"squirrels\",\r\n          \"label\": \"squirrels\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"nan\",\r\n              \"label\": \"nan\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"key\": \"reptiles\",\r\n      \"label\": \"reptiles\",\r\n      \"species\": [\r\n        {\r\n          \"key\": \"frogs\",\r\n          \"label\": \"frogs\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"White's Tree Frog\",\r\n              \"label\": \"White's Tree Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Green Tree Frog\",\r\n              \"label\": \"Green Tree Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Red-eyed Tree Frog\",\r\n              \"label\": \"Red-eyed Tree Frog\"\r\n            },\r\n            {\r\n              \"key\": \"American Bullfrog\",\r\n              \"label\": \"American Bullfrog\"\r\n            },\r\n            {\r\n              \"key\": \"African Dwarf Frog\",\r\n              \"label\": \"African Dwarf Frog\"\r\n            },\r\n            {\r\n              \"key\": \"African Clawed Frog\",\r\n              \"label\": \"African Clawed Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Poison Dart Frog\",\r\n              \"label\": \"Poison Dart Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Horned Frog\",\r\n              \"label\": \"Horned Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Amazonian Horned Frog\",\r\n              \"label\": \"Amazonian Horned Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Ornate Horned Frog\",\r\n              \"label\": \"Ornate Horned Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Tomato Frog\",\r\n              \"label\": \"Tomato Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Glass Frog\",\r\n              \"label\": \"Glass Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Asian Rice Frog\",\r\n              \"label\": \"Asian Rice Frog\"\r\n            },\r\n            {\r\n              \"key\": \"Taiwan Tree Frog\",\r\n              \"label\": \"Taiwan Tree Frog\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"snakes\",\r\n          \"label\": \"snakes\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Ball Python\",\r\n              \"label\": \"Ball Python\"\r\n            },\r\n            {\r\n              \"key\": \"Corn Snake\",\r\n              \"label\": \"Corn Snake\"\r\n            },\r\n            {\r\n              \"key\": \"Milk Snake\",\r\n              \"label\": \"Milk Snake\"\r\n            },\r\n            {\r\n              \"key\": \"Kingsnake\",\r\n              \"label\": \"Kingsnake\"\r\n            },\r\n            {\r\n              \"key\": \"California Kingsnake\",\r\n              \"label\": \"California Kingsnake\"\r\n            },\r\n            {\r\n              \"key\": \"Red-tailed Boa\",\r\n              \"label\": \"Red-tailed Boa\"\r\n            },\r\n            {\r\n              \"key\": \"Burmese Python\",\r\n              \"label\": \"Burmese Python\"\r\n            },\r\n            {\r\n              \"key\": \"Reticulated Python\",\r\n              \"label\": \"Reticulated Python\"\r\n            },\r\n            {\r\n              \"key\": \"Green Tree Python\",\r\n              \"label\": \"Green Tree Python\"\r\n            },\r\n            {\r\n              \"key\": \"Carpet Python\",\r\n              \"label\": \"Carpet Python\"\r\n            },\r\n            {\r\n              \"key\": \"Blood Python\",\r\n              \"label\": \"Blood Python\"\r\n            },\r\n            {\r\n              \"key\": \"Short-tailed Python\",\r\n              \"label\": \"Short-tailed Python\"\r\n            },\r\n            {\r\n              \"key\": \"Hognose Snake\",\r\n              \"label\": \"Hognose Snake\"\r\n            },\r\n            {\r\n              \"key\": \"Garter Snake\",\r\n              \"label\": \"Garter Snake\"\r\n            },\r\n            {\r\n              \"key\": \"Vine Snake\",\r\n              \"label\": \"Vine Snake\"\r\n            },\r\n            {\r\n              \"key\": \"Rat Snake\",\r\n              \"label\": \"Rat Snake\"\r\n            },\r\n            {\r\n              \"key\": \"Ratsnake (Oriental Rat Snake)\",\r\n              \"label\": \"Ratsnake (Oriental Rat Snake)\"\r\n            },\r\n            {\r\n              \"key\": \"White-lipped Tree Snake\",\r\n              \"label\": \"White-lipped Tree Snake\"\r\n            },\r\n            {\r\n              \"key\": \"Cobra\",\r\n              \"label\": \"Cobra\"\r\n            },\r\n            {\r\n              \"key\": \"King Cobra\",\r\n              \"label\": \"King Cobra\"\r\n            },\r\n            {\r\n              \"key\": \"Rattlesnake\",\r\n              \"label\": \"Rattlesnake\"\r\n            },\r\n            {\r\n              \"key\": \"Green Mamba\",\r\n              \"label\": \"Green Mamba\"\r\n            },\r\n            {\r\n              \"key\": \"Black Mamba\",\r\n              \"label\": \"Black Mamba\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"lizards\",\r\n          \"label\": \"lizards\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Leopard Gecko\",\r\n              \"label\": \"Leopard Gecko\"\r\n            },\r\n            {\r\n              \"key\": \"Crested Gecko\",\r\n              \"label\": \"Crested Gecko\"\r\n            },\r\n            {\r\n              \"key\": \"African Fat-tailed Gecko\",\r\n              \"label\": \"African Fat-tailed Gecko\"\r\n            },\r\n            {\r\n              \"key\": \"Giant Day Gecko\",\r\n              \"label\": \"Giant Day Gecko\"\r\n            },\r\n            {\r\n              \"key\": \"Day Gecko\",\r\n              \"label\": \"Day Gecko\"\r\n            },\r\n            {\r\n              \"key\": \"Blue-tongued Skink\",\r\n              \"label\": \"Blue-tongued Skink\"\r\n            },\r\n            {\r\n              \"key\": \"Solomon Islands Skink\",\r\n              \"label\": \"Solomon Islands Skink\"\r\n            },\r\n            {\r\n              \"key\": \"Green Iguana\",\r\n              \"label\": \"Green Iguana\"\r\n            },\r\n            {\r\n              \"key\": \"Red Iguana\",\r\n              \"label\": \"Red Iguana\"\r\n            },\r\n            {\r\n              \"key\": \"Desert Iguana\",\r\n              \"label\": \"Desert Iguana\"\r\n            },\r\n            {\r\n              \"key\": \"Chameleon\",\r\n              \"label\": \"Chameleon\"\r\n            },\r\n            {\r\n              \"key\": \"Leaf-tailed Gecko\",\r\n              \"label\": \"Leaf-tailed Gecko\"\r\n            },\r\n            {\r\n              \"key\": \"Bearded Dragon\",\r\n              \"label\": \"Bearded Dragon\"\r\n            },\r\n            {\r\n              \"key\": \"Uromastyx\",\r\n              \"label\": \"Uromastyx\"\r\n            },\r\n            {\r\n              \"key\": \"Nile Monitor\",\r\n              \"label\": \"Nile Monitor\"\r\n            },\r\n            {\r\n              \"key\": \"Savannah Monitor\",\r\n              \"label\": \"Savannah Monitor\"\r\n            },\r\n            {\r\n              \"key\": \"Blue Tree Monitor\",\r\n              \"label\": \"Blue Tree Monitor\"\r\n            },\r\n            {\r\n              \"key\": \"Anole\",\r\n              \"label\": \"Anole\"\r\n            },\r\n            {\r\n              \"key\": \"Long-tailed Lizard\",\r\n              \"label\": \"Long-tailed Lizard\"\r\n            },\r\n            {\r\n              \"key\": \"Chinese Water Dragon\",\r\n              \"label\": \"Chinese Water Dragon\"\r\n            },\r\n            {\r\n              \"key\": \"Asian Water Dragon\",\r\n              \"label\": \"Asian Water Dragon\"\r\n            },\r\n            {\r\n              \"key\": \"Draco\",\r\n              \"label\": \"Draco\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"turtles\",\r\n          \"label\": \"turtles\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Red-eared Slider\",\r\n              \"label\": \"Red-eared Slider\"\r\n            },\r\n            {\r\n              \"key\": \"Yellow-bellied Slider\",\r\n              \"label\": \"Yellow-bellied Slider\"\r\n            },\r\n            {\r\n              \"key\": \"Map Turtle\",\r\n              \"label\": \"Map Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Common Musk Turtle\",\r\n              \"label\": \"Common Musk Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Razor-backed Musk Turtle\",\r\n              \"label\": \"Razor-backed Musk Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Mud Turtle\",\r\n              \"label\": \"Mud Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Diamondback Terrapin\",\r\n              \"label\": \"Diamondback Terrapin\"\r\n            },\r\n            {\r\n              \"key\": \"Chinese Pond Turtle\",\r\n              \"label\": \"Chinese Pond Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Golden Coin Turtle\",\r\n              \"label\": \"Golden Coin Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Reeves's Turtle\",\r\n              \"label\": \"Reeves's Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Asian Leaf Turtle\",\r\n              \"label\": \"Asian Leaf Turtle\"\r\n            },\r\n            {\r\n              \"key\": \"Burmese Star Tortoise\",\r\n              \"label\": \"Burmese Star Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Indian Star Tortoise\",\r\n              \"label\": \"Indian Star Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Sulcata Tortoise\",\r\n              \"label\": \"Sulcata Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Leopard Tortoise\",\r\n              \"label\": \"Leopard Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Hermann's Tortoise\",\r\n              \"label\": \"Hermann's Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Greek Tortoise\",\r\n              \"label\": \"Greek Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Russian Tortoise\",\r\n              \"label\": \"Russian Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Red-footed Tortoise\",\r\n              \"label\": \"Red-footed Tortoise\"\r\n            },\r\n            {\r\n              \"key\": \"Yellow-footed Tortoise\",\r\n              \"label\": \"Yellow-footed Tortoise\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"key\": \"birds\",\r\n      \"label\": \"birds\",\r\n      \"species\": [\r\n        {\r\n          \"key\": \"birds\",\r\n          \"label\": \"birds\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Budgerigar\",\r\n              \"label\": \"Budgerigar\"\r\n            },\r\n            {\r\n              \"key\": \"Cockatiel\",\r\n              \"label\": \"Cockatiel\"\r\n            },\r\n            {\r\n              \"key\": \"Monk Parakeet\",\r\n              \"label\": \"Monk Parakeet\"\r\n            },\r\n            {\r\n              \"key\": \"Sun Conure\",\r\n              \"label\": \"Sun Conure\"\r\n            },\r\n            {\r\n              \"key\": \"Sun Conure (Golden)\",\r\n              \"label\": \"Sun Conure (Golden)\"\r\n            },\r\n            {\r\n              \"key\": \"Caique\",\r\n              \"label\": \"Caique\"\r\n            },\r\n            {\r\n              \"key\": \"African Grey Parrot\",\r\n              \"label\": \"African Grey Parrot\"\r\n            },\r\n            {\r\n              \"key\": \"Eclectus Parrot\",\r\n              \"label\": \"Eclectus Parrot\"\r\n            },\r\n            {\r\n              \"key\": \"Amazon Parrot\",\r\n              \"label\": \"Amazon Parrot\"\r\n            },\r\n            {\r\n              \"key\": \"Macaw\",\r\n              \"label\": \"Macaw\"\r\n            },\r\n            {\r\n              \"key\": \"Green-cheeked Conure\",\r\n              \"label\": \"Green-cheeked Conure\"\r\n            },\r\n            {\r\n              \"key\": \"Lovebird\",\r\n              \"label\": \"Lovebird\"\r\n            },\r\n            {\r\n              \"key\": \"Java Sparrow\",\r\n              \"label\": \"Java Sparrow\"\r\n            },\r\n            {\r\n              \"key\": \"Zebra Finch\",\r\n              \"label\": \"Zebra Finch\"\r\n            },\r\n            {\r\n              \"key\": \"Canary\",\r\n              \"label\": \"Canary\"\r\n            },\r\n            {\r\n              \"key\": \"White Java Sparrow\",\r\n              \"label\": \"White Java Sparrow\"\r\n            },\r\n            {\r\n              \"key\": \"Pigeon\",\r\n              \"label\": \"Pigeon\"\r\n            },\r\n            {\r\n              \"key\": \"Dove\",\r\n              \"label\": \"Dove\"\r\n            },\r\n            {\r\n              \"key\": \"Quail\",\r\n              \"label\": \"Quail\"\r\n            },\r\n            {\r\n              \"key\": \"Peafowl\",\r\n              \"label\": \"Peafowl\"\r\n            },\r\n            {\r\n              \"key\": \"Crow\",\r\n              \"label\": \"Crow\"\r\n            },\r\n            {\r\n              \"key\": \"Myna\",\r\n              \"label\": \"Myna\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"ducks\",\r\n          \"label\": \"ducks\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"Pekin Duck\",\r\n              \"label\": \"Pekin Duck\"\r\n            },\r\n            {\r\n              \"key\": \"Muscovy Duck\",\r\n              \"label\": \"Muscovy Duck\"\r\n            },\r\n            {\r\n              \"key\": \"Mallard\",\r\n              \"label\": \"Mallard\"\r\n            },\r\n            {\r\n              \"key\": \"Khaki Campbell Duck\",\r\n              \"label\": \"Khaki Campbell Duck\"\r\n            },\r\n            {\r\n              \"key\": \"Indian Runner Duck\",\r\n              \"label\": \"Indian Runner Duck\"\r\n            },\r\n            {\r\n              \"key\": \"Call Duck\",\r\n              \"label\": \"Call Duck\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"chickens\",\r\n          \"label\": \"chickens\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"nan\",\r\n              \"label\": \"nan\"\r\n            }\r\n          ]\r\n        },\r\n        {\r\n          \"key\": \"geese\",\r\n          \"label\": \"geese\",\r\n          \"hasBreed\": true,\r\n          \"breeds\": [\r\n            {\r\n              \"key\": \"nan\",\r\n              \"label\": \"nan\"\r\n            }\r\n          ]\r\n        }\r\n      ]\r\n    }\r\n  ]\r\n}", "import { DrizzleD1Database } from \"drizzle-orm/d1\";\nimport * as schema from \"../../db/schema\";\nimport { Env } from \"../../types\";\nimport { Owner } from \"../../db/models\";\n\nfunction imageMimeToExt(mimeType: string): \"jpg\" | \"png\" | \"webp\" | null {\n  switch (mimeType.toLowerCase()) {\n    case \"image/jpeg\":\n      return \"jpg\";\n    case \"image/png\":\n      return \"png\";\n    case \"image/webp\":\n      return \"webp\";\n    default:\n      return null;\n  }\n}\n\nfunction getPublicMediaBase(env: Env): string {\n  const raw = (env.R2_PUBLIC_BASE_URL ?? \"https://media.rubypets.com\").trim();\n  return raw.replace(/\\/+$/, \"\");\n}\n\ntype CreatePetPayload = {\n  pet_id: string;\n  owners_uuid: string;\n  class: string;\n  species: string;\n  breed: string | null;\n  name: string;\n  gender: \"male\" | \"female\" | \"unknown\";\n  birthday: string;\n  bio: string | null;\n  avatar_storage_key: string;\n  avatar_url: string;\n};\n\nexport async function createPetForOwner(\n  db: DrizzleD1Database<typeof schema>,\n  env: Env,\n  me: Owner,\n  body: CreatePetPayload\n) {\n  const {\n    pet_id,\n    owners_uuid,\n    \"class\": petClass,\n    species,\n    breed,\n    name,\n    gender,\n    birthday: birthdayRaw,\n    bio,\n    avatar_storage_key: storageKey,\n    avatar_url: avatarUrl\n  } = body;\n\n  if (!pet_id || !owners_uuid || !petClass || !species || !name || !storageKey || !avatarUrl) {\n    throw Object.assign(new Error(\"missing required fields\"), { status: 400 });\n  }\n  if (owners_uuid !== me.uuid) throw Object.assign(new Error(\"Forbidden\"), { status: 403 });\n  if (!gender) throw Object.assign(new Error(\"gender required\"), { status: 400 });\n  if (![\"male\", \"female\", \"unknown\"].includes(gender)) {\n    throw Object.assign(new Error(\"invalid gender\"), { status: 400 });\n  }\n  if (!birthdayRaw) throw Object.assign(new Error(\"birthday required\"), { status: 400 });\n  if (bio && bio.length > 200) throw Object.assign(new Error(\"bio too long\"), { status: 400 });\n\n  let birthday: string | null = null;\n  if (birthdayRaw && birthdayRaw !== \"unknown\") {\n    if (!/^\\d{4}-\\d{2}-\\d{2}$/.test(birthdayRaw)) {\n      throw Object.assign(new Error(\"invalid birthday\"), { status: 400 });\n    }\n    birthday = birthdayRaw;\n  }\n\n  const keyPrefix = `owners/${me.uuid}/pets/${pet_id}/`;\n  if (!storageKey.startsWith(keyPrefix)) {\n    throw Object.assign(new Error(\"invalid avatar_storage_key\"), { status: 400 });\n  }\n  const fileName = storageKey.slice(keyPrefix.length);\n  if (!new RegExp(`^${pet_id}_avatar\\.(jpg|png|webp)$`).test(fileName)) {\n    throw Object.assign(new Error(\"invalid avatar_storage_key\"), { status: 400 });\n  }\n\n  const base = getPublicMediaBase(env);\n  const expectedUrl = `${base}/${storageKey}`;\n  if (avatarUrl !== expectedUrl) throw Object.assign(new Error(\"avatar_url mismatch\"), { status: 400 });\n\n  const existing = await db.getPetById(pet_id);\n  if (existing) throw Object.assign(new Error(\"pet already exists\"), { status: 409 });\n\n  const currentCount = await db.countActivePetsByOwner(me.uuid);\n  if (currentCount >= me.maxPets) throw Object.assign(new Error(\"pet limit reached\"), { status: 409 });\n\n  const head = await env.R2_MEDIA.head(storageKey);\n  if (!head) throw Object.assign(new Error(\"avatar not found\"), { status: 404 });\n\n  const asset = await db.createMediaAsset({\n    ownerId: me.uuid,\n    kind: \"image\",\n    usage: \"pet_avatar\",\n    storageProvider: \"r2\",\n    storageKey,\n    url: avatarUrl,\n    mimeType: head.httpMetadata?.contentType ?? null,\n    sizeBytes: head.size ?? null,\n    status: \"uploaded\"\n  });\n\n  const pet = await db.createPet({\n    id: pet_id,\n    ownerId: me.uuid,\n    name,\n    class: petClass,\n    species,\n    breed,\n    gender: gender as \"male\" | \"female\" | \"unknown\",\n    birthday,\n    avatarAssetId: asset.id,\n    avatarUrl,\n    bio\n  });\n\n  return pet;\n}\n", "import { HandlerContext } from \"../../types\";\nimport { asNumber, errorJson, okJson } from \"../utils\";\nimport { getUserFromAuthHeader } from \"../../services/auth\";\nimport { requireAuthOwner } from \"./shared\";\nimport { DynamicRoute, Route } from \"./types\";\nimport petsCategory from \"../../data/pets-category.json\";\nimport { createPetForOwner } from \"../../services/pets\";\n\nasync function petsCategoriesRoute(_ctx: HandlerContext): Promise<Response> {\n  return okJson(petsCategory, 200);\n}\n\nasync function r2PetAvatarUploadRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const form = await ctx.request.formData().catch(() => null);\n  if (!form) return errorJson(\"invalid form data\", 400);\n\n  const petId = (form.get(\"pet_id\") ?? \"\").toString().trim();\n  const file = form.get(\"file\");\n  if (!petId || !(file instanceof File)) {\n    return errorJson(\"pet_id and file are required\", 400);\n  }\n\n  const ext = imageMimeToExt(file.type || \"\");\n  if (!ext) return errorJson(\"unsupported file type\", 422);\n\n  const key = `owners/${me.uuid}/pets/${petId}/${petId}_avatar.${ext}`;\n  await ctx.env.R2_MEDIA.put(key, file, { httpMetadata: { contentType: file.type || undefined } });\n\n  const base = getPublicMediaBase(ctx.env);\n  const publicUrl = `${base}/${key}`;\n  return okJson({ storage_key: key, public_url: publicUrl }, 200);\n}\n\nasync function createPetsRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const body = await ctx.request.json();\n\n  const pet = await createPetForOwner(ctx.db, ctx.env, me, body);\n\n  return okJson(pet, 201);\n}\n\nasync function petDetailRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const pet = await ctx.db.getPetById(params.id);\n  if (!pet) return errorJson(\"Not found\", 404);\n  const authed = await getUserFromAuthHeader(ctx.db, ctx.request);\n  const isFollowing = authed ? await ctx.db.isFollowingPet(authed.uuid, pet.id) : false;\n  return okJson({ ...pet, isFollowing }, 200);\n}\n\nasync function followPetRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const pet = await ctx.db.getPetById(params.id);\n  if (!pet) return errorJson(\"Not found\", 404);\n  if (await ctx.db.isPetOwnedByOwner(pet.id, me.uuid)) {\n    return errorJson(\"Cannot follow your own pet\", 403);\n  }\n  // TODO: add block checks when block feature is available.\n\n  const followersCount = await ctx.db.followPetTx(me.uuid, pet.id);\n  return okJson({ petId: pet.id, isFollowing: true, followersCount }, 200);\n}\n\nasync function unfollowPetRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const pet = await ctx.db.getPetById(params.id);\n  if (!pet) return errorJson(\"Not found\", 404);\n\n  const followersCount = await ctx.db.unfollowPetTx(me.uuid, pet.id);\n  return okJson({ petId: pet.id, isFollowing: false, followersCount }, 200);\n}\n\nasync function petFollowersRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const pet = await ctx.db.getPetById(params.id);\n  if (!pet) return errorJson(\"Not found\", 404);\n\n  const url = new URL(ctx.request.url);\n  const limit = Math.min(50, Math.max(1, asNumber(url.searchParams.get(\"limit\"), 20)));\n  const cursorRaw = url.searchParams.get(\"cursor\");\n  const cursor = cursorRaw && Number.isFinite(Number(cursorRaw)) ? Number(cursorRaw) : null;\n\n  const page = await ctx.db.listPetFollowers(pet.id, limit, cursor);\n  return okJson(page, 200);\n}\n\nfunction imageMimeToExt(mimeType: string): \"jpg\" | \"png\" | \"webp\" | null {\n  switch (mimeType.toLowerCase()) {\n    case \"image/jpeg\":\n      return \"jpg\";\n    case \"image/png\":\n      return \"png\";\n    case \"image/webp\":\n      return \"webp\";\n    default:\n      return null;\n  }\n}\n\nfunction getPublicMediaBase(env: HandlerContext[\"env\"]): string {\n  const raw = (env.R2_PUBLIC_BASE_URL ?? \"https://media.rubypets.com\").trim();\n  return raw.replace(/\\/+$/, \"\");\n}\n\nexport const routes: Route[] = [\n  { method: \"GET\", path: \"/pets/categories\", handler: petsCategoriesRoute },\n  { method: \"POST\", path: \"/r2/pets/avatar/upload\", handler: r2PetAvatarUploadRoute },\n  { method: \"POST\", path: \"/create-pets\", handler: createPetsRoute }\n];\n\nexport const dynamicRoutes: DynamicRoute[] = [\n  { method: \"POST\", pattern: /^\\/pets\\/([^/]+)\\/follow$/, handler: followPetRoute },\n  { method: \"DELETE\", pattern: /^\\/pets\\/([^/]+)\\/follow$/, handler: unfollowPetRoute },\n  { method: \"GET\", pattern: /^\\/pets\\/([^/]+)\\/followers$/, handler: petFollowersRoute },\n  { method: \"GET\", pattern: /^\\/pets\\/(?!categories$)([^/]+)$/, handler: petDetailRoute }\n];\n", "import { HandlerContext } from \"../../types\";\r\nimport { asNumber, errorJson, okJson } from \"../utils\";\r\nimport { getUserFromAuthHeader } from \"../../services/auth\";\nimport { requireAuthOwner } from \"./shared\";\nimport { DynamicRoute, Route } from \"./types\";\nimport { notifyFriendRequest } from \"../../services/notifications\";\n\r\nfunction canonicalPair(a: string, b: string) {\r\n  if (a === b) return null;\r\n  const ownerA = a < b ? a : b;\r\n  const ownerB = a < b ? b : a;\r\n  return { ownerA, ownerB, pairKey: `${ownerA}#${ownerB}` };\r\n}\r\n\r\nasync function ownersSearchRoute(ctx: HandlerContext): Promise<Response> {\r\n  const me = await requireAuthOwner(ctx);\n  const url = new URL(ctx.request.url);\n  const q = (url.searchParams.get(\"display_name\") ?? \"\").trim().toLowerCase();\n  const limit = Math.min(20, Math.max(10, asNumber(url.searchParams.get(\"limit\"), 20)));\n\n  if (q.length < 2) return okJson({ items: [] });\n\n  const items = await ctx.db.searchOwnersByDisplayName(q, limit, me.uuid);\n  return okJson({ items });\n}\n\r\nasync function incomingRequestsRoute(ctx: HandlerContext): Promise<Response> {\r\n  const me = await requireAuthOwner(ctx);\r\n  const items = await ctx.db.listIncomingRequests(me.uuid, 50);\r\n  return okJson({ items });\r\n}\r\n\r\nasync function outgoingRequestsRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const items = await ctx.db.listOutgoingRequests(me.uuid, 50);\n  return okJson({ items });\n}\n\nasync function friendsListRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const url = new URL(ctx.request.url);\n  const limit = Math.min(100, Math.max(1, asNumber(url.searchParams.get(\"limit\"), 50)));\n  const items = await ctx.db.listFriends(me.uuid, limit);\n  const payload = items.map((item) => ({\n    uuid: item.uuid,\n    display_name: item.displayName,\n    avatar_url: item.avatarUrl ?? null,\n    city: item.city ?? null,\n    region: item.region ?? null\n  }));\n  return okJson({ items: payload });\n}\n\r\nasync function friendshipStatusRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\r\n  const me = await requireAuthOwner(ctx);\r\n  const otherId = params.id;\r\n  const pair = canonicalPair(me.uuid, otherId);\r\n  if (!pair) return errorJson(\"Invalid target\", 400);\r\n\r\n  const row = await ctx.db.getFriendshipRowByPairKey(pair.pairKey);\r\n  if (!row) return okJson({ status: \"none\" });\r\n\r\n  if (row.status === \"accepted\") return okJson({ status: \"friends\" });\r\n\r\n  if (row.requestedBy === me.uuid) return okJson({ status: \"pending_outgoing\" });\r\n  return okJson({ status: \"pending_incoming\" });\r\n}\r\n\r\nasync function sendFriendRequestRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\r\n  const me = await requireAuthOwner(ctx);\r\n  const otherId = params.id;\r\n  const pair = canonicalPair(me.uuid, otherId);\r\n  if (!pair) return errorJson(\"Invalid target\", 400);\r\n\r\n  const existing = await ctx.db.getFriendshipRowByPairKey(pair.pairKey);\r\n  if (existing) {\r\n    if (existing.status === \"accepted\") return errorJson(\"Already friends\", 409);\r\n    if (existing.requestedBy === me.uuid) return okJson({ status: \"pending_outgoing\" });\r\n    return okJson({ status: \"pending_incoming\" });\r\n  }\r\n\r\n  try {\n    const friendshipId = await ctx.db.createFriendRequest({\n      ownerA: pair.ownerA,\n      ownerB: pair.ownerB,\n      requestedBy: me.uuid,\n      pairKey: pair.pairKey\n    });\n    if (friendshipId > 0 && otherId !== me.uuid) {\n      ctx.ctx.waitUntil(\n        notifyFriendRequest({\n          env: ctx.env,\n          db: ctx.env.DB,\n          recipientId: otherId,\n          actorId: me.uuid,\n          friendshipId\n        })\n      );\n    }\n  } catch (err) {\n    return errorJson(\"Failed to create request\", 500);\n  }\n\r\n  return okJson({ status: \"pending_outgoing\" });\r\n}\r\n\r\nasync function cancelFriendRequestRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\r\n  const me = await requireAuthOwner(ctx);\r\n  const pair = canonicalPair(me.uuid, params.id);\r\n  if (!pair) return errorJson(\"Invalid target\", 400);\r\n\r\n  const changes = await ctx.db.deletePendingRequest(pair.pairKey, me.uuid);\r\n  if (!changes) return errorJson(\"Not found\", 404);\r\n  return okJson({ status: \"none\" });\r\n}\r\n\r\nasync function acceptFriendRequestRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\r\n  const me = await requireAuthOwner(ctx);\r\n  const pair = canonicalPair(me.uuid, params.id);\r\n  if (!pair) return errorJson(\"Invalid target\", 400);\r\n\r\n  const changes = await ctx.db.acceptPendingIncoming(pair.pairKey, me.uuid);\r\n  if (!changes) return errorJson(\"Not found\", 404);\r\n  return okJson({ status: \"friends\" });\r\n}\r\n\r\nasync function rejectFriendRequestRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\r\n  const me = await requireAuthOwner(ctx);\r\n  const pair = canonicalPair(me.uuid, params.id);\r\n  if (!pair) return errorJson(\"Invalid target\", 400);\r\n\r\n  const changes = await ctx.db.deletePendingIncoming(pair.pairKey, me.uuid);\r\n  if (!changes) return errorJson(\"Not found\", 404);\r\n  return okJson({ status: \"none\" });\r\n}\r\n\r\nasync function unfriendRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\r\n  const me = await requireAuthOwner(ctx);\r\n  const pair = canonicalPair(me.uuid, params.id);\r\n  if (!pair) return errorJson(\"Invalid target\", 400);\r\n\r\n  const changes = await ctx.db.deleteFriendship(pair.pairKey);\r\n  if (!changes) return errorJson(\"Not found\", 404);\r\n  return okJson({ status: \"none\" });\r\n}\r\n\r\nasync function ownerDetailRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const owner = await ctx.db.getOwnerByUuid(params.id);\n  if (!owner) return errorJson(\"Not found\", 404);\n  return okJson({\n    accountId: owner.accountId,\r\n    uuid: owner.uuid,\r\n    email: owner.email,\r\n    displayName: owner.displayName,\r\n    avatarUrl: owner.avatarUrl,\r\n    maxPets: owner.maxPets,\r\n    createdAt: owner.createdAt,\r\n    updatedAt: owner.updatedAt,\r\n    isActive: owner.isActive,\r\n    city: owner.city ?? null,\r\n    region: owner.region ?? null,\r\n    isVerified: owner.isVerified ?? 0,\r\n    idLicenseFrontUrl: owner.idLicenseFrontUrl ?? null,\r\n    idLicenseBackUrl: owner.idLicenseBackUrl ?? null,\r\n    faceWithLicenseUrl: owner.faceWithLicenseUrl ?? null\n  });\n}\n\nasync function ownerPetsRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const owner = await ctx.db.getOwnerByUuid(params.id);\n  if (!owner) return errorJson(\"Not found\", 404);\n  const items = await ctx.db.listPetsByOwner(params.id);\n  return okJson({ items }, 200);\n}\n\nasync function followedPetsRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const url = new URL(ctx.request.url);\n  const limit = Math.min(50, Math.max(1, asNumber(url.searchParams.get(\"limit\"), 20)));\n  const cursorRaw = url.searchParams.get(\"cursor\");\n  const cursor = cursorRaw && Number.isFinite(Number(cursorRaw)) ? Number(cursorRaw) : null;\n\n  const page = await ctx.db.listFollowedPets(me.uuid, limit, cursor);\n  return okJson(page, 200);\n}\n\r\nasync function ownerLocationRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\r\n  const authed = await getUserFromAuthHeader(ctx.db, ctx.request);\r\n  if (!authed || authed.uuid !== params.id) return errorJson(\"Forbidden\", 403);\r\n  const body = (await ctx.request.json()) as { city?: string; region?: string };\r\n  if (!body.city || !body.region) return errorJson(\"city and region are required\", 400);\r\n  const owner = await ctx.db.updateOwnerLocation(params.id, body.city, body.region);\r\n  return okJson({\r\n    accountId: owner.accountId,\r\n    uuid: owner.uuid,\r\n    email: owner.email,\r\n    displayName: owner.displayName,\r\n    avatarUrl: owner.avatarUrl,\r\n    maxPets: owner.maxPets,\r\n    createdAt: owner.createdAt,\r\n    updatedAt: owner.updatedAt,\r\n    isActive: owner.isActive,\r\n    city: owner.city ?? null,\r\n    region: owner.region ?? null,\r\n    isVerified: owner.isVerified ?? 0,\r\n    idLicenseFrontUrl: owner.idLicenseFrontUrl ?? null,\r\n    idLicenseBackUrl: owner.idLicenseBackUrl ?? null,\r\n    faceWithLicenseUrl: owner.faceWithLicenseUrl ?? null\r\n  });\r\n}\r\n\r\nasync function ownerVerificationDocsRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\r\n  const authed = await getUserFromAuthHeader(ctx.db, ctx.request);\r\n  if (!authed || authed.uuid !== params.id) return errorJson(\"Forbidden\", 403);\r\n\r\n  const owner = await ctx.db.getOwnerByUuid(params.id);\r\n  if (!owner) return errorJson(\"Not found\", 404);\r\n\r\n  const form = await ctx.request.formData();\r\n  const front = form.get(\"id_license_front\");\r\n  const back = form.get(\"id_license_back\");\r\n  const face = form.get(\"face_with_license\");\r\n  if (!(front instanceof File) || !(back instanceof File) || !(face instanceof File)) {\r\n    return errorJson(\"all three images are required\", 400);\r\n  }\r\n\r\n  const accountId = owner.accountId;\r\n  const basePath = `${accountId}/verify_doc/pics`;\r\n  const frontKey = `${basePath}/${accountId}_id_license_front.png`;\r\n  const backKey = `${basePath}/${accountId}_id_license_back.png`;\r\n  const faceKey = `${basePath}/${accountId}_face_with_license.png`;\r\n\r\n  await Promise.all([\r\n    ctx.env.R2_MEDIA.put(frontKey, front, { httpMetadata: { contentType: front.type || \"image/png\" } }),\r\n    ctx.env.R2_MEDIA.put(backKey, back, { httpMetadata: { contentType: back.type || \"image/png\" } }),\r\n    ctx.env.R2_MEDIA.put(faceKey, face, { httpMetadata: { contentType: face.type || \"image/png\" } })\r\n  ]);\r\n\r\n  const publicBase = ctx.env.R2_PUBLIC_BASE_URL?.replace(/\\/$/, \"\");\r\n  const toUrl = (key: string) => (publicBase ? `${publicBase}/${key}` : key);\r\n\r\n  const frontUrl = toUrl(frontKey);\r\n  const backUrl = toUrl(backKey);\r\n  const faceUrl = toUrl(faceKey);\r\n\r\n  await ctx.db.updateAccountVerificationUrls(accountId, {\r\n    frontUrl,\r\n    backUrl,\r\n    faceUrl,\r\n    setPending: true\r\n  });\r\n\r\n  return okJson(\r\n    {\r\n      idLicenseFrontUrl: frontUrl,\r\n      idLicenseBackUrl: backUrl,\r\n      faceWithLicenseUrl: faceUrl\r\n    },\r\n    200\r\n  );\r\n}\r\n\r\nexport const routes: Route[] = [\n  { method: \"GET\", path: \"/owners/search\", handler: ownersSearchRoute },\n  { method: \"GET\", path: \"/me/followed-pets\", handler: followedPetsRoute },\n  { method: \"GET\", path: \"/friendships/incoming\", handler: incomingRequestsRoute },\n  { method: \"GET\", path: \"/friendships/outgoing\", handler: outgoingRequestsRoute },\n  { method: \"GET\", path: \"/friendships/friends\", handler: friendsListRoute }\n];\n\r\nexport const dynamicRoutes: DynamicRoute[] = [\n  { method: \"GET\", pattern: /^\\/owners\\/(?!search$)([^/]+)$/, handler: ownerDetailRoute },\n  { method: \"GET\", pattern: /^\\/owners\\/([^/]+)\\/pets$/, handler: ownerPetsRoute },\n  { method: \"POST\", pattern: /^\\/owners\\/([^/]+)\\/location$/, handler: ownerLocationRoute },\n  { method: \"POST\", pattern: /^\\/owners\\/([^/]+)\\/verification-docs$/, handler: ownerVerificationDocsRoute },\r\n  { method: \"GET\", pattern: /^\\/owners\\/([^/]+)\\/friendship\\/status$/, handler: friendshipStatusRoute },\r\n  { method: \"POST\", pattern: /^\\/owners\\/([^/]+)\\/friend-request$/, handler: sendFriendRequestRoute },\r\n  { method: \"DELETE\", pattern: /^\\/owners\\/([^/]+)\\/friend-request$/, handler: cancelFriendRequestRoute },\r\n  { method: \"POST\", pattern: /^\\/owners\\/([^/]+)\\/friend-request\\/accept$/, handler: acceptFriendRequestRoute },\r\n  { method: \"DELETE\", pattern: /^\\/owners\\/([^/]+)\\/friend-request\\/reject$/, handler: rejectFriendRequestRoute },\r\n  { method: \"DELETE\", pattern: /^\\/owners\\/([^/]+)\\/friendship$/, handler: unfriendRoute }\r\n];\r\n", "import { HandlerContext } from \"../../types\";\nimport { asNumber, errorJson, okJson } from \"../utils\";\nimport { requireAuthOwner } from \"./shared\";\nimport { DynamicRoute, Route } from \"./types\";\nimport type { ChatThreadListItem } from \"../../db\";\n\nconst MAX_MESSAGE_LENGTH = 500;\n\nasync function listThreadsRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const url = new URL(ctx.request.url);\n  const limit = asNumber(url.searchParams.get(\"limit\"), 30);\n  const cursor = url.searchParams.get(\"cursor\");\n  const includeArchived = url.searchParams.get(\"archived\") === \"1\";\n\n  const page = await ctx.db.listChatThreadsForOwner(me.uuid, limit, cursor, includeArchived);\n  const items = await Promise.all(\n    page.items.map(async (item) => {\n      const isFriend = await ctx.db.isFriends(me.uuid, item.otherOwner.uuid);\n      return serializeThreadItem(item, isFriend);\n    })\n  );\n\n  return okJson({ items, nextCursor: page.nextCursor }, 200);\n}\n\nasync function getThreadRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const thread = await ctx.db.getChatThreadForOwner(params.id, me.uuid);\n  if (!thread) return errorJson(\"thread not found\", 404);\n  const isFriend = await ctx.db.isFriends(me.uuid, thread.otherOwner.uuid);\n  return okJson(serializeThreadItem(thread, isFriend), 200);\n}\n\nasync function createThreadRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const payload = (await ctx.request.json().catch(() => ({}))) as {\n    otherOwnerId?: string;\n    firstMessageText?: string;\n  };\n  const otherOwnerId = (payload.otherOwnerId ?? \"\").trim();\n  const firstMessageText = (payload.firstMessageText ?? \"\").trim();\n  if (!otherOwnerId) return errorJson(\"otherOwnerId required\", 400);\n  if (otherOwnerId === me.uuid) return errorJson(\"invalid otherOwnerId\", 400);\n  if (firstMessageText && firstMessageText.length > MAX_MESSAGE_LENGTH) {\n    return errorJson(\"firstMessageText too long\", 400);\n  }\n\n  const otherOwner = await ctx.db.getOwnerByUuid(otherOwnerId);\n  if (!otherOwner) return errorJson(\"owner not found\", 404);\n\n  const pairKey = buildPairKey(me.uuid, otherOwnerId);\n  let thread = await ctx.db.getChatThreadByPairKey(pairKey);\n\n  if (!thread) {\n    const isFriend = await ctx.db.isFriends(me.uuid, otherOwnerId);\n    const requestState = isFriend ? \"accepted\" : \"pending\";\n    if (!isFriend && !firstMessageText) {\n      return errorJson(\"firstMessageText required\", 400);\n    }\n\n    const ownerAId = me.uuid < otherOwnerId ? me.uuid : otherOwnerId;\n    const ownerBId = me.uuid < otherOwnerId ? otherOwnerId : me.uuid;\n    const threadId = crypto.randomUUID();\n\n    try {\n      thread = await ctx.db.createChatThread({\n        threadId,\n        ownerAId,\n        ownerBId,\n        pairKey,\n        requestState,\n        requestSenderId: requestState === \"pending\" ? me.uuid : null,\n        requestMessageId: null,\n        lastMessageId: null,\n        lastActivityAt: null\n      });\n    } catch (err) {\n      thread = await ctx.db.getChatThreadByPairKey(pairKey);\n      if (!thread) throw err;\n    }\n\n    await ctx.db.upsertChatParticipants(thread.id, ownerAId, ownerBId);\n\n    if (firstMessageText) {\n      const message = await ctx.db.insertChatMessage(thread.id, me.uuid, firstMessageText);\n      await ctx.db.updateChatThreadOnNewMessage(thread.id, message.id, {\n        requestMessageId: requestState === \"pending\" ? message.id : null,\n        requestSenderId: requestState === \"pending\" ? me.uuid : null\n      });\n    }\n  } else {\n    await ctx.db.setParticipantDeleted(thread.id, me.uuid, null);\n    await ctx.db.setParticipantArchived(thread.id, me.uuid, null);\n    if (\n      firstMessageText &&\n      thread.requestState === \"pending\" &&\n      thread.requestSenderId === me.uuid &&\n      !thread.requestMessageId\n    ) {\n      const message = await ctx.db.insertChatMessage(thread.id, me.uuid, firstMessageText);\n      await ctx.db.updateChatThreadOnNewMessage(thread.id, message.id, {\n        requestMessageId: message.id,\n        requestSenderId: me.uuid\n      });\n    }\n  }\n\n  const detail = await ctx.db.getChatThreadForOwner(thread.id, me.uuid);\n  if (!detail) return errorJson(\"thread not found\", 404);\n  const isFriend = await ctx.db.isFriends(me.uuid, detail.otherOwner.uuid);\n  return okJson(serializeThreadItem(detail, isFriend), 200);\n}\n\nasync function listMessagesRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const participant = await ctx.db.getChatParticipant(params.id, me.uuid);\n  if (!participant) return errorJson(\"forbidden\", 403);\n\n  const url = new URL(ctx.request.url);\n  const limit = asNumber(url.searchParams.get(\"limit\"), 30);\n  const before = url.searchParams.get(\"before\");\n\n  const page = await ctx.db.listChatMessages(params.id, limit, before);\n  return okJson(page, 200);\n}\n\nasync function acceptRequestRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  return updateRequestState(ctx, params.id, \"accepted\");\n}\n\nasync function rejectRequestRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  return updateRequestState(ctx, params.id, \"rejected\");\n}\n\nasync function archiveThreadRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const participant = await ctx.db.getChatParticipant(params.id, me.uuid);\n  if (!participant) return errorJson(\"forbidden\", 403);\n  await ctx.db.setParticipantArchived(params.id, me.uuid, new Date().toISOString());\n  return okJson(null, 200);\n}\n\nasync function deleteThreadRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const participant = await ctx.db.getChatParticipant(params.id, me.uuid);\n  if (!participant) return errorJson(\"forbidden\", 403);\n  await ctx.db.setParticipantDeleted(params.id, me.uuid, new Date().toISOString());\n  return okJson(null, 200);\n}\n\nasync function wsThreadRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const upgrade = ctx.request.headers.get(\"Upgrade\");\n  if (!upgrade || upgrade.toLowerCase() !== \"websocket\") {\n    return errorJson(\"Expected websocket\", 426);\n  }\n  const doId = ctx.env.CHAT_THREAD_DO.idFromName(params.id);\n  const stub = ctx.env.CHAT_THREAD_DO.get(doId);\n  return stub.fetch(ctx.request);\n}\n\nasync function updateRequestState(\n  ctx: HandlerContext,\n  threadId: string,\n  nextState: \"accepted\" | \"rejected\"\n): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const thread = await ctx.db.getChatThreadById(threadId);\n  if (!thread) return errorJson(\"thread not found\", 404);\n\n  const participant = await ctx.db.getChatParticipant(threadId, me.uuid);\n  if (!participant) return errorJson(\"forbidden\", 403);\n\n  if (thread.requestState !== \"pending\") {\n    return errorJson(\"invalid request state\", 409);\n  }\n  if (thread.requestSenderId && thread.requestSenderId === me.uuid) {\n    return errorJson(\"forbidden\", 403);\n  }\n\n  await ctx.db.updateChatThreadRequestState(threadId, nextState);\n  await notifyThreadUpdated(ctx, threadId);\n\n  return okJson(null, 200);\n}\n\nasync function notifyThreadUpdated(ctx: HandlerContext, threadId: string) {\n  try {\n    const base = new URL(ctx.request.url);\n    const target = new URL(`/ws/threads/${threadId}?action=thread_updated`, base.origin);\n    const doId = ctx.env.CHAT_THREAD_DO.idFromName(threadId);\n    const stub = ctx.env.CHAT_THREAD_DO.get(doId);\n    await stub.fetch(\n      new Request(target.toString(), {\n        method: \"POST\",\n        headers: ctx.request.headers\n      })\n    );\n  } catch (err) {\n    console.error(\"notifyThreadUpdated failed\", err);\n  }\n}\n\nfunction serializeThreadItem(item: ChatThreadListItem, isFriend: boolean) {\n  const fallbackUnread = !!item.lastMessageId && item.lastMessageId !== item.lastReadMessageId;\n  const unreadCount = item.unreadCount ?? (fallbackUnread ? 1 : 0);\n  const unread = unreadCount > 0;\n  return {\n    threadId: item.threadId,\n    otherOwner: item.otherOwner,\n    requestState: item.requestState,\n    requestSenderId: item.requestSenderId ?? null,\n    requestMessageId: item.requestMessageId ?? null,\n    lastMessageId: item.lastMessageId ?? null,\n    lastMessagePreview: item.lastMessagePreview ?? null,\n    lastActivityAt: item.lastActivityAt ?? null,\n    unreadCount,\n    unread,\n    archived: !!item.archivedAt,\n    deleted: !!item.deletedAt,\n    isFriend\n  };\n}\n\nfunction buildPairKey(ownerA: string, ownerB: string): string {\n  return ownerA < ownerB ? `${ownerA}:${ownerB}` : `${ownerB}:${ownerA}`;\n}\n\nexport const routes: Route[] = [\n  { method: \"GET\", path: \"/chat/threads\", handler: listThreadsRoute },\n  { method: \"POST\", path: \"/chat/threads\", handler: createThreadRoute }\n];\n\nexport const dynamicRoutes: DynamicRoute[] = [\n  { method: \"GET\", pattern: /^\\/chat\\/threads\\/([^/]+)$/, handler: getThreadRoute },\n  { method: \"GET\", pattern: /^\\/chat\\/threads\\/([^/]+)\\/messages$/, handler: listMessagesRoute },\n  { method: \"POST\", pattern: /^\\/chat\\/threads\\/([^/]+)\\/request\\/accept$/, handler: acceptRequestRoute },\n  { method: \"POST\", pattern: /^\\/chat\\/threads\\/([^/]+)\\/request\\/reject$/, handler: rejectRequestRoute },\n  { method: \"POST\", pattern: /^\\/chat\\/threads\\/([^/]+)\\/archive$/, handler: archiveThreadRoute },\n  { method: \"POST\", pattern: /^\\/chat\\/threads\\/([^/]+)\\/delete$/, handler: deleteThreadRoute },\n  { method: \"GET\", pattern: /^\\/ws\\/threads\\/([^/]+)$/, handler: wsThreadRoute }\n];\n", "\uFEFFimport { HandlerContext } from \"../../types\";\nimport { asNumber, errorJson, okJson } from \"../utils\";\nimport { requireAuthOwner } from \"./shared\";\nimport { registerPushToken, unregisterPushToken } from \"../../services/notifications\";\nimport { DynamicRoute, Route } from \"./types\";\n\ntype NotificationListRow = {\n  id: string;\n  type: string;\n  actor_count: number;\n  latest_action_at: string | null;\n  post_id: string | null;\n  comment_id: string | null;\n  friendship_id: number | null;\n  is_read: number;\n  is_hidden: number;\n  created_at: string;\n  sort_ts: string;\n};\n\ntype ActorRow = { actor_owner_id: string; display_name: string };\n\ntype Cursor = { ts: string; id: string };\n\nasync function registerPushTokenRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const body = (await ctx.request.json().catch(() => ({}))) as {\n    platform?: \"ios\" | \"android\";\n    fcm_token?: string;\n  };\n\n  const platform = body.platform;\n  const fcmToken = (body.fcm_token ?? \"\").trim();\n  if (!platform || ![\"ios\", \"android\"].includes(platform)) return errorJson(\"invalid platform\", 400);\n  if (!fcmToken) return errorJson(\"fcm_token required\", 400);\n\n  await registerPushToken(ctx.env.DB, me.uuid, platform, fcmToken);\n  return okJson({ fcm_token: fcmToken }, 200);\n}\n\nasync function unregisterPushTokenRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const body = (await ctx.request.json().catch(() => ({}))) as { fcm_token?: string };\n  const fcmToken = (body.fcm_token ?? \"\").trim();\n  if (!fcmToken) return errorJson(\"fcm_token required\", 400);\n  await unregisterPushToken(ctx.env.DB, fcmToken);\n  return okJson({ fcm_token: fcmToken, owner_id: me.uuid }, 200);\n}\n\nasync function listNotificationsRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const url = new URL(ctx.request.url);\n  const limit = Math.min(50, Math.max(1, asNumber(url.searchParams.get(\"limit\"), 20)));\n  const cursorRaw = url.searchParams.get(\"cursor\");\n  const cursor = parseCursor(cursorRaw);\n\n  const rows = await listNotifications(ctx.env.DB, me.uuid, limit, cursor);\n  const items = await Promise.all(\n    rows.items.map(async (row) => {\n      const actors = await listActors(ctx.env.DB, row.id, 3);\n      return {\n        id: row.id,\n        type: row.type,\n        actor_count: row.actor_count,\n        actors,\n        post_id: row.post_id ?? \"\",\n        comment_id: row.comment_id ?? \"\",\n        friendship_id: row.friendship_id ? String(row.friendship_id) : \"\",\n        is_read: row.is_read === 1,\n        latest_action_at: row.latest_action_at ?? row.created_at,\n        created_at: row.created_at\n      };\n    })\n  );\n\n  return okJson({ items, nextCursor: rows.nextCursor }, 200);\n}\n\nasync function markReadRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const id = params.id;\n  const ts = new Date().toISOString();\n  const res = await ctx.env.DB\n    .prepare(\n      `\n      update notifications\n      set is_read = 1, read_at = ?, updated_at = ?\n      where id = ? and recipient_owner_id = ?\n      `\n    )\n    .bind(ts, ts, id, me.uuid)\n    .run();\n  const changes = (res as { meta?: { changes?: number } })?.meta?.changes ?? 0;\n  if (!changes) return errorJson(\"Not found\", 404);\n  return okJson({ id }, 200);\n}\n\nasync function markAllReadRoute(ctx: HandlerContext): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const ts = new Date().toISOString();\n  await ctx.env.DB\n    .prepare(\n      `\n      update notifications\n      set is_read = 1, read_at = ?, updated_at = ?\n      where recipient_owner_id = ? and is_hidden = 0 and is_read = 0\n      `\n    )\n    .bind(ts, ts, me.uuid)\n    .run();\n  return okJson({ ok: true }, 200);\n}\n\nasync function hideNotificationRoute(ctx: HandlerContext, params: Record<string, string>): Promise<Response> {\n  const me = await requireAuthOwner(ctx);\n  const id = params.id;\n  const ts = new Date().toISOString();\n  const res = await ctx.env.DB\n    .prepare(\n      `\n      update notifications\n      set is_hidden = 1, hidden_at = ?, updated_at = ?\n      where id = ? and recipient_owner_id = ?\n      `\n    )\n    .bind(ts, ts, id, me.uuid)\n    .run();\n  const changes = (res as { meta?: { changes?: number } })?.meta?.changes ?? 0;\n  if (!changes) return errorJson(\"Not found\", 404);\n  return okJson({ id }, 200);\n}\n\nfunction parseCursor(value: string | null): Cursor | null {\n  if (!value) return null;\n  const [ts, id] = value.split(\"|\");\n  if (!ts || !id) return null;\n  return { ts, id };\n}\n\nfunction toCursor(row: NotificationListRow): string {\n  return `${row.sort_ts}|${row.id}`;\n}\n\nasync function listNotifications(\n  db: D1Database,\n  ownerId: string,\n  limit: number,\n  cursor: Cursor | null\n): Promise<{ items: NotificationListRow[]; nextCursor: string | null }> {\n  const safeLimit = Math.min(Math.max(limit, 1), 50);\n  const sortExpr = \"coalesce(latest_action_at, created_at)\";\n\n  let sql = `\n    select\n      id, type, actor_count, latest_action_at, post_id, comment_id, friendship_id,\n      is_read, is_hidden, created_at,\n      ${sortExpr} as sort_ts\n    from notifications\n    where recipient_owner_id = ? and is_hidden = 0\n  `;\n\n  const params: Array<string | number> = [ownerId];\n  if (cursor) {\n    sql += ` and (${sortExpr} < ? or (${sortExpr} = ? and id < ?))`;\n    params.push(cursor.ts, cursor.ts, cursor.id);\n  }\n\n  sql += ` order by ${sortExpr} desc, id desc limit ?`;\n  params.push(safeLimit + 1);\n\n  const { results } = await db.prepare(sql).bind(...params).all<NotificationListRow>();\n  const rows = results ?? [];\n  const hasMore = rows.length > safeLimit;\n  const pageRows = hasMore ? rows.slice(0, safeLimit) : rows;\n  const nextCursor = hasMore && pageRows.length > 0 ? toCursor(pageRows[pageRows.length - 1]) : null;\n\n  return { items: pageRows, nextCursor };\n}\n\nasync function listActors(db: D1Database, notificationId: string, limit: number) {\n  const { results } = await db\n    .prepare(\n      `\n      select na.actor_owner_id, o.display_name\n      from notification_actors na\n      join owners o on o.uuid = na.actor_owner_id\n      where na.notification_id = ?\n      order by na.last_action_at desc\n      limit ?\n      `\n    )\n    .bind(notificationId, limit)\n    .all<ActorRow>();\n\n  return (results ?? []).map((row) => ({\n    ownerId: row.actor_owner_id,\n    displayName: row.display_name\n  }));\n}\n\nexport const routes: Route[] = [\n  { method: \"POST\", path: \"/push-tokens/register\", handler: registerPushTokenRoute },\n  { method: \"POST\", path: \"/push-tokens/unregister\", handler: unregisterPushTokenRoute },\n  { method: \"GET\", path: \"/notifications\", handler: listNotificationsRoute },\n  { method: \"POST\", path: \"/notifications/mark-all-read\", handler: markAllReadRoute }\n];\n\nexport const dynamicRoutes: DynamicRoute[] = [\n  { method: \"POST\", pattern: /^\\/notifications\\/([^/]+)\\/read$/, handler: markReadRoute },\n  { method: \"DELETE\", pattern: /^\\/notifications\\/([^/]+)$/, handler: hideNotificationRoute }\n];\r\n", "import { errorJson, isOptions, okResponse, withCors } from \"./utils\";\nimport { HandlerContext } from \"../types\";\nimport { createDB } from \"../db\";\nimport { routes as systemRoutes } from \"./routes/system\";\nimport { routes as authRoutes } from \"./routes/auth\";\nimport { routes as postsRoutes, dynamicRoutes as postsDynamicRoutes } from \"./routes/posts\";\nimport { routes as mediaRoutes, dynamicRoutes as mediaDynamicRoutes } from \"./routes/media\";\nimport { routes as adminRoutes, dynamicRoutes as adminDynamicRoutes } from \"./routes/admin\";\nimport { routes as petsRoutes, dynamicRoutes as petsDynamicRoutes } from \"./routes/pets\";\nimport { routes as ownerRoutes, dynamicRoutes as ownerDynamicRoutes } from \"./routes/owners\";\nimport { routes as chatRoutes, dynamicRoutes as chatDynamicRoutes } from \"./routes/chat\";\nimport { routes as notifRoutes, dynamicRoutes as notifDynamicRoutes } from \"./routes/notifications\";\nimport { DynamicRoute, Route } from \"./routes/types\";\n\nconst routes: Route[] = [\n  ...systemRoutes,\n  ...postsRoutes,\n  ...authRoutes,\n  ...petsRoutes,\n  ...ownerRoutes,\n  ...mediaRoutes,\n  ...adminRoutes,\n  ...chatRoutes,\n  ...notifRoutes\n];\n\nconst dynamicRoutes: DynamicRoute[] = [\n  ...ownerDynamicRoutes,\n  ...petsDynamicRoutes,\n  ...adminDynamicRoutes,\n  ...postsDynamicRoutes,\n  ...mediaDynamicRoutes,\n  ...chatDynamicRoutes,\n  ...notifDynamicRoutes\n];\n\nexport async function handleRequest(request: Request, env: HandlerContext[\"env\"], ctx: ExecutionContext): Promise<Response> {\n  if (isOptions(request)) return okResponse();\n\n  const url = new URL(request.url);\n  const pathname = normalizePath(stripApiPrefix(url.pathname));\n  const dynamic = matchDynamicRoute(request.method, pathname);\n\n  if (dynamic) {\n    const db = createDB(env);\n    try {\n      const response = await dynamic.handler({ request, env, ctx, db }, dynamic.params);\n      return withCors(response);\n    } catch (err) {\n      const status = (err as { status?: number }).status;\n      if (status) {\n        const message = (err as Error).message || \"Unexpected error\";\n        return withCors(errorJson(message, status));\n      }\n      console.error(\"Request failed\", err);\n      return withCors(errorJson(\"Unexpected error\", 500));\n    }\n  }\n\n  const route = routes.find((entry) => entry.method === request.method && entry.path === pathname);\n\n  if (!route) {\n    return withCors(errorJson(\"Not found\", 404));\n  }\n\n  const db = createDB(env);\n\n  try {\n    const response = await route.handler({ request, env, ctx, db });\n    return withCors(response);\n  } catch (err) {\n    const status = (err as { status?: number }).status;\n    if (status) {\n      const message = (err as Error).message || \"Unexpected error\";\n      return withCors(errorJson(message, status));\n    }\n    console.error(\"Request failed\", err);\n    return withCors(errorJson(\"Unexpected error\", 500));\n  }\n}\n\nfunction normalizePath(path: string): string {\n  if (path === \"/\") return path;\n  return path.endsWith(\"/\") ? path.slice(0, -1) : path;\n}\n\n// Allow calling routes with or without a leading /api prefix.\nfunction stripApiPrefix(path: string): string {\n  if (!path.startsWith(\"/api\")) return path;\n  const next = path.slice(\"/api\".length);\n  return next.startsWith(\"/\") ? next : `/${next}`;\n}\n\nfunction matchDynamicRoute(\n  method: string,\n  pathname: string\n):\n  | { handler: (ctx: HandlerContext, params: Record<string, string>) => Promise<Response>; params: Record<string, string> }\n  | null {\n  for (const route of dynamicRoutes) {\n    if (route.method !== method) continue;\n    const m = pathname.match(route.pattern);\n    if (m) {\n      return { handler: route.handler, params: { id: m[1] } };\n    }\n  }\n  return null;\n}\n", "import { D1Client } from \"../db/d1-client\";\nimport { parseUserIdFromToken } from \"../services/auth\";\nimport { Env } from \"../types\";\nimport type { ChatRequestState } from \"../db/models\";\n\ntype ClientInfo = {\n  ownerId: string;\n  threadId: string;\n};\n\ntype WebSocketWithAttachment = WebSocket & {\n  serializeAttachment?: (attachment: unknown) => void;\n  deserializeAttachment?: () => unknown;\n};\n\ntype ClientMessage =\n  | { type: \"send\"; body_text?: string }\n  | { type: \"read\"; last_read_message_id?: string }\n  | { type: \"accept_request\" }\n  | { type: \"reject_request\" }\n  | { type: \"ping\" };\n\ntype ServerMessage =\n  | { type: \"message_new\"; message: ChatMessagePayload }\n  | { type: \"thread_updated\"; thread: ChatThreadPayload }\n  | { type: \"read_updated\"; owner_id: string; last_read_message_id: string }\n  | { type: \"error\"; message: string }\n  | { type: \"pong\" };\n\ntype ChatMessagePayload = {\n  id: string;\n  thread_id: string;\n  sender_id: string;\n  body_text: string;\n  created_at: string;\n};\n\ntype ChatThreadPayload = {\n  id: string;\n  request_state: ChatRequestState;\n  request_sender_id: string | null;\n  request_message_id: string | null;\n  last_message_id: string | null;\n  last_activity_at: string | null;\n};\n\nexport class ChatThreadDO {\n  private readonly state: DurableObjectState;\n  private readonly env: Env;\n  private readonly db: D1Client;\n  private readonly sockets = new Map<WebSocket, ClientInfo>();\n\n  constructor(state: DurableObjectState, env: Env) {\n    this.state = state;\n    this.env = env;\n    this.db = new D1Client(env.DB);\n    for (const socket of this.state.getWebSockets()) {\n      const restored = this.restoreClientInfo(socket);\n      if (restored) {\n        this.sockets.set(socket, restored);\n      } else {\n        socket.close(1011, \"Missing session\");\n      }\n    }\n  }\n\n  async fetch(request: Request): Promise<Response> {\n    const url = new URL(request.url);\n    const action = url.searchParams.get(\"action\");\n    if (action) {\n      return this.handleAction(action, request, url);\n    }\n\n    const upgrade = request.headers.get(\"Upgrade\");\n    if (!upgrade || upgrade.toLowerCase() !== \"websocket\") {\n      return new Response(\"Expected WebSocket\", { status: 426 });\n    }\n\n    const ownerId = this.resolveOwnerId(request, url);\n    if (!ownerId) {\n      return new Response(\"Unauthorized\", { status: 401 });\n    }\n\n    const threadId = extractThreadId(url.pathname);\n    if (!threadId) {\n      return new Response(\"Invalid thread id\", { status: 400 });\n    }\n\n    const participant = await this.db.getChatParticipant(threadId, ownerId);\n    if (!participant) {\n      return new Response(\"Forbidden\", { status: 403 });\n    }\n\n    const pair = new WebSocketPair();\n    const client = pair[0];\n    const server = pair[1];\n    this.state.acceptWebSocket(server);\n    (server as WebSocketWithAttachment).serializeAttachment?.({ ownerId, threadId });\n    this.sockets.set(server, { ownerId, threadId });\n\n    return new Response(null, { status: 101, webSocket: client });\n  }\n\n  async webSocketMessage(ws: WebSocket, message: string | ArrayBuffer): Promise<void> {\n    let info = this.sockets.get(ws);\n    if (!info) {\n      const restored = this.restoreClientInfo(ws);\n      if (restored) {\n        this.sockets.set(ws, restored);\n        info = restored;\n      }\n    }\n    if (!info) {\n      ws.close(1008, \"Unknown session\");\n      return;\n    }\n\n    const text = typeof message === \"string\" ? message : new TextDecoder().decode(message);\n    const payload = safeJson<ClientMessage>(text);\n    if (!payload || typeof payload.type !== \"string\") {\n      this.sendError(ws, \"Invalid payload\");\n      return;\n    }\n\n    try {\n      switch (payload.type) {\n        case \"send\":\n          await this.handleSend(ws, info, payload);\n          return;\n        case \"read\":\n          await this.handleRead(ws, info, payload);\n          return;\n        case \"accept_request\":\n          await this.handleRequestDecision(ws, info, \"accepted\");\n          return;\n        case \"reject_request\":\n          await this.handleRequestDecision(ws, info, \"rejected\");\n          return;\n        case \"ping\":\n          ws.send(JSON.stringify({ type: \"pong\" }));\n          return;\n        default:\n          this.sendError(ws, \"Unsupported message type\");\n      }\n    } catch (err) {\n      console.error(\"ChatThreadDO message failed\", err);\n      this.sendError(ws, \"Unexpected error\");\n    }\n  }\n\n  webSocketClose(ws: WebSocket): void {\n    this.sockets.delete(ws);\n  }\n\n  webSocketError(ws: WebSocket): void {\n    this.sockets.delete(ws);\n  }\n\n  private async handleAction(action: string, request: Request, url: URL): Promise<Response> {\n    if (request.method !== \"POST\") {\n      return new Response(\"Method not allowed\", { status: 405 });\n    }\n    if (action !== \"thread_updated\") {\n      return new Response(\"Not found\", { status: 404 });\n    }\n\n    const ownerId = this.resolveOwnerId(request, url);\n    if (!ownerId) {\n      return new Response(\"Unauthorized\", { status: 401 });\n    }\n\n    const threadId = extractThreadId(url.pathname);\n    if (!threadId) {\n      return new Response(\"Invalid thread id\", { status: 400 });\n    }\n\n    const participant = await this.db.getChatParticipant(threadId, ownerId);\n    if (!participant) {\n      return new Response(\"Forbidden\", { status: 403 });\n    }\n\n    const thread = await this.db.getChatThreadById(threadId);\n    if (!thread) {\n      return new Response(\"Not found\", { status: 404 });\n    }\n\n    this.broadcast({\n      type: \"thread_updated\",\n      thread: {\n        id: thread.id,\n        request_state: thread.requestState,\n        request_sender_id: thread.requestSenderId ?? null,\n        request_message_id: thread.requestMessageId ?? null,\n        last_message_id: thread.lastMessageId ?? null,\n        last_activity_at: thread.lastActivityAt ?? null\n      }\n    });\n\n    return new Response(\"ok\", { status: 200 });\n  }\n\n  private async handleSend(ws: WebSocket, info: ClientInfo, payload: { body_text?: string }) {\n    const rawBody = (payload.body_text ?? \"\").trim();\n    if (!rawBody) {\n      this.sendError(ws, \"body_text required\");\n      return;\n    }\n    if (rawBody.length > 500) {\n      this.sendError(ws, \"body_text too long\");\n      return;\n    }\n\n    const thread = await this.db.getChatThreadById(info.threadId);\n    if (!thread) {\n      this.sendError(ws, \"thread not found\");\n      return;\n    }\n\n    const state = thread.requestState;\n    if (state === \"pending\") {\n      if (thread.requestSenderId && thread.requestSenderId !== info.ownerId) {\n        this.sendError(ws, \"request pending\");\n        return;\n      }\n      if (thread.requestMessageId) {\n        this.sendError(ws, \"request already sent\");\n        return;\n      }\n    }\n    if (state === \"rejected\") {\n      this.sendError(ws, \"request rejected\");\n      return;\n    }\n\n    const message = await this.db.insertChatMessage(info.threadId, info.ownerId, rawBody);\n\n    const shouldSetRequestMessage = state === \"pending\" && !thread.requestMessageId;\n    await this.db.updateChatThreadOnNewMessage(info.threadId, message.id, {\n      requestMessageId: shouldSetRequestMessage ? message.id : null,\n      requestSenderId: state === \"pending\" && !thread.requestSenderId ? info.ownerId : null\n    });\n\n    await this.db.clearParticipantsArchiveDeleted(info.threadId);\n\n    const updated = await this.db.getChatThreadById(info.threadId);\n\n    this.broadcast({\n      type: \"message_new\",\n      message: {\n        id: message.id,\n        thread_id: message.threadId,\n        sender_id: message.senderId,\n        body_text: message.bodyText,\n        created_at: message.createdAt\n      }\n    });\n\n    if (updated) {\n      this.broadcast({\n        type: \"thread_updated\",\n        thread: {\n          id: updated.id,\n          request_state: updated.requestState,\n          request_sender_id: updated.requestSenderId ?? null,\n          request_message_id: updated.requestMessageId ?? null,\n          last_message_id: updated.lastMessageId ?? null,\n          last_activity_at: updated.lastActivityAt ?? null\n        }\n      });\n    }\n  }\n\n  private async handleRead(ws: WebSocket, info: ClientInfo, payload: { last_read_message_id?: string }) {\n    const messageId = (payload.last_read_message_id ?? \"\").trim();\n    if (!messageId) {\n      this.sendError(ws, \"last_read_message_id required\");\n      return;\n    }\n    await this.db.setParticipantLastRead(info.threadId, info.ownerId, messageId);\n    this.broadcastExceptOwner(info.ownerId, {\n      type: \"read_updated\",\n      owner_id: info.ownerId,\n      last_read_message_id: messageId\n    });\n  }\n\n  private async handleRequestDecision(ws: WebSocket, info: ClientInfo, nextState: \"accepted\" | \"rejected\") {\n    const thread = await this.db.getChatThreadById(info.threadId);\n    if (!thread) {\n      this.sendError(ws, \"thread not found\");\n      return;\n    }\n    if (thread.requestState !== \"pending\") {\n      this.sendError(ws, \"invalid request state\");\n      return;\n    }\n    if (thread.requestSenderId && thread.requestSenderId === info.ownerId) {\n      this.sendError(ws, \"forbidden\");\n      return;\n    }\n\n    await this.db.updateChatThreadRequestState(info.threadId, nextState);\n    const updated = await this.db.getChatThreadById(info.threadId);\n    if (!updated) return;\n\n    this.broadcast({\n      type: \"thread_updated\",\n      thread: {\n        id: updated.id,\n        request_state: updated.requestState,\n        request_sender_id: updated.requestSenderId ?? null,\n        request_message_id: updated.requestMessageId ?? null,\n        last_message_id: updated.lastMessageId ?? null,\n        last_activity_at: updated.lastActivityAt ?? null\n      }\n    });\n  }\n\n  private broadcast(payload: ServerMessage) {\n    const message = JSON.stringify(payload);\n    for (const socket of this.sockets.keys()) {\n      try {\n        socket.send(message);\n      } catch {\n        this.sockets.delete(socket);\n      }\n    }\n  }\n\n  private broadcastExceptOwner(ownerId: string, payload: ServerMessage) {\n    const message = JSON.stringify(payload);\n    for (const [socket, info] of this.sockets.entries()) {\n      if (info.ownerId === ownerId) continue;\n      try {\n        socket.send(message);\n      } catch {\n        this.sockets.delete(socket);\n      }\n    }\n  }\n\n  private sendError(ws: WebSocket, message: string) {\n    ws.send(JSON.stringify({ type: \"error\", message }));\n  }\n\n  private resolveOwnerId(request: Request, url: URL): string | null {\n    const header = request.headers.get(\"authorization\");\n    const token =\n      header && header.toLowerCase().startsWith(\"bearer \")\n        ? header.slice(\"bearer \".length).trim()\n        : url.searchParams.get(\"token\")?.trim();\n    if (!token) return null;\n    return parseUserIdFromToken(token);\n  }\n\n  private restoreClientInfo(ws: WebSocket): ClientInfo | null {\n    const attachment = (ws as WebSocketWithAttachment).deserializeAttachment?.();\n    if (!attachment || typeof attachment !== \"object\") return null;\n    const ownerId = (attachment as { ownerId?: unknown }).ownerId;\n    const threadId = (attachment as { threadId?: unknown }).threadId;\n    if (typeof ownerId !== \"string\" || typeof threadId !== \"string\") return null;\n    return { ownerId, threadId };\n  }\n}\n\nfunction safeJson<T>(raw: string): T | null {\n  try {\n    return JSON.parse(raw) as T;\n  } catch {\n    return null;\n  }\n}\n\nfunction extractThreadId(pathname: string): string | null {\n  const match = pathname.match(/\\/ws\\/threads\\/([^/]+)/);\n  if (match && match[1]) return match[1];\n  const parts = pathname.split(\"/\").filter(Boolean);\n  return parts.length > 0 ? parts[parts.length - 1] : null;\n}\n", "import { handleRequest } from \"./api/router\";\nimport { Env } from \"./types\";\n\nexport default {\n  async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {\n    return handleRequest(request, env, ctx);\n  }\n};\n\nexport { ChatThreadDO } from \"./do/chat-thread-do\";\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\ben09\\\\Desktop\\\\rubypets\\\\rubypets\\\\backend\\\\src\\\\index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\ben09\\\\Desktop\\\\rubypets\\\\rubypets\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\ben09\\\\Desktop\\\\rubypets\\\\rubypets\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\ben09\\\\Desktop\\\\rubypets\\\\rubypets\\\\backend\\\\src\\\\index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\ben09\\\\Desktop\\\\rubypets\\\\rubypets\\\\backend\\\\.wrangler\\\\tmp\\\\bundle-RoT4Ec\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\ben09\\\\Desktop\\\\rubypets\\\\rubypets\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\ben09\\\\Desktop\\\\rubypets\\\\rubypets\\\\backend\\\\.wrangler\\\\tmp\\\\bundle-RoT4Ec\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\ben09\\\\Desktop\\\\rubypets\\\\rubypets\\\\backend\\\\.wrangler\\\\tmp\\\\bundle-RoT4Ec\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,UACF;AAAA,QACF;AAAA,QACA;AAAA,UACE,KAAO;AAAA,UACP,OAAS;AAAA,UACT,UAAY;AAAA,UACZ,QAAU;AAAA,YACR;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA,YACX;AAAA,YACA;AAAA,cACE,KAAO;AAAA,cACP,OAAS;AAAA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",
  "names": ["message", "message", "routes", "encode", "message", "keyData", "cached", "encode", "json", "message", "message", "routes", "routes", "dynamicRoutes", "routes", "dynamicRoutes", "getPublicMediaBase", "routes", "dynamicRoutes", "routes", "dynamicRoutes", "isFriend", "message", "routes", "dynamicRoutes", "routes", "dynamicRoutes", "routes", "dynamicRoutes", "db", "message", "message"]
}
